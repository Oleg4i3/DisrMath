<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DFT</title>
    <style>
        :root {
            --bg-color: #121212;
            --panel-bg: #1e1e2e;
            --text-color: #e0e0e0;
            --accent-color: #4cc9f0;
            --success-color: #4caf50;
            --target-color: #ffffff;
            --probe-color: #4361ee; /* CHANGED to Blue */
            --sin-color: #ff006e; 
            --cos-color: #3a86ff; 
            --vector-color: #ffd60a;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            box-sizing: border-box;
        }

        h1 { margin: 0 0 15px 0; font-size: 1.5rem; color: var(--accent-color); }

        /* TABS NAVIGATION */
        .tabs-nav {
            display: flex;
            background: var(--panel-bg);
            border-radius: 12px 12px 0 0;
            overflow: hidden;
            margin-bottom: 0;
            border: 1px solid #333;
            width: 100%;
            max-width: 1100px;
        }

        .tab-btn {
            flex: 1;
            background: transparent;
            border: none;
            padding: 15px;
            color: #888;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
            border-bottom: 3px solid transparent;
        }

        .tab-btn:hover { background: rgba(255,255,255,0.05); }
        .tab-btn.active {
            color: var(--accent-color);
            background: rgba(76, 201, 240, 0.1);
            border-bottom: 3px solid var(--accent-color);
        }

        .tab-content {
            display: none;
            width: 100%;
            max-width: 1100px;
            animation: fadeIn 0.3s;
        }
        .tab-content.active { display: grid; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Main Layout */
        .workspace-grid {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 20px;
            background: #181825;
            padding: 20px;
            border-radius: 0 0 12px 12px;
            border: 1px solid #333;
            border-top: none;
        }

        /* Controls Panel */
        .controls-panel {
            background: var(--panel-bg);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #333;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .control-group {
            background: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 8px;
        }
        
        label { display: block; margin-bottom: 8px; font-weight: bold; font-size: 0.9rem; }
        
        input[type="range"] { width: 100%; cursor: pointer; margin-bottom: 5px; }
        
        .val-display { font-family: monospace; color: var(--accent-color); float: right; }

        .btn {
            background: #333;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            width: 100%;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .btn:hover { background: #444; }
        
        .btn-record {
            background: #2a2a4e;
            border: 2px solid #3f3f6e;
            margin-top: auto;
        }
        
        .btn-record.highlight {
            background: var(--success-color);
            box-shadow: 0 0 15px var(--success-color);
            border-color: #fff;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.03); }
            100% { transform: scale(1); }
        }

        /* Visualization Panel */
        .vis-panel {
            background: #000;
            border-radius: 12px;
            border: 1px solid #333;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            min-height: 400px;
        }

        canvas { width: 100%; height: 100%; display: block; }

        .legend {
            position: absolute;
            top: 10px;
            right: 15px;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 5px;
            font-size: 0.8rem;
            border: 1px solid #444;
            pointer-events: none;
        }
        .legend-item { display: flex; align-items: center; gap: 8px; margin-bottom: 4px; }
        .dot { width: 10px; height: 10px; border-radius: 50%; }

        /* Bottom Section */
        .bottom-workspace {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
            width: 100%;
            max-width: 1100px;
            height: 280px;
            margin-top: 20px;
        }

        .bottom-panel {
            background: var(--panel-bg);
            border-radius: 12px;
            border: 1px solid #333;
            padding: 10px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .panel-title {
            font-size: 0.9rem;
            color: #888;
            margin-bottom: 5px;
            text-align: center;
        }

        .status-msg {
            text-align: center;
            font-size: 0.9rem;
            min-height: 1.2em;
            color: var(--probe-color);
            margin-top: 10px;
        }

        /* ADVANCED TAB STYLES */
        .adv-grid {
            display: grid;
            grid-template-columns: 300px 1fr 1fr;
            gap: 20px;
            background: #181825;
            padding: 20px;
            border-radius: 0 0 12px 12px;
            border: 1px solid #333;
            border-top: none;
            min-height: 500px;
        }

        .adv-column {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .mini-chart-container {
            background: #000;
            border: 1px solid #444;
            border-radius: 8px;
            height: 150px;
            position: relative;
        }
        
        .vector-container {
            background: #101015;
            border: 1px solid #444;
            border-radius: 12px;
            height: 100%;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .math-box {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .complex-note {
            margin-top: 15px;
            padding: 10px;
            border-left: 3px solid var(--accent-color);
            background: rgba(76, 201, 240, 0.1);
            font-size: 0.9rem;
        }

    </style>
</head>
<body>

    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

<details style="background: #1e1e2e; border: 1px solid #333; border-radius: 8px; margin-bottom: 20px; padding: 10px;">
    <summary style="cursor: pointer; font-weight: bold; color: var(--accent-color); padding: 5px;">
        üìö –¢–µ–æ—Ä–µ—Ç–∏—á–Ω–∞ –¥–æ–≤—ñ–¥–∫–∞
    </summary>
    <div style="padding: 15px; color: #ccc; line-height: 1.6;">

        <h3 style="color:white; border-bottom: 1px solid #444; padding-bottom:5px;">–Ü–¥–µ—è –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è –§—É—Ä'—î</h3>
        <p>–£ —Ü—å–æ–º—É —Å–∏–º—É–ª—è—Ç–æ—Ä—ñ –º–∏ —Ä–æ–∑–≥–ª—è–¥–∞—î–º–æ –¥–≤–∞ –ø—ñ–¥—Ö–æ–¥–∏ –¥–æ —Ä–æ–∑–∫–ª–∞–¥–∞–Ω–Ω—è —Å–∏–≥–Ω–∞–ª—É –Ω–∞ —Å–ø–µ–∫—Ç—Ä–∞–ª—å–Ω—ñ (–≥–∞—Ä–º–æ–Ω—ñ—á–Ω—ñ) –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏.</p>
        <ul>
            <li><strong>–í–∫–ª–∞–¥–∫–∞ 1 (–Ü–Ω—Ç—É—ó—Ç–∏–≤–Ω–∞):</strong> –¶–µ –º–µ—Ç–æ–¥ "–≥—Ä—É–±–æ—ó —Å–∏–ª–∏" –∞–±–æ <em>–∑–≥–æ—Ä—Ç–∫–∏</em>. –ú–∏ –±–µ—Ä–µ–º–æ –µ—Ç–∞–ª–æ–Ω–Ω—É —Å–∏–Ω—É—Å–æ—ó–¥—É —ñ "—Ç—è–≥–∞—î–º–æ" —ó—ó –≤–ª—ñ–≤–æ-–≤–ø—Ä–∞–≤–æ (–∑–º—ñ–Ω—é—î–º–æ —Ñ–∞–∑—É), –ø–æ–∫–∏ –≤–æ–Ω–∞ –Ω–µ –¥–∞—Å—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É –∫–æ—Ä–µ–ª—è—Ü—ñ—é (—Å—Ö–æ–∂–µ—Å—Ç—å) —ñ–∑ —Å–∏–≥–Ω–∞–ª–æ–º. –¶–µ –∑—Ä–æ–∑—É–º—ñ–ª–æ, –∞–ª–µ –æ–±—á–∏—Å–ª—é–≤–∞–ª—å–Ω–æ –¥–æ—Ä–æ–≥–æ.</li>
            <li><strong>–í–∫–ª–∞–¥–∫–∞ 2 (–í–µ–∫—Ç–æ—Ä–Ω–∞/–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞):</strong> –¶–µ –º–µ—Ç–æ–¥ <em>–û—Ä—Ç–æ–≥–æ–Ω–∞–ª—å–Ω–∏—Ö –ø—Ä–æ–µ–∫—Ü—ñ–π</em> (—Å–ø—Ä–∞–≤–∂–Ω—ñ–π –î–ü–§). –ó–∞–º—ñ—Å—Ç—å —Ç–æ–≥–æ, —â–æ–± –ø–µ—Ä–µ–±–∏—Ä–∞—Ç–∏ –±–∞–≥–∞—Ç–æ –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤ –∑—Å—É–≤—É, –º–∏ —Ä–æ–±–∏–º–æ –ª–∏—à–µ –¥–≤–∞ –≤–∏–º—ñ—Ä–∏: –Ω–∞—Å–∫—ñ–ª—å–∫–∏ —Å–∏–≥–Ω–∞–ª —Å—Ö–æ–∂–∏–π –Ω–∞ <strong>–ö–æ—Å–∏–Ω—É—Å</strong> (–ø–∞—Ä–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è) —ñ –Ω–∞—Å–∫—ñ–ª—å–∫–∏ –Ω–∞ <strong>–°–∏–Ω—É—Å</strong> (–Ω–µ–ø–∞—Ä–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è). –¶—å–æ–≥–æ –¥–æ—Å—Ç–∞—Ç–Ω—å–æ, —â–æ–± –º–∏—Ç—Ç—î–≤–æ –∑–Ω–∞–π—Ç–∏ —ñ –∞–º–ø–ª—ñ—Ç—É–¥—É, —ñ —Ñ–∞–∑—É.</li>
        </ul>

        <h3 style="color:white; border-bottom: 1px solid #444; padding-bottom:5px;">–§—ñ–∑–∏—á–Ω–∏–π –∑–º—ñ—Å—Ç —Ç–∞ –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è</h3>
        <p><strong>–î–∏—Å–∫—Ä–µ—Ç–Ω–µ –ü–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è –§—É—Ä'—î (–î–ü–§)</strong> ‚Äî —Ü–µ –º–∞—Ç–µ–º–∞—Ç–∏—á–Ω–∞ –ø—Ä–∏–∑–º–∞, —è–∫–∞ —Ä–æ–∑–∫–ª–∞–¥–∞—î —Å–∫–ª–∞–¥–Ω–∏–π —Å–∏–≥–Ω–∞–ª (–∑–≤—É–∫, —Ä–∞–¥—ñ–æ—Ö–≤–∏–ª—ñ, –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è) –Ω–∞ –Ω–∞–±—ñ—Ä –ø—Ä–æ—Å—Ç–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤ ‚Äî –≥–∞—Ä–º–æ–Ω—ñ–∫.</p>
               <ul>
            <li><strong>–ú—É–∑–∏–∫–∞:</strong> –ó–≤—É–∫–æ—Ä–∏–∂–µ—Å–µ—Ä–∏ –æ–∞–Ω–ª—ñ–∑—É—é—Ç—å —ñ —Ñ—ñ–ª—å—Ç—Ä—É—é—Ç—å —Ä—ñ–∑–Ω—ñ —Å–ø–µ–∫—Ç—Ä–∞–ª—å–Ω—ñ –¥—ñ–∞–ø–∞–∑–æ–Ω–∏ (–Ω–∏–∑—å–∫–∏ —á–∞—Å—Ç–æ—Ç–∏ - –±–∞—Å–∏, —Å–µ—Ä–µ–¥–Ω—ñ - –≤–æ–∫–∞–ª, —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏, –≤–∏—Å–æ–∫—ñ - —Å–≤–∏—Ç, –¥–∑–≤—ñ–Ω —Ç–æ—â–æ).</li>
            <li><strong>–ú–µ–¥–∏—Ü–∏–Ω–∞:</strong> –ù–∞ –æ—Å–Ω–æ–≤—ñ —Å–ø–µ–∫—Ç—Ä–∞–ª—å–Ω–∏—Ö —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ –∞–∞–ª—ñ–∑—É—é—Ç—å –±—ñ–æ–ª–æ–≥—ñ—á–Ω—ñ —Å–∏–≥–Ω–∞–ª–∏ (–ø—É–ª—Å–æ–≥—Ä–∞–º–∏, –ï–ï–ì —Ç–æ—â–æ)</li>
            <li><strong>Shazam:</strong> –†–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è –ø—ñ—Å–µ–Ω—å –∑–∞ —ó—Ö —Å–ø–µ–∫—Ç—Ä–∞–ª—å–Ω–∏–º "–≤—ñ–¥–±–∏—Ç–∫–æ–º".</li>
            <li><strong>Wi-Fi / 5G:</strong> –ú–æ–¥—É–ª—è—Ü—ñ—è OFDM –±–∞–∑—É—î—Ç—å—Å—è –Ω–∞ –æ–±–µ—Ä–Ω–µ–Ω–æ–º—É –î–ü–§.</li>
        </ul>

        <h3 style="color:white; border-bottom: 1px solid #444; padding-bottom:5px;">–¢—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä—ñ—è —ñ –í–µ–∫—Ç–æ—Ä–∏</h3>
        <p>–ì–æ–ª–æ–≤–Ω–∞ —ñ–¥–µ—è –±–∞–∑—É—î—Ç—å—Å—è –Ω–∞ —Ç—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä–∏—á–Ω—ñ–π —Ç–æ—Ç–æ–∂–Ω–æ—Å—Ç—ñ. –ë—É–¥—å-—è–∫—É –∑–º—ñ—â–µ–Ω—É —Å–∏–Ω—É—Å–æ—ó–¥—É –º–æ–∂–Ω–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–∏ —è–∫ —Å—É–º—É "—á–∏—Å—Ç–æ–≥–æ" –∫–æ—Å–∏–Ω—É—Å–∞ —ñ "—á–∏—Å—Ç–æ–≥–æ" —Å–∏–Ω—É—Å–∞:</p>
        
        $$ A_{res} \cdot \cos(\omega t - \varphi) = \underbrace{a}_{\text{Re}} \cdot \cos(\omega t) + \underbrace{b}_{\text{Im}} \cdot \sin(\omega t) $$

        <div style="display: flex; gap: 20px; align-items: center; flex-wrap: wrap; margin: 20px 0;">
            <div style="background: #121212; padding: 10px; border-radius: 8px; border: 1px solid #444;">
                <svg width="200" height="200" viewBox="-20 -20 240 240">
                    <defs>
                        <marker id="arrow" markerWidth="10" markerHeight="10" refX="0" refY="3" orient="auto" markerUnits="strokeWidth">
                          <path d="M0,0 L0,6 L9,3 z" fill="#888" />
                        </marker>
                    </defs>
                    <line x1="20" y1="180" x2="220" y2="180" stroke="#888" stroke-width="2" marker-end="url(#arrow)"/>
                    <text x="200" y="170" fill="#888" font-size="12">Re (Cos)</text>
                    <line x1="20" y1="180" x2="20" y2="20" stroke="#888" stroke-width="2" marker-end="url(#arrow)"/>
                    <text x="30" y="30" fill="#888" font-size="12">Im (Sin)</text>
                    
                    <line x1="20" y1="180" x2="160" y2="180" stroke="#3a86ff" stroke-width="3" /> <text x="90" y="200" fill="#3a86ff" font-weight="bold">a (Cos)</text>

                    <line x1="160" y1="180" x2="160" y2="80" stroke="#ff006e" stroke-width="3" stroke-dasharray="4"/> <text x="170" y="130" fill="#ff006e" font-weight="bold">b (Sin)</text>

                    <line x1="20" y1="180" x2="160" y2="80" stroke="#ffd60a" stroke-width="4" />
                    <circle cx="160" cy="80" r="4" fill="#ffd60a"/>
                    
                    <path d="M 60 180 A 40 40 0 0 0 55 155" stroke="white" fill="none"/>
                    <text x="65" y="165" fill="white">œÜ</text>

                    <text x="100" y="70" fill="#ffd60a" font-weight="bold">–í–µ–∫—Ç–æ—Ä (–ê–º–ø–ª—ñ—Ç—É–¥–∞)</text>
                </svg>
            </div>
            
            <div style="max-width: 400px;">
                <p>–ú–∏ —à—É–∫–∞—î–º–æ –ø—Ä–æ–µ–∫—Ü—ñ—ó (–∫–æ—Ä–µ–ª—è—Ü—ñ—ó):</p>
                <ul>
                    <li style="color:#3a86ff">$$ a = \sum x[n] \cdot \cos(2\pi kn/N) $$</li>
                    <li style="color:#ff006e">$$ b = \sum x[n] \cdot \sin(2\pi kn/N) $$</li>
                </ul>
                <p>–¢–æ–¥—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –∑–Ω–∞–π–¥–µ–Ω–æ—ó —Ö–≤–∏–ª—ñ:</p>
                <p><strong>–ê–º–ø–ª—ñ—Ç—É–¥–∞:</strong> $$ |M| = \sqrt{a^2 + b^2} $$</p>
                <p><strong>–§–∞–∑–∞:</strong> $$ \varphi = \arctan(b/a) $$</p>
            </div>
        </div>

        <h3 style="color:white; border-bottom: 1px solid #444; padding-bottom:5px;">–ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è –∫–æ–º–ø–ª–µ–∫—Å–Ω–∏–º–∏ —á–∏—Å–ª–∞–º–∏</h3>
        <p>–ö–æ–º–ø–ª–µ–∫—Å–Ω–µ —á–∏—Å–ª–æ ‚Äî —Ü–µ –ø—Ä–æ—Å—Ç–æ –∑—Ä—É—á–Ω–∏–π "–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä", —â–æ–± –Ω–æ—Å–∏—Ç–∏ –¥–≤–∞ —á–∏—Å–ª–∞ ($a$ —ñ $b$) —Ä–∞–∑–æ–º.</p>
        <p>–û—Å–Ω–æ–≤–Ω–∞ —Ñ–æ—Ä–º—É–ª–∞ –î–ü–§ –≤–∏–≥–ª—è–¥–∞—î —Ç–∞–∫:</p>
        $$ X[k] = \sum_{n=0}^{N-1} x[n] \cdot e^{-i 2\pi k n / N} $$
        <p>–ó–∞ —Ñ–æ—Ä–º—É–ª–æ—é –ï–π–ª–µ—Ä–∞ $$ e^{-ix} = \cos(x) - i\sin(x) $$ –¶–µ –æ–∑–Ω–∞—á–∞—î, —â–æ  –î–ü–§ –ø—Ä–æ—Å—Ç–æ <em>"—Ä–∞—Ö—É—î –∫–æ—Ä–µ–ª—è—Ü—ñ—é –∑ –∫–æ—Å–∏–Ω—É—Å–æ–º —ñ –∑–∞–ø–∏—Å—É—î –≤ –¥—ñ–π—Å–Ω—É —á–∞—Å—Ç–∏–Ω—É, –∞ –∫–æ—Ä–µ–ª—è—Ü—ñ—é –∑ –º—ñ–Ω—É—Å —Å–∏–Ω—É—Å–æ–º ‚Äî –≤ —É—è–≤–Ω—É</em>.</p>
    </div>
</details>

    <div class="tabs-nav">
        <button class="tab-btn active" onclick="switchTab('intuitive')">–Ü–Ω—Ç—É—ó—Ç–∏–≤–Ω–∏–π —Ä–µ–∂–∏–º (–∫–æ—Ä–µ–ª—è—ñ—è)</button>
        <button class="tab-btn" onclick="switchTab('advanced')">–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π —Ä–µ–∂–∏–º (–í–µ–∫—Ç–æ—Ä–∏)</button>
    </div>

    <div id="tab-intuitive" class="tab-content active">
        <div class="workspace-grid">
            <div class="controls-panel">
                <button class="btn" onclick="generateNewSignal()">üé≤ –ù–æ–≤–∏–π —Å–∏–≥–Ω–∞–ª</button>
                
                <div class="control-group">
                    <label>1. –ß–∞—Å—Ç–æ—Ç–∞ (k): <span id="freqVal" class="val-display">0</span></label>
                    <input type="range" id="freqSlider" min="0" max="7" step="1" value="0">
                    <small style="color:#888;">–ù–æ–º–µ—Ä –≥–∞—Ä–º–æ–Ω—ñ–∫–∏ (–∫—ñ–ª—å–∫—ñ—Å—Ç—å —Ö–≤–∏–ª—å)</small>
                </div>

                <div class="control-group">
                    <label>2. –ó—Å—É–≤ (n): <span id="shiftVal" class="val-display">0</span> <span id="shiftLimit" style="color:#666; font-size:0.8em"></span></label>
                    <input type="range" id="phaseSlider" min="0" max="31" step="1" value="0">
                    <small style="color:#888;">–ó—Å—É–≤ –≤–ø—Ä–∞–≤–æ (–æ–±–º–µ–∂–µ–Ω–æ –ø–µ—Ä—ñ–æ–¥–æ–º)</small>
                </div>

                <div class="control-group" style="text-align: center;">
                    <div style="font-size:2rem; font-weight:bold;" id="corrVal">0.00</div>
                    <div style="font-size:0.8rem; color:#aaa;">–ü–æ—Ç–æ—á–Ω–∞ –∫–æ—Ä–µ–ª—è—Ü—ñ—è (—Å—Ö–æ–∂—ñ—Å—Ç—å)</div>
                </div>

                <button id="recordBtn" class="btn btn-record" onclick="recordHarmonic()">üíæ –ó–∞–ø–∏—Å–∞—Ç–∏ —É —Å–ø–µ–∫—Ç—Ä</button>
                <div id="statusMsg" class="status-msg"></div>
            </div>

            <div class="vis-panel">
                <div class="legend">
                    <div class="legend-item"><div class="dot" style="background:var(--target-color)"></div>–í—Ö—ñ–¥–Ω–∏–π —Å–∏–≥–Ω–∞–ª</div>
                    <div class="legend-item"><div class="dot" style="background:var(--probe-color)"></div>–ü—Ä–æ–±–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è (Blue)</div>
                    <div class="legend-item"><div class="dot" style="background:rgba(75, 255, 75, 0.5)"></div>–î–æ–±—É—Ç–æ–∫ (+)</div>
                    <div class="legend-item"><div class="dot" style="background:rgba(255, 75, 75, 0.5)"></div>–î–æ–±—É—Ç–æ–∫ (-)</div>
                </div>
                <canvas id="mainCanvas"></canvas>
            </div>
        </div>

        <div class="bottom-workspace">
            <div class="bottom-panel">
                <div class="panel-title">üìä –û–±—á–∏—Å–ª–µ–Ω–∏–π –°–ø–µ–∫—Ç—Ä (–ê–º–ø–ª—ñ—Ç—É–¥–∏ —Ç–∞ –§–∞–∑–∏)</div>
                <canvas id="spectrumCanvas"></canvas>
            </div>
            <div class="bottom-panel">
                <div class="panel-title">„Ä∞Ô∏è –†–µ–∫–æ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è (–°—É–º–∞ –∑–∞–ø–∏—Å–∞–Ω–∏—Ö –≥–∞—Ä–º–æ–Ω—ñ–∫)</div>
                <canvas id="reconCanvas"></canvas>
            </div>
        </div>
    </div>

    <div id="tab-advanced" class="tab-content">
        <div class="adv-grid">
            <div class="adv-column">
                <h3>–í–∏–±—ñ—Ä –≥–∞—Ä–º–æ–Ω—ñ–∫–∏</h3>
                <div class="control-group">
                    <label>–ß–∞—Å—Ç–æ—Ç–∞ (k): <span id="advFreqVal" class="val-display">1</span></label>
                    <input type="range" id="advFreqSlider" min="0" max="7" step="1" value="1">
                </div>
                
                <div class="math-box">
                    <p>–ó–∞–º—ñ—Å—Ç—å —Ä—É—á–Ω–æ–≥–æ –ø—ñ–¥–±–æ—Ä—É –∑—Å—É–≤—É, –º–∏ –æ–±—á–∏—Å–ª—é—î–º–æ –¥–≤—ñ –∫–æ—Ä–µ–ª—è—Ü—ñ—ó:</p>
                    <p style="color:var(--cos-color)">A = –ö–æ—Ä–µ–ª—è—Ü—ñ—è –∑ Cos</p>
                    <p style="color:var(--sin-color)">B = –ö–æ—Ä–µ–ª—è—Ü—ñ—è –∑ Sin</p>
                </div>

                <div class="complex-note">
                    <strong>–ö–æ–º–ø–ª–µ–∫—Å–Ω—ñ —á–∏—Å–ª–∞:</strong><br>
                    –¶–µ "–ø–∞–∫—É–≤–∞–Ω–Ω—è" –≤–µ–∫—Ç–æ—Ä–∞.<br>
                    –ß–∏—Å–ª–æ = A + iB<br>
                    –ê–º–ø–ª—ñ—Ç—É–¥–∞ = –î–æ–≤–∂–∏–Ω–∞<br>
                    –§–∞–∑–∞ = –ö—É—Ç
                </div>
            </div>

            <div class="adv-column">
                <div style="text-align:center; font-weight:bold; color:var(--cos-color)">–ü—Ä–æ–µ–∫—Ü—ñ—è –Ω–∞ COS</div>
                <div class="mini-chart-container">
                    <canvas id="advCosCanvas"></canvas>
                </div>
                <div style="text-align:center;">–ö–æ—Ä–µ–ª—è—Ü—ñ—è A = <span id="valA">0.00</span></div>

                <hr style="border-color:#333; width:100%;">

                <div style="text-align:center; font-weight:bold; color:var(--sin-color)">–ü—Ä–æ–µ–∫—Ü—ñ—è –Ω–∞ SIN</div>
                <div class="mini-chart-container">
                    <canvas id="advSinCanvas"></canvas>
                </div>
                <div style="text-align:center;">–ö–æ—Ä–µ–ª—è—Ü—ñ—è B = <span id="valB">0.00</span></div>
            </div>

            <div class="adv-column">
                <div style="text-align:center; font-weight:bold; color:var(--vector-color)">–í–µ–∫—Ç–æ—Ä–Ω–∞ —Å—É–º–∞</div>
                <div class="vector-container">
                    <canvas id="vectorCanvas"></canvas>
                </div>
                <div class="math-box" style="text-align:center;">
                    –ê–º–ø–ª—ñ—Ç—É–¥–∞ = <span id="vecAmp" style="color:var(--vector-color)">0.00</span><br>
                    –§–∞–∑–∞ = <span id="vecPhase">0</span>¬∞
                </div>
            </div>
        </div>
    </div>

<script>
    // --- CONFIG ---
    const N = 32; // Discrete points
    const NUM_HARMONICS = 8; // k = 0..7
    const HIGH_RES = 300; // For smooth envelopes
    
    // --- STATE ---
    let targetSignal = new Float32Array(N);
    let signalComposition = []; 
    let recordedSpectrum = new Array(NUM_HARMONICS).fill(null).map(() => ({ amp: 0, shift: 0, recorded: false }));
    let groundTruthSpectrum = []; 
    
    // UI State
    let currentK = 0;
    let currentShift = 0;
    let activeTabId = 'intuitive';
    let advK = 1; 

    // Elements
    const mainCanvas = document.getElementById('mainCanvas');
    const spectrumCanvas = document.getElementById('spectrumCanvas');
    const reconCanvas = document.getElementById('reconCanvas');
    
    // Adv Elements
    const advCosCanvas = document.getElementById('advCosCanvas');
    const advSinCanvas = document.getElementById('advSinCanvas');
    const vectorCanvas = document.getElementById('vectorCanvas');
    const advFreqSlider = document.getElementById('advFreqSlider');
    const advFreqVal = document.getElementById('advFreqVal');
    const valA_el = document.getElementById('valA');
    const valB_el = document.getElementById('valB');
    const vecAmp_el = document.getElementById('vecAmp');
    const vecPhase_el = document.getElementById('vecPhase');

    // Controls
    const freqSlider = document.getElementById('freqSlider');
    const phaseSlider = document.getElementById('phaseSlider');
    const shiftLimitSpan = document.getElementById('shiftLimit');
    const recordBtn = document.getElementById('recordBtn');
    const statusMsg = document.getElementById('statusMsg');

    // Contexts
    const ctxMain = mainCanvas.getContext('2d');
    const ctxSpec = spectrumCanvas.getContext('2d');
    const ctxRecon = reconCanvas.getContext('2d');
    const ctxAdvCos = advCosCanvas.getContext('2d');
    const ctxAdvSin = advSinCanvas.getContext('2d');
    const ctxVector = vectorCanvas.getContext('2d');

    // --- INIT ---
    function resize() {
        const canvases = [mainCanvas, spectrumCanvas, reconCanvas, advCosCanvas, advSinCanvas, vectorCanvas];
        canvases.forEach(c => {
            if(c.offsetParent) {
                c.width = c.clientWidth;
                c.height = c.clientHeight;
            }
        });
        if(activeTabId === 'intuitive') drawAll();
        else updateAdvancedTab();
    }
    window.addEventListener('resize', resize);

    function switchTab(mode) {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        
        if(mode === 'intuitive') {
            document.querySelectorAll('.tab-btn')[0].classList.add('active');
            document.getElementById('tab-intuitive').classList.add('active');
            activeTabId = 'intuitive';
            resize();
            drawAll();
        } else {
            document.querySelectorAll('.tab-btn')[1].classList.add('active');
            document.getElementById('tab-advanced').classList.add('active');
            activeTabId = 'advanced';
            resize();
            updateAdvancedTab();
        }
    }

    function generateNewSignal() {
        recordedSpectrum = new Array(NUM_HARMONICS).fill(null).map(() => ({ amp: 0, shift: 0, recorded: false }));
        groundTruthSpectrum = [];
        signalComposition = [];
        
        for(let k=0; k<NUM_HARMONICS; k++) {
            let amp = 0;
            if (Math.random() > 0.6 || k===1) { 
                amp = parseFloat((Math.random() * 0.8 + 0.2).toFixed(2));
            }
            if (k===0) amp = 0; 
            
            // Random shift, but kept within one period for logical consistency in generation
            let period = (k===0) ? N : Math.ceil(N/k);
            let shift = Math.floor(Math.random() * period); 

            groundTruthSpectrum.push({ amp, shift });
            if(amp > 0) signalComposition.push({k, amp, shift});
        }

        // Build discrete signal
        for(let n=0; n<N; n++) {
            targetSignal[n] = getContinuousValue(signalComposition, n);
        }
        
        resetControls();
        if(activeTabId === 'intuitive') drawAll();
        else updateAdvancedTab();
        statusMsg.innerText = "–ó–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ –Ω–æ–≤–∏–π —Å–∏–≥–Ω–∞–ª!";
    }

    function updateSliderLimits(k) {
        // Calculate limit based on period
        // T = N / k
        // We want user to be able to shift up to approx one period
        let maxShift = (k === 0) ? N - 1 : Math.ceil(N / k);
        // Clamp maxShift to N-1
        if (maxShift >= N) maxShift = N - 1;
        
        phaseSlider.max = maxShift;
        shiftLimitSpan.innerText = `(max: ${maxShift})`;

        // Clamp current value
        if (parseInt(phaseSlider.value) > maxShift) {
            phaseSlider.value = 0;
            currentShift = 0;
        }
    }

    function resetControls() {
        freqSlider.value = 0;
        currentK = 0;
        updateSliderLimits(0);
        
        phaseSlider.value = 0;
        currentShift = 0;
        updateUIValues();
    }

    // --- MATH HELPERS ---

    function getContinuousValue(composition, t) {
        let sum = 0;
        for(let comp of composition) {
            sum += comp.amp * Math.cos(2 * Math.PI * comp.k * (t - comp.shift) / N);
        }
        return sum;
    }

    function getBasis(k, shift, n) {
        return Math.cos(2 * Math.PI * k * (n - shift) / N);
    }

    function getBasisContinuous(k, shift, t) {
        return Math.cos(2 * Math.PI * k * (t - shift) / N);
    }

    function calculateCorrelation(k, shift, useSin=false) {
        let sum = 0;
        for(let n=0; n<N; n++) {
            let b;
            if(!useSin) {
                b = getBasis(k, shift, n);
            } else {
                b = Math.sin(2 * Math.PI * k * n / N);
            }
            sum += targetSignal[n] * b;
        }
        let normFactor = (k === 0) ? (1/N) : (2/N);
        return sum * normFactor;
    }

    // --- DRAWING ---

    function drawStems(ctx, data, color, width, height, isBar = false, secondaryData = null, 
                       compositionForEnvelope = null, forceK = -1, forceShift = -1) {
        
        const stepX = width / N;
        const centerY = height / 2;
        const scaleY = height / 3.5;

        // Grid
        ctx.strokeStyle = "#333";
        ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.moveTo(0, centerY);
        ctx.lineTo(width, centerY);
        ctx.stroke();

        // Correlation bars
        if (secondaryData) {
            for (let i = 0; i < N; i++) {
                let product = data[i] * secondaryData[i];
                let x = i * stepX;
                let barW = stepX - 2;
                let hBar = product * scaleY;

                if (product > 0.01) ctx.fillStyle = "rgba(75, 255, 75, 0.4)";
                else if (product < -0.01) ctx.fillStyle = "rgba(255, 75, 75, 0.4)";
                else ctx.fillStyle = "transparent";

                ctx.fillRect(x + 1, centerY, barW, -hBar);
            }
        }

        // --- DRAW SMOOTH ENVELOPE ---
        ctx.beginPath();
        ctx.lineWidth = 2;
        ctx.strokeStyle = color;
        ctx.globalAlpha = 0.5;

        // Alignment Fix:
        // Visual area [0, width] maps to time [0, N].
        // Stems are drawn at centers: i*stepX + stepX/2.
        // For N=32, stepX = W/32. First stem at W/64.
        // Time represented by first stem center is t = 0.5.
        // But in DFT math, sample n=0 usually implies t=0.
        // If we want the line to pass through the dots:
        // The dot at index i is mathematically at time t=i.
        // But visually it is at x = (i+0.5)*stepX.
        // So for a given visual x, the mathematical time t is:
        // t = (x / width) * N - 0.5;

        for(let i=0; i<=HIGH_RES; i++) {
            let x = (i / HIGH_RES) * width;
            // Calculate corresponding time t for this pixel x
            let t = (x / width) * N - 0.5;
            
            let val = 0;
            if(compositionForEnvelope) {
                val = getContinuousValue(compositionForEnvelope, t);
            } else if (forceK !== -1) {
                val = getBasisContinuous(forceK, forceShift, t);
            } else {
                continue; // Should not happen for envelopes
            }

            let y = centerY - val * scaleY;
            if(i===0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
        }
        ctx.stroke();
        ctx.globalAlpha = 1.0;


        // --- DRAW STEMS (Discrete) ---
        ctx.lineWidth = 1;
        for (let i = 0; i < N; i++) {
            let x = i * stepX + stepX/2;
            let y = centerY - data[i] * scaleY;

            ctx.beginPath();
            ctx.moveTo(x, centerY);
            ctx.lineTo(x, y);
            ctx.strokeStyle = color;
            ctx.stroke();

            ctx.beginPath();
            ctx.arc(x, y, 3, 0, Math.PI*2);
            ctx.fillStyle = color;
            ctx.fill();
        }
    }

    function drawSpectrum() {
        const w = spectrumCanvas.width;
        const h = spectrumCanvas.height;
        ctxSpec.clearRect(0,0,w,h);
        
        const barWidth = (w / NUM_HARMONICS) * 0.8;
        const step = w / NUM_HARMONICS;
        const scaleY = (h - 40) / 1.5;

        for(let k=0; k<NUM_HARMONICS; k++) {
            let item = recordedSpectrum[k];
            let amp = item.recorded ? item.amp : 0;
            let x = k * step + step/2 - barWidth/2;
            let barH = amp * scaleY;
            
            ctxSpec.fillStyle = item.recorded ? "#4cc9f0" : "#333";
            ctxSpec.fillRect(x, h - barH - 40, barWidth, barH);
            
            ctxSpec.fillStyle = "#888";
            ctxSpec.font = "12px monospace";
            ctxSpec.textAlign = "center";
            ctxSpec.fillText(`k=${k}`, x + barWidth/2, h - 25);

            if(item.recorded) {
                ctxSpec.fillStyle = "#ffd60a";
                ctxSpec.font = "bold 11px monospace";
                ctxSpec.fillText(`œÜ:${item.shift}`, x + barWidth/2, h - 10);
            }
        }
    }

    function drawReconstruction() {
        const w = reconCanvas.width;
        const h = reconCanvas.height;
        ctxRecon.clearRect(0,0,w,h);

        let reconData = new Float32Array(N).fill(0);
        let activeComps = [];

        for(let k=0; k<NUM_HARMONICS; k++) {
            if (recordedSpectrum[k].recorded) {
                activeComps.push({k: k, amp: recordedSpectrum[k].amp, shift: recordedSpectrum[k].shift});
            }
        }
        
        for(let n=0; n<N; n++) {
             reconData[n] = getContinuousValue(activeComps, n);
        }

        drawStems(ctxRecon, targetSignal, "rgba(255,255,255,0.2)", w, h, false, null, signalComposition);
        drawStems(ctxRecon, reconData, "#ffd60a", w, h, false, null, activeComps);
    }

    function drawAll() {
        const w = mainCanvas.width;
        const h = mainCanvas.height;
        ctxMain.clearRect(0, 0, w, h);

        let probeData = new Float32Array(N);
        for(let n=0; n<N; n++) {
            probeData[n] = getBasis(currentK, currentShift, n);
        }

        // Draw Target Signal (White)
        drawStems(ctxMain, targetSignal, "#ffffff", w, h, false, probeData, signalComposition);

        // Draw Probe Signal (Blue)
        // Note: Using var(--probe-color) hex code for canvas: #4361ee
        drawStems(ctxMain, probeData, "#4361ee", w, h, false, null, null, currentK, currentShift);

        drawSpectrum();
        drawReconstruction();

        let corr = calculateCorrelation(currentK, currentShift);
        document.getElementById('corrVal').innerText = corr.toFixed(2);

        checkWinCondition(corr);
    }

    // --- ADVANCED TAB ---
    function updateAdvancedTab() {
        let cosBasis = new Float32Array(N);
        for(let n=0; n<N; n++) cosBasis[n] = Math.cos(2*Math.PI*advK*n/N);
        let A = calculateCorrelation(advK, 0);

        let sinBasis = new Float32Array(N);
        for(let n=0; n<N; n++) sinBasis[n] = Math.sin(2*Math.PI*advK*n/N);
        // Calc B manually
        let sumSin = 0;
        for(let n=0; n<N; n++) sumSin += targetSignal[n] * sinBasis[n];
        let B = sumSin * ((advK===0)?1/N:2/N);

        valA_el.innerText = A.toFixed(2);
        valB_el.innerText = B.toFixed(2);

        const w = advCosCanvas.width;
        const h = advCosCanvas.height;
        
        ctxAdvCos.clearRect(0,0,w,h);
        drawStems(ctxAdvCos, targetSignal, "#888", w, h, false, cosBasis, signalComposition); 
        drawSimpleCurve(ctxAdvCos, t => Math.cos(2*Math.PI*advK*t/N), "#3a86ff");

        ctxAdvSin.clearRect(0,0,w,h);
        drawStems(ctxAdvSin, targetSignal, "#888", w, h, false, sinBasis, signalComposition);
        drawSimpleCurve(ctxAdvSin, t => Math.sin(2*Math.PI*advK*t/N), "#ff006e");

        drawVector(A, B);
    }

    function drawSimpleCurve(ctx, func, color) {
        const w = ctx.canvas.width; 
        const h = ctx.canvas.height;
        const cy = h/2;
        const sy = h/3.5;
        
        ctx.beginPath();
        ctx.strokeStyle = color;
        ctx.lineWidth = 2;
        for(let i=0; i<=HIGH_RES; i++) {
            let x = (i/HIGH_RES)*w;
            // Apply alignment correction: t = (x/w)*N - 0.5
            let t = (x/w)*N - 0.5;
            let val = func(t);
            let y = cy - val*sy;
            if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
        }
        ctx.stroke();
    }

    function drawVector(A, B) {
        const ctx = ctxVector;
        const w = vectorCanvas.width;
        const h = vectorCanvas.height;
        const cx = w/2;
        const cy = h/2;
        const scale = Math.min(w,h)/2.5;

        ctx.clearRect(0,0,w,h);

        // Grid
        ctx.strokeStyle = "#444";
        ctx.lineWidth = 1;
        ctx.beginPath(); ctx.moveTo(cx, 0); ctx.lineTo(cx, h); ctx.stroke();
        ctx.beginPath(); ctx.moveTo(0, cy); ctx.lineTo(w, cy); ctx.stroke();
        ctx.strokeStyle = "#333";
        ctx.beginPath(); ctx.arc(cx, cy, scale, 0, Math.PI*2); ctx.stroke();

        let mag = Math.sqrt(A*A + B*B);
        let angle = Math.atan2(B, A); 
        
        // A (Cos)
        ctx.strokeStyle = "#3a86ff";
        ctx.lineWidth = 2;
        ctx.setLineDash([5,5]);
        ctx.beginPath(); ctx.moveTo(cx, cy); ctx.lineTo(cx + A*scale, cy); ctx.stroke();

        // B (Sin)
        ctx.strokeStyle = "#ff006e";
        ctx.beginPath(); ctx.moveTo(cx + A*scale, cy); ctx.lineTo(cx + A*scale, cy - B*scale); 
        ctx.stroke();
        ctx.setLineDash([]);

        // Result
        ctx.strokeStyle = "#ffd60a";
        ctx.lineWidth = 4;
        ctx.beginPath(); ctx.moveTo(cx, cy); ctx.lineTo(cx + A*scale, cy - B*scale); ctx.stroke();

        let ex = cx + A*scale;
        let ey = cy - B*scale;
        ctx.fillStyle = "#ffd60a";
        ctx.beginPath(); ctx.arc(ex, ey, 5, 0, Math.PI*2); ctx.fill();

        vecAmp_el.innerText = mag.toFixed(2);
        let deg = (angle * 180 / Math.PI).toFixed(1);
        vecPhase_el.innerText = deg;
    }

    function checkWinCondition(currentCorr) {
        let trueAmp = groundTruthSpectrum[currentK].amp;
        // Check if shift is correct (or close enough in phase space)
        // Simple logic: if correlation is very close to max amplitude
        if (currentCorr > trueAmp * 0.95 && trueAmp > 0.05) {
            recordBtn.classList.add('highlight');
            statusMsg.innerText = "–ú–∞–∫—Å–∏–º—É–º –∑–Ω–∞–π–¥–µ–Ω–æ! –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å '–ó–∞–ø–∏—Å–∞—Ç–∏'";
            statusMsg.style.color = "#4caf50";
        } else if (recordedSpectrum[currentK].recorded) {
            recordBtn.classList.remove('highlight');
            statusMsg.innerText = "–ì–∞—Ä–º–æ–Ω—ñ–∫–∞ –≤–∂–µ –∑–∞–ø–∏—Å–∞–Ω–∞.";
            statusMsg.style.color = "#888";
        } else {
            recordBtn.classList.remove('highlight');
            statusMsg.innerText = "";
        }
    }

    function recordHarmonic() {
        let corr = parseFloat(document.getElementById('corrVal').innerText);
        if (Math.abs(corr) < 0.01) {
             statusMsg.innerText = "–ö–æ—Ä–µ–ª—è—Ü—ñ—è –∑–∞–Ω–∞–¥—Ç–æ –º–∞–ª–∞ (—à—É–º).";
             statusMsg.style.color = "red";
             return;
        }
        recordedSpectrum[currentK] = {
            amp: corr,
            shift: currentShift,
            recorded: true
        };
        statusMsg.innerText = `–ì–∞—Ä–º–æ–Ω—ñ–∫–∞ k=${currentK} –∑–∞–ø–∏—Å–∞–Ω–∞!`;
        statusMsg.style.color = "#4cc9f0";
        drawAll();
    }

    function updateUIValues() {
        document.getElementById('freqVal').innerText = currentK;
        document.getElementById('shiftVal').innerText = currentShift;
    }

    // Events
    freqSlider.addEventListener('input', (e) => {
        currentK = parseInt(e.target.value);
        // Recalculate slider limits based on new K
        updateSliderLimits(currentK);
        updateUIValues();
        drawAll();
    });

    phaseSlider.addEventListener('input', (e) => {
        currentShift = parseInt(e.target.value);
        updateUIValues();
        drawAll();
    });

    advFreqSlider.addEventListener('input', (e) => {
        advK = parseInt(e.target.value);
        advFreqVal.innerText = advK;
        updateAdvancedTab();
    });

    // Start
    setTimeout(() => {
        resize();
        generateNewSignal();
    }, 100);

</script>
</body>
</html>