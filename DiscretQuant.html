<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizer: –î–∏—Å–∫—Ä–µ—Ç–∏–∑–∞—Ü—ñ—è —Ç–∞ –ê–ª—ñ–∞–π–∑—ñ–Ω–≥ (Hi-Res Audio)</title>
    <style>
        :root {
            --bg: #121212;
            --panel: #1e1e1e;
            --analog: #00e676; /* Green */
            --digital: #00bcd4; /* Cyan */
            --ghost: #ffeb3b;   /* Yellow for Aliasing */
            --error: #f44336;   /* Red */
            --text: #e0e0e0;
            --grid: #333;
        }

        body {
            font-family: 'Segoe UI', Consolas, monospace;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 { color: var(--digital); margin-bottom: 10px; text-align: center; font-weight: 300; }
        
        /* Layout */
        .container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            max-width: 1200px;
            width: 100%;
        }

        .panel {
            background: var(--panel);
            border: 1px solid #333;
            border-radius: 8px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .full-width { grid-column: span 2; }

        canvas {
            background: #000;
            border-radius: 4px;
            width: 100%;
            display: block;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.5);
        }

        /* Controls */
        .controls-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 15px;
            background: #252525;
            padding: 15px;
            border-radius: 6px;
        }

        label { display: flex; justify-content: space-between; font-size: 0.9rem; color: #ccc; margin-bottom: 5px; }
        input[type=range] { width: 100%; cursor: pointer; accent-color: var(--digital); }
        
        button {
            background: #37474f; color: white; border: 1px solid #555;
            padding: 8px 15px; border-radius: 4px; cursor: pointer; transition: 0.2s; width: 10%; margin-top: 5px;
        }
        button:hover { background: #455a64; border-color: var(--digital); }
        button.active { background: var(--digital); color: black; font-weight: bold; }
        
        /* Audio Button Style */
        #btnSound.active { background: #e91e63; color: white; border-color: #f48fb1; }

        /* Indicators */
        .status-badge {
            position: absolute; top: 10px; right: 10px;
            padding: 5px 10px; border-radius: 4px; font-size: 0.8rem; font-weight: bold;
        }
        .ok { background: rgba(76, 175, 80, 0.2); color: #66bb6a; border: 1px solid #66bb6a; }
        .bad { background: rgba(244, 67, 54, 0.2); color: #ef5350; border: 1px solid #ef5350; }

        .legend { display: flex; gap: 15px; font-size: 0.85rem; margin-bottom: 10px; color: #bbb; }
        .dot { width: 10px; height: 10px; display: inline-block; border-radius: 50%; margin-right: 5px; }

        /* Educational Details */
        details {
            background: #1a1a1a; border: 1px solid #333; border-radius: 8px; 
            margin: 0 0 20px 0; width: 100%; overflow: hidden;
        }
        summary {
            padding: 15px; cursor: pointer; background: #222; font-weight: bold; 
            color: var(--digital); display: flex; justify-content: space-between;
        }
        .theory-content { padding: 20px; line-height: 1.6; color: #ddd; }
        .math { font-family: "Times New Roman", serif; font-style: italic; background: #111; padding: 2px 5px; border-radius: 3px; }
        
    </style>
</head>
<body>

    <h1>–î–∏—Å–∫—Ä–µ—Ç–∏–∑–∞—Ü—ñ—è —ñ –∫–≤–∞–Ω—Ç—É–≤–∞–Ω–Ω—è</h1>
   
		<details open> <summary>–¢–µ–æ—Ä–µ—Ç–∏—á–Ω–∞ –¥–æ–≤—ñ–¥–∫–∞</summary>
            <div class="theory-content">
                
                <div style="border-left: 4px solid var(--digital); padding-left: 15px; margin-bottom: 20px;">
                    <h3>1. –î–∏—Å–∫—Ä–µ—Ç–∏–∑–∞—Ü—ñ—è (–ß–∞—Å)</h3>
                    <p>
                        –£ —Ä–µ–∞–ª—å–Ω–æ–º—É —Å–≤—ñ—Ç—ñ —á–∞—Å –ø–ª–∏–Ω–µ –±–µ–∑–ø–µ—Ä–µ—Ä–≤–Ω–æ (–∞–Ω–∞–ª–æ–≥–æ–≤–∏–π —Å–∏–≥–Ω–∞–ª ‚Äî –∑–µ–ª–µ–Ω–∞ –ª—ñ–Ω—ñ—è). 
                        –ö–æ–º–ø'—é—Ç–µ—Ä –Ω–µ –º–æ–∂–µ –∑–∞–ø–∏—Å—É–≤–∞—Ç–∏ –Ω–µ—Å–∫—ñ–Ω—á–µ–Ω–Ω—ñ—Å—Ç—å, —Ç–æ–º—É –≤—ñ–Ω —Ä–æ–±–∏—Ç—å –º–∏—Ç—Ç—î–≤—ñ –≤—ñ–¥–ª—ñ–∫–∏(—Å–µ–º–ø–ª–∏) —á–µ—Ä–µ–∑ —Ä—ñ–≤–Ω—ñ –ø—Ä–æ–º—ñ–∂–∫–∏ —á–∞—Å—É.
                    </p>
                    <p>
                        <b>–ß–∞—Å—Ç–æ—Ç–∞ –¥–∏—Å–∫—Ä–µ—Ç–∏–∑–∞—Ü—ñ—ó (<span class="math">Fs</span>)</b> ‚Äî —Ü–µ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Ç–∞–∫–∏—Ö –∑–Ω—ñ–º–∫—ñ–≤ –∑–∞ –æ–¥–Ω—É —Å–µ–∫—É–Ω–¥—É.
                        <br><i>–£ —Å–∏–º—É–ª—è—Ç–æ—Ä—ñ: –¶–µ —Å–∏–Ω—ñ —Ç–æ—á–∫–∏ –Ω–∞ –≥—Ä–∞—Ñ—ñ–∫—É.</i>
                    </p>
                </div>

                <div style="border-left: 4px solid var(--analog); padding-left: 15px; margin-bottom: 20px;">
                    <h3>2. –¢–µ–æ—Ä–µ–º–∞ –≤—ñ–¥–ª—ñ–∫—ñ–≤ (–¢–µ–æ—Ä–µ–º–∞ –ù–∞–π–∫–≤—ñ—Å—Ç–∞-–®–µ–Ω–Ω–æ–Ω–∞)</h3>
                    <p>
                        –¶–µ –≥–æ–ª–æ–≤–Ω–∏–π –∑–∞–∫–æ–Ω –¥–∏—Å–∫—Ä–µ—Ç–∏–∑–∞—Ü—ñ—ó. –©–æ–± —ñ–¥–µ–∞–ª—å–Ω–æ –≤—ñ–¥–Ω–æ–≤–∏—Ç–∏ —Å–∏–≥–Ω–∞–ª, —á–∞—Å—Ç–æ—Ç–∞ –≤—ñ–¥–ª—ñ–∫—ñ–≤ (—Å–µ–º–ø–ª—ñ–≤) –º–∞—î –±—É—Ç–∏ 
                        <b>–º—ñ–Ω—ñ–º—É–º —É 2 —Ä–∞–∑–∏ –≤–∏—â–æ—é</b> –∑–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É —á–∞—Å—Ç–æ—Ç—É —Å–ø–µ–∫—Ç—Ä–∞ —Å–≥–Ω–∞–ª–∞ (–Ω–∞–π—à–≤–∏–¥—à—ñ –∫–æ–ª–∏–≤–∞–Ω–Ω—è —Å–∏–≥–Ω–∞–ª—É).
                    </p>
                    <div style="background:#222; padding:10px; text-align:center; border-radius:6px; margin:10px 0;">
                        <span class="math" style="font-size:1.2em; color:var(--text)">Fs > 2 ¬∑ Fmax</span>
                    </div>
                    <p>
                        –ú–µ–∂–∞ <span class="math">Fs / 2</span> –Ω–∞–∑–∏–≤–∞—î—Ç—å—Å—è <b>–ß–∞—Å—Ç–æ—Ç–æ—é –ù–∞–π–∫–≤—ñ—Å—Ç–∞</b>. –í—Å–µ, —â–æ –≤–∏—â–µ —Ü—ñ—î—ó —á–∞—Å—Ç–æ—Ç–∏, –∫–æ–º–ø'—é—Ç–µ—Ä "–Ω–µ –∑—Ä–æ–∑—É–º—ñ—î" –ø—Ä–∞–≤–∏–ª—å–Ω–æ.
                    </p>
                </div>

                <div style="border-left: 4px solid var(--error); padding-left: 15px; margin-bottom: 20px;">
                    <h3>3. –ê–ª—ñ–∞–π–∑—ñ–Ω–≥ (–ï—Ñ–µ–∫—Ç –∫–æ–ª—ñ—Å, —â–æ –∫—Ä—É—Ç—è—Ç—å—Å—è –Ω–∞–∑–∞–¥)</h3>
                    <p>
                        –ö–æ–ª–∏ –ø–æ—Ä—É—à—É—î—Ç—å—Å—è —É–º–æ–≤–∏ —Ç–µ–æ—Ä–µ–º–∏ –≤—ñ–¥–ª—ñ–∫—ñ–≤ (<span class="math">Signal > Fs/2</span>), –≤–∏–Ω–∏–∫–∞—î —Å–ø–æ—Ç–≤–æ—Ä–µ–Ω–Ω—è. 
                        –®–≤–∏–¥–∫–∏–π —Å–∏–≥–Ω–∞–ª "–º–∞—Å–∫—É—î—Ç—å—Å—è" –ø—ñ–¥ –ø–æ–≤—ñ–ª—å–Ω–∏–π. –¶–µ –Ω–∞–∑–∏–≤–∞—î—Ç—å—Å—è <b>Aliasing</b> (–≤—ñ–¥ –∞–Ω–≥–ª. "alias" ‚Äî –ø—Å–µ–≤–¥–æ–Ω—ñ–º).
                    </p>
                    <ul style="font-size: 0.9em; color: #ccc;">
                        <li>üé¨ <b>–£ –≤—ñ–¥–µ–æ:</b> –ö–æ–ª–µ—Å–∞ –º–∞—à–∏–Ω–∏ –∫—Ä—É—Ç—è—Ç—å—Å—è —Ç–∞–∫ —à–≤–∏–¥–∫–æ, —â–æ –∫–∞–º–µ—Ä—ñ –∑–¥–∞—î—Ç—å—Å—è, –Ω—ñ–±–∏ –≤–æ–Ω–∏ –∫—Ä—É—Ç—è—Ç—å—Å—è –Ω–∞–∑–∞–¥.</li>
                        <li>üîä <b>–£ –∑–≤—É—Ü—ñ:</b> –í–∏—Å–æ–∫–∏–π –ø–∏—Å–∫ –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –Ω–∞ –Ω–∏–∑—å–∫–∏–π –≥—É–ª (—á–∞—Å—Ç–æ—Ç–∞ "–≤—ñ–¥–¥–∑–µ—Ä–∫–∞–ª—é—î—Ç—å—Å—è" –≤—ñ–¥ –º–µ–∂—ñ –ù–∞–π–∫–≤—ñ—Å—Ç–∞).</li>
                    </ul>
                    <div class="warning-box">
                        <b>–°–ø—Ä–æ–±—É–π—Ç–µ –≤ —Å–∏–º—É–ª—è—Ç–æ—Ä—ñ:</b> –ü–æ—Å—Ç–∞–≤—Ç–µ Fs = 20, –∞ Freq = 15. –í–∏ –ø–æ–±–∞—á–∏—Ç–µ (—ñ –ø–æ—á—É—î—Ç–µ), —è–∫ —á–∞—Å—Ç–æ—Ç–∞ 15 –ì—Ü –ø–µ—Ä–µ—Ç–≤–æ—Ä–∏—Ç—å—Å—è –Ω–∞ 5 –ì—Ü (–±–æ 20 - 15 = 5).
                    </div>
                </div>

                <div style="border-left: 4px solid var(--ghost); padding-left: 15px; margin-bottom: 20px;">
                    <h3>4. –ö–≤–∞–Ω—Ç—É–≤–∞–Ω–Ω—è (–ê–º–ø–ª—ñ—Ç—É–¥–∞)</h3>
                    <p>
                        –Ø–∫—â–æ –¥–∏—Å–∫—Ä–µ—Ç–∏–∑–∞—Ü—ñ—è ‚Äî —Ü–µ –Ω–∞—Ä—ñ–∑–∫–∞ –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—ñ (—á–∞—Å), —Ç–æ –∫–≤–∞–Ω—Ç—É–≤–∞–Ω–Ω—è ‚Äî —Ü–µ –Ω–∞—Ä—ñ–∑–∫–∞ –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª—ñ (–≥—É—á–Ω—ñ—Å—Ç—å).
                        –ó–Ω–∞—á–µ–Ω–Ω—è —Å–∏–≥–Ω–∞–ª—É –æ–∫—Ä—É–≥–ª—é—î—Ç—å—Å—è –¥–æ –Ω–∞–π–±–ª–∏–∂—á–æ–≥–æ —Ä—ñ–≤–Ω—è.
                    </p>
                    <p>
                        <b>–ë—ñ—Ç–Ω—ñ—Å—Ç—å (Bit Depth):</b> –í–∏–∑–Ω–∞—á–∞—î –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Å—Ö–æ–¥–∏–Ω–æ–∫.
                        <br>‚Ä¢ 1 –±—ñ—Ç = 2 —Å—Ö–æ–¥–∏–Ω–∫–∏ (—Ç—ñ–ª—å–∫–∏ –≤–∫–ª/–≤–∏–∫–ª).
                        <br>‚Ä¢ 4 –±—ñ—Ç–∏ = 16 —Å—Ö–æ–¥–∏–Ω–æ–∫ (—è–∫ —É —Ü—å–æ–º—É —Å–∏–º—É–ª—è—Ç–æ—Ä—ñ).
                        <br>‚Ä¢ 16 –±—ñ—Ç (CD —è–∫—ñ—Å—Ç—å) = 65,536 —Å—Ö–æ–¥–∏–Ω–æ–∫.
                    </p>
                    <p>–ß–∏–º –º–µ–Ω—à–µ –±—ñ—Ç, —Ç–∏–º –±—ñ–ª—å—à–µ "–∫–≤–∞–¥—Ä–∞—Ç–Ω–∏–º" —Å—Ç–∞—î —Å–∏–≥–Ω–∞–ª, —Å—Ç–≤–æ—Ä—é—é—á–∏ <b>—à—É–º –∫–≤–∞–Ω—Ç—É–≤–∞–Ω–Ω—è</b>.</p>
                </div>

                <div style="border-left: 4px solid #e040fb; padding-left: 15px; margin-bottom: 20px;">
                    <h3>5. Dithering </h3>
                    <p>
                        –ü–∞—Ä–∞–¥–æ–∫—Å: —â–æ–± –ø—Ä–∏–±—Ä–∞—Ç–∏ –Ω–µ–ø—Ä–∏—î–º–Ω—ñ —Å–ø–æ—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤—ñ–¥ "—Å—Ö–æ–¥–∏–Ω–æ–∫", –º–∏ –Ω–∞–≤–º–∏—Å–Ω–æ –¥–æ–¥–∞—î–º–æ —à—É–º.
                    </p>
                    <p>
                        <b>Dither</b> ‚Äî —Ü–µ –≤–∏–ø–∞–¥–∫–æ–≤–∏–π —à—É–º, —è–∫–∏–π –¥–æ–¥–∞—î—Ç—å—Å—è –¥–æ —Å–∏–≥–Ω–∞–ª—É <i>–ø–µ—Ä–µ–¥</i> –æ–∫—Ä—É–≥–ª–µ–Ω–Ω—è–º. –í—ñ–Ω "—Ä–æ–∑–º–∏–≤–∞—î" –ø–æ–º–∏–ª–∫—É. 
                        –ó–∞–º—ñ—Å—Ç—å –∂–æ—Ä—Å—Ç–∫–∏—Ö, —Ä–∏—Ç–º—ñ—á–Ω–∏—Ö —Å—Ö–æ–¥–∏–Ω–æ–∫ (—è–∫—ñ –∑–≤—É—á–∞—Ç—å —è–∫ –º–µ—Ç–∞–ª–µ–≤–∏–π –¥–∑–≤—ñ–Ω), –º–∏ –æ—Ç—Ä–∏–º—É—î–º–æ –º'—è–∫–µ —à–∏–ø—ñ–Ω–Ω—è, —è–∫–µ –º–æ–∑–∫—É –ª–µ–≥—à–µ —ñ–≥–Ω–æ—Ä—É–≤–∞—Ç–∏.
                    </p>
                </div>

                <div style="border-left: 4px solid #fff; padding-left: 15px;">
                    <h3>6. –§—ñ–ª—å—Ç—Ä –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è (Reconstruction Filter)</h3>
                    <p>
                        –ù–∞ –≤–∏—Ö–æ–¥—ñ –¶–ê–ü (—Ü–∏—Ñ—Ä–æ-–∞–Ω–∞–ª–æ–≥–æ–≤–æ–≥–æ –ø–µ—Ä–µ—Ç–≤–æ—Ä—é–≤–∞—á–∞) –º–∏ –º–∞—î–º–æ —Å–∏–≥–Ω–∞–ª —É –≤–∏–≥–ª—è–¥—ñ —Å—Ö–æ–¥–∏–Ω–æ–∫. 
                        –°—Ö–æ–¥–∏–Ω–∫–∏ ‚Äî —Ü–µ —Ä—ñ–∑–∫—ñ –∫—É—Ç–∏. –†—ñ–∑–∫—ñ –∫—É—Ç–∏ –ø–æ—Ä–æ–¥–∂—É—é—Ç—å —É–ª—å—Ç—Ä–∞–∑–≤—É–∫–æ–≤—ñ "–ø—Ä–∏–º–∞—Ä–∏".
                    </p>
                    <p>
                        –£ —Ä–µ–∞–ª—å–Ω—ñ–π –∞–ø–∞—Ä–∞—Ç—É—Ä—ñ —Å—Ç–æ—ó—Ç—å –∞–Ω–∞–ª–æ–≥–æ–≤–∏–π <b>Low Pass Filter (–§–ù–ß)</b>. –í—ñ–Ω –∑—Ä—ñ–∑–∞—î –≤—Å–µ –∑–∞–π–≤–µ, –∑–≥–ª–∞–¥–∂—É—é—á–∏ —Å—Ö–æ–¥–∏–Ω–∫–∏ —Ç–∞–∫, 
                        —â–æ –≤–æ–Ω–∏ –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—é—Ç—å—Å—è –Ω–∞–∑–∞–¥ —É —ñ–¥–µ–∞–ª—å–Ω—É —Å–∏–Ω—É—Å–æ—ó–¥—É (—è–∫—â–æ —Ç–µ–æ—Ä–µ–º–∞ –ù–∞–π–∫–≤—ñ—Å—Ç–∞ –¥–æ—Ç—Ä–∏–º–∞–Ω–∞). –û—Å–∫—ñ–ª—å–∫–∏ —ñ–¥–µ–∞–ª—å–Ω–∏—Ö —Ñ—ñ–ª—å—Ç—Ä—ñ–≤ (—è–∫–∏—Ö –≤–∏–º–∞–≥–∞—î —Ç–µ–æ—Ä–º–∞ –≤—ñ–¥–ª—ñ–∫—ñ–≤) –Ω–µ —ñ—Å–Ω—É—î, –∑–∞–∑–≤–∏—á–∞–π —á–∞—Å—Ç–æ—Ç—É –¥–∏—Å–∫—Ä–µ—Ç–∏–∑–∞—Ü—ñ—ó –≤–∏–±–∏—Ä–∞—é—Ç—å —ñ–∑ –∑–∞–ø–∞—Å–æ–º - —Ç–∞–∫ –∑–≤–∞–Ω–∏–π oversampling. –í–∏ –º–æ–∂–µ—Ç–µ –ø–æ—á—É—Ç–∏ –ø—Ä–∏–∑–≤—É–∫–∏ —É —Å–∏–≥–Ω–∞–ª—ñ –ø—Ä–∏ –Ω–∞–±–ª–∏–∂–µ–Ω–Ω—ñ –¥–æ –º–µ–∂—ñ –ù–∞–π–∫–≤—ñ—Å—Ç–∞ –Ω–∞–≤—ñ—Ç—å –ø—Ä–∏ —É–≤—ñ–º–∫–Ω–µ–Ω–æ–º—É —Ñ—ñ–ª—å—Ç—Ä—ñ. 
                        <br><i>–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É "–§—ñ–ª—å—Ç—Ä –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è", —â–æ–± –ø–æ—á—É—Ç–∏ —Ä—ñ–∑–Ω–∏—Ü—é.</i>
                    </p>
                </div>

            </div>
        </details>
	

    <div class="container">
        
        <div class="panel full-width">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                <h3 style="margin:0">–ß–∞—Å–æ–≤–∏–π –î–æ–º–µ–Ω:</h3>
                <div id="aliasAlert" class="status-badge ok">‚úî Nyquist OK</div>
            </div>
            
            <div class="legend">
                <span><span class="dot" style="background:var(--analog)"></span>–í—Ö—ñ–¥–Ω–∏–π</span>
                <span><span class="dot" style="background:var(--digital)"></span>Samples</span>
                <span><span class="dot" style="border: 2px dashed var(--ghost); background:transparent; box-sizing:border-box;"></span>–í—ñ–¥–Ω–æ–≤–ª–µ–Ω–∏–π</span>
            </div>

            <canvas id="timeCanvas" height="300"></canvas>

            <div class="controls-group" style="margin-top:15px;">
                <div>
                    <label>–ß–∞—Å—Ç–æ—Ç–∞ –°–∏–≥–Ω–∞–ª—É (<span id="lblFreq">3</span> Hz)
                        <span style="color:var(--analog); font-weight:bold;">F_in</span>
                    </label>
                    <input type="range" id="inFreq" min="1" max="40" step="0.5" value="3">
                </div>
                <div>
                    <label>–ß–∞—Å—Ç–æ—Ç–∞ –î–∏—Å–∫—Ä–µ—Ç–∏–∑–∞—Ü—ñ—ó (<span id="lblFs">50</span> Hz)
                        <span style="color:var(--digital); font-weight:bold;">F_s</span>
                    </label>
                    <input type="range" id="inFs" min="2" max="60" step="1" value="50">
                </div>
            </div>
            <div style="display:flex; gap:10px; justify-content:center; flex-wrap: wrap; align-items: center;">
                <button onclick="setScenario('good')">‚úÖ –Ü–¥–µ–∞–ª</button>
                <button onclick="setScenario('border')">‚ö†Ô∏è –ú–µ–∂–∞</button>
                <button onclick="setScenario('alias')">‚ùå –ê–ª—ñ–∞–π–∑—ñ–Ω–≥</button>
                <button onclick="toggleMotion()" id="btnMotion">‚ñ∂ –†—É—Ö (–§–∞–∑–∞)</button>
                
                <div style="display:flex; flex-direction:column; width:100%; gap:5px; background:#333; padding:5px; border-radius:4px;">
                    <button onclick="toggleSound()" id="btnSound" style="margin-top:0;">üîá –ó–≤—É–∫ (–í–∏–º–∫)</button>
                    <label style="font-size:0.85rem; justify-content:center; cursor:pointer; user-select:none; color:var(--ghost);">
                        <input type="checkbox" id="chkAudioFilter"> 
                        &nbsp;‚ö° –£–í–Ü–ú–ö. –§–Ü–õ–¨–¢–† 4-–≥–æ –ø–æ—Ä—è–¥–∫—É
                    </label>
                </div>
            </div>
        </div>

        <div class="panel">
            <h3>–ß–∞—Å—Ç–æ—Ç–Ω–∏–π –¥–æ–º–µ–Ω</h3>
            <canvas id="freqCanvas" height="180"></canvas>
            <div style="margin-top:10px; font-size:0.9rem;">
                <div style="display:flex; justify-content:space-between; border-bottom:1px solid #333; padding:5px 0;">
                    <span>–í—Ö—ñ–¥–Ω–∞ —á–∞—Å—Ç–æ—Ç–∞:</span>
                    <span style="color:var(--analog)" id="valRealFreq">3.0 Hz</span>
                </div>
                <div style="display:flex; justify-content:space-between; padding:5px 0;">
                    <span>–¶–∏—Ñ—Ä–æ–≤–∏–π —Å–∏–≥–Ω–∞–ª —ñ–Ω—Ç–µ—Ä–ø—Ä–∏—Ç—É—î—Ç—å—Å—è —è–∫:</span>
                    <span style="color:var(--ghost); font-weight:bold;" id="valAliasFreq">3.0 Hz</span>
                </div>
            </div>
        </div>

        <div class="panel">
            <h3>–ö–≤–∞–Ω—Ç—É–≤–∞–Ω–Ω—è & Dithering</h3>
            <canvas id="quantCanvas" height="150"></canvas>
            <div style="margin-top:15px;">
                <label>–ë–∏—Ç–Ω—ñ—Å—Ç—å (Bit Depth): <span id="lblBits">6</span> –±—ñ—Ç</label>
                <input type="range" id="inBits" min="1" max="6" step="1" value="6">
                
                <div style="display:flex; gap:10px; margin-top:10px; align-items:center;">
                    <label style="margin:0; cursor:pointer;">
                        <input type="checkbox" id="chkDither"> 
                        –£–≤—ñ–º–∫–Ω—É—Ç–∏ Dither
                    </label>
                </div>
            </div>
        </div>

    </div>

<script>
    // --- State & Config ---
    const state = {
        freq: 3,      // Signal Frequency
        fs: 50,       // Sampling Rate
        phase: 0,     // For animation
        bits: 6,      // Quantization bits
        dither: false,// Dithering enabled
        isPlaying: false,
        audioFilter: false
    };

    const consts = { maxAmp: 80 };

    // --- DOM Elements ---
    const els = {
        timeCv: document.getElementById('timeCanvas'),
        freqCv: document.getElementById('freqCanvas'),
        quantCv: document.getElementById('quantCanvas'),
        slFreq: document.getElementById('inFreq'),
        slFs: document.getElementById('inFs'),
        slBits: document.getElementById('inBits'),
        chkDither: document.getElementById('chkDither'),
        chkAudioFilter: document.getElementById('chkAudioFilter'),
        lblFreq: document.getElementById('lblFreq'),
        lblFs: document.getElementById('lblFs'),
        lblBits: document.getElementById('lblBits'),
        valReal: document.getElementById('valRealFreq'),
        valAlias: document.getElementById('valAliasFreq'),
        alert: document.getElementById('aliasAlert'),
        btnMotion: document.getElementById('btnMotion'),
        btnSound: document.getElementById('btnSound')
    };

    const ctxT = els.timeCv.getContext('2d');
    const ctxF = els.freqCv.getContext('2d');
    const ctxQ = els.quantCv.getContext('2d');

    // --- Initialization ---
    function init() {
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);
        
        els.slFreq.addEventListener('input', (e) => { state.freq = parseFloat(e.target.value); update(); });
        els.slFs.addEventListener('input', (e) => { state.fs = parseFloat(e.target.value); update(); });
        els.slBits.addEventListener('input', (e) => { state.bits = parseInt(e.target.value); update(); });
        els.chkDither.addEventListener('change', (e) => { state.dither = e.target.checked; update(); });
        els.chkAudioFilter.addEventListener('change', (e) => { state.audioFilter = e.target.checked; });

        update();
        loop();
    }

    function resizeCanvas() {
        [els.timeCv, els.freqCv, els.quantCv].forEach(cv => {
            cv.width = cv.parentElement.clientWidth - 40; 
        });
        update();
    }

    // --- Logic ---
    function getAliasedFreq(f, fs) {
        return Math.abs(f - fs * Math.round(f/fs));
    }

    function getHardQuantized(val, bits) {
        const levels = Math.pow(2, bits) - 1;
        let norm = (val + 1) / 2;
        let q = Math.round(norm * levels) / levels;
        if(q < 0) q = 0; if(q > 1) q = 1;
        return (q * 2) - 1;
    }

    // --- Drawing (Simplified for brevity, same visual logic) ---
    function drawTimeDomain() {
        const w = els.timeCv.width; const h = els.timeCv.height; const cy = h / 2;
        ctxT.clearRect(0,0,w,h);
        
        // Grid
        ctxT.strokeStyle = '#333'; ctxT.beginPath(); ctxT.moveTo(0, cy); ctxT.lineTo(w, cy); ctxT.stroke();

        const pixelsPerSec = w; 

        // Analog
        ctxT.beginPath(); ctxT.strokeStyle = '#00e676'; ctxT.lineWidth = 2;
        for(let x = 0; x < w; x++) {
            let t = x / pixelsPerSec;
            let y = cy - Math.sin(2 * Math.PI * state.freq * t + state.phase) * consts.maxAmp;
            if(x===0) ctxT.moveTo(x,y); else ctxT.lineTo(x,y);
        }
        ctxT.stroke();

        // Samples
        const periodPixels = pixelsPerSec / state.fs;
        ctxT.fillStyle = '#00bcd4'; 
        for(let x = 0; x < w; x += periodPixels) {
            let t = x / pixelsPerSec;
            let rawVal = Math.sin(2 * Math.PI * state.freq * t + state.phase);
            let y = cy - rawVal * consts.maxAmp;
            ctxT.beginPath(); ctxT.moveTo(x, cy); ctxT.lineTo(x, y);
            ctxT.strokeStyle = 'rgba(0, 188, 212, 0.3)'; ctxT.stroke();
            ctxT.beginPath(); ctxT.arc(x, y, 4, 0, Math.PI*2); ctxT.fill();
        }

        // Ghost/Reconstructed
        let fAlias = getAliasedFreq(state.freq, state.fs);
        let zone = Math.round(state.freq / state.fs);
        let drawPhase = (zone % 2 !== 0) ? -state.phase : state.phase;
        if(zone % 2 !== 0 && zone > 0) drawPhase += Math.PI;

        ctxT.beginPath(); ctxT.strokeStyle = '#ffeb3b'; ctxT.lineWidth = 2; ctxT.setLineDash([5, 5]); 
        for(let x = 0; x < w; x+=2) {
            let t = x / pixelsPerSec;
            let y = cy - Math.sin(2 * Math.PI * fAlias * t + drawPhase) * consts.maxAmp;
            if(x===0) ctxT.moveTo(x,y); else ctxT.lineTo(x,y);
        }
        ctxT.stroke(); ctxT.setLineDash([]);
    }

    function drawFrequencyDomain() {
        const w = els.freqCv.width; const h = els.freqCv.height;
        ctxF.clearRect(0,0,w,h);
        const maxViewFreq = Math.max(state.fs, state.freq * 1.2);
        const scaleX = w / maxViewFreq; const ground = h - 20;

        ctxF.strokeStyle = '#555'; ctxF.beginPath(); ctxF.moveTo(0, ground); ctxF.lineTo(w, ground); ctxF.stroke();

        const nyquistX = (state.fs / 2) * scaleX;
        ctxF.strokeStyle = '#f44336'; ctxF.beginPath(); ctxF.moveTo(nyquistX, 0); ctxF.lineTo(nyquistX, h); ctxF.stroke();
        ctxF.fillStyle = '#f44336'; ctxF.fillText("Nyquist (Fs/2)", nyquistX + 5, 15);

        const realX = state.freq * scaleX;
        ctxF.fillStyle = '#00e676'; ctxF.fillRect(realX - 3, ground - 80, 6, 80);

        const aliasFreq = getAliasedFreq(state.freq, state.fs);
        if (Math.abs(aliasFreq - state.freq) > 0.1) {
             const aliasX = aliasFreq * scaleX;
             ctxF.fillStyle = 'rgba(255, 235, 59, 0.7)'; ctxF.fillRect(aliasX - 5, ground - 50, 10, 50);
             ctxF.beginPath(); ctxF.strokeStyle = '#777'; 
             ctxF.moveTo(realX, ground-40); ctxF.lineTo(aliasX, ground-40); ctxF.stroke();
        }
    }

    function drawQuantization() {
        const w = els.quantCv.width; const h = els.quantCv.height; const cy = h/2; const amp = h/2 - 10;
        ctxQ.clearRect(0,0,w,h);
        const pixelsPerSec = w;
        
        ctxQ.beginPath(); ctxQ.strokeStyle = state.dither ? 'rgba(50, 50, 50, 0.5)' : '#00bcd4'; ctxQ.lineWidth = 2;
        let prevY = 0;
        for(let x=0; x<w; x++) {
            let t = x / pixelsPerSec;
            let raw = Math.sin(2 * Math.PI * 1 * t + state.phase);
            let hardQ = getHardQuantized(raw, state.bits);
            let y = cy - hardQ * amp;
            if(x===0) ctxQ.moveTo(x, y); else { ctxQ.lineTo(x, prevY); ctxQ.lineTo(x, y); }
            prevY = y;
        }
        ctxQ.stroke();

        if (state.dither) {
            const levels = Math.pow(2, state.bits) - 1;
            const stepSizeNorm = 2 / levels;
            ctxQ.fillStyle = '#00e5ff'; 
            for(let x=0; x<w; x+=2) { 
                let t = x / pixelsPerSec;
                let raw = Math.sin(2 * Math.PI * 1 * t + state.phase);
                let lowBitVal = getHardQuantized(raw, state.bits);
                let noise = (Math.random() - 0.5) * stepSizeNorm;
                let y = cy - (lowBitVal + noise) * amp;
                ctxQ.fillRect(x, y, 2, 2);
            }
        }
    }

    function update() {
        els.lblFreq.innerText = state.freq.toFixed(1);
        els.lblFs.innerText = state.fs.toFixed(0);
        els.lblBits.innerText = state.bits;
        els.valReal.innerText = state.freq.toFixed(1) + " Hz";
        
        const aliasF = getAliasedFreq(state.freq, state.fs);
        els.valAlias.innerText = aliasF.toFixed(1) + " Hz";

        if (state.freq > state.fs / 2) {
            els.alert.className = "status-badge bad"; els.alert.innerText = "‚ö†Ô∏è ALIASING DETECTED";
            els.valAlias.style.color = "#ffeb3b";
        } else {
            els.alert.className = "status-badge ok"; els.alert.innerText = "‚úî Nyquist OK";
            els.valAlias.style.color = "#555";
        }
        if(!state.isPlaying) { drawTimeDomain(); drawFrequencyDomain(); drawQuantization(); }
    }

    function loop() {
        if(state.isPlaying) {
            state.phase += 0.005 * state.freq; //0.05
            drawTimeDomain(); drawFrequencyDomain(); drawQuantization();
        }
        requestAnimationFrame(loop);
    }

    function toggleMotion() {
        state.isPlaying = !state.isPlaying;
        els.btnMotion.classList.toggle('active');
        els.btnMotion.innerText = state.isPlaying ? "‚è∏ –°—Ç–æ–ø" : "‚ñ∂ –†—É—Ö (–§–∞–∑–∞)";
        if(!state.isPlaying) update(); 
    }

    window.setScenario = (type) => {
        if(type === 'good') { state.freq = 3; state.fs = 50; els.slFreq.value = 3; els.slFs.value = 50; } 
        else if (type === 'border') { state.freq = 20; state.fs = 41; els.slFreq.value = 20; els.slFs.value = 41; } 
        else if (type === 'alias') { state.freq = 35; state.fs = 40; els.slFreq.value = 35; els.slFs.value = 40; }
        state.phase = 0; update();
    };

    // ==========================================
    // IMPROVED AUDIO SYNTHESIS LOGIC (Hi-Res Filter)
    // ==========================================
    let audioCtx = null;
    let audioGain = null;
    let scriptNode = null;
    let isSoundOn = false;

    let audPhase = 0;
    let sampleHoldTimer = 0;
    let lastSampledValue = 0;

    // Filter State (Cascaded 4-stage filter)
    let f1 = 0, f2 = 0, f3 = 0, f4 = 0;

    function toggleSound() {
        if(!isSoundOn) {
            if(!audioCtx) {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                audioCtx = new AudioContext();
                audioGain = audioCtx.createGain();
                audioGain.gain.value = 0.1;
                audioGain.connect(audioCtx.destination);
                // Buffer size 4096 for compatibility, though higher latency
                scriptNode = audioCtx.createScriptProcessor(4096, 0, 1);
                scriptNode.onaudioprocess = processAudio;
                scriptNode.connect(audioGain);
            }
            // Reset filter state to avoid "pop"
            f1=0; f2=0; f3=0; f4=0; lastSampledValue=0;
            
            audioCtx.resume();
            els.btnSound.classList.add('active');
            els.btnSound.innerText = "üîä –ó–≤—É–∫ (–£–≤—ñ–º–∫)";
            isSoundOn = true;
        } else {
            audioCtx.suspend();
            els.btnSound.classList.remove('active');
            els.btnSound.innerText = "üîá –ó–≤—É–∫ (–í–∏–º–∫)";
            isSoundOn = false;
        }
    }

    function processAudio(e) {
        const output = e.outputBuffer.getChannelData(0);
        const sysSampleRate = audioCtx.sampleRate;
        
        // Simulation params
        const simSignalFreq = state.freq * 100; // e.g. 3Hz -> 300Hz
        const simSampleRate = state.fs * 100;   // e.g. 50Hz -> 5000Hz
        
        const simSamplePeriod = 1 / simSampleRate;
        const dt = 1 / sysSampleRate;
        const levels = Math.pow(2, state.bits) - 1;
        const stepSizeNorm = 2 / levels;

        // --- FILTER COEFFICIENT CALCULATION ---
        // We want a cutoff frequency slightly below Nyquist (Fs/2)
        // to aggressively remove the steps.
        const cutoffFreq = (simSampleRate / 2) * 0.9; 
        
        // RC Filter constant
        const rc = 1.0 / (2 * Math.PI * cutoffFreq);
        const alpha = dt / (rc + dt);

        for (let i = 0; i < output.length; i++) {
            // 1. Generate Pure Analog Signal
            audPhase += simSignalFreq * dt;
            if(audPhase > 1) audPhase -= 1;
            let analogValue = Math.sin(2 * Math.PI * audPhase);

            // 2. Sample & Hold (ADC + DAC process)
            sampleHoldTimer += dt;
            if (sampleHoldTimer >= simSamplePeriod) {
                sampleHoldTimer -= simSamplePeriod;
                
                let valToQuantize = analogValue;
                // Add Dither noise before quantization if enabled
                if (state.dither) valToQuantize += (Math.random() - 0.5) * stepSizeNorm;
                
                // Quantize (reduce bit depth)
                lastSampledValue = getHardQuantized(valToQuantize, state.bits);
            }

            // 3. Output Stage
            if (state.audioFilter) {
                // Apply 4-Stage Cascaded Low Pass Filter (approx 24dB/octave)
                // This turns the "square" steps into a smooth wave
                f1 += alpha * (lastSampledValue - f1);
                f2 += alpha * (f1 - f2);
                f3 += alpha * (f2 - f3);
                f4 += alpha * (f3 - f4);
                
                output[i] = f4;
            } else {
                // Raw Output (Stepwise) - hear the quantization and aliasing noise clearly
                output[i] = lastSampledValue;
                // Sync filter state so it doesn't jump when toggled
                f1 = f2 = f3 = f4 = lastSampledValue;
            }
        }
    }

    init();
</script>
</body>
</html>