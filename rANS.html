<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale-1.0">
    <title>–°–∏–º—É–ª—è—Ç–æ—Ä rANS (v4: –ö–æ—Ä–µ–∫—Ç–Ω–∏–π –∞–Ω–∞–ª—ñ–∑)</title>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" id="MathJax-script" async></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.6;
            background-color: #f8f9fa;
            color: #333;
            max-width: 900px;
            margin: 20px auto;
            padding: 20px;
        }
        h1, h2, h3 {
            color: #0056b3;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 5px;
        }
        textarea {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
        }
        button {
            background-color: #28a745;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background-color: #218838; }
        button:disabled { background-color: #c0c0c0; cursor: not-allowed; }
        #btnBack, #btnForward { background-color: #007bff; }
        #btnBack:hover, #btnForward:hover { background-color: #0056b3; }
        #btnRunToMid, #btnRunToFinal { background-color: #6c757d; }
        #btnRunToMid:hover, #btnRunToFinal:hover { background-color: #5a6268; }
        #stepControls { margin-top: 10px; }
        .step-display {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            margin-top: 20px;
            min-height: 150px;
        }
        .step-display h3 { margin-top: 0; }
        #stepDescription {
            background-color: #e6f7ff;
            border: 1px solid #b3e0ff;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
            font-size: 1.1em;
            font-weight: bold;
        }
        #currentState {
            background-color: #fff8e1;
            border: 1px solid #ffecb3;
            padding: 10px;
            margin-top: 15px;
            border-radius: 5px;
            word-wrap: break-word;
            font-family: "Courier New", Courier, monospace;
            font-size: 1.1em;
        }
        #stepCalculation {
            font-family: "Courier New", Courier, monospace;
            font-size: 1.1em;
            line-height: 1.8;
            padding: 10px;
            background-color: #f4f4f4;
            border-radius: 4px;
            overflow-x: auto;
        }
        .analysis, .theory-box {
            background-color: #f9f9f9;
            border: 1px solid #e5e5e5;
            padding: 15px;
            margin-top: 20px;
            border-radius: 8px;
        }
        .analysis {
            background-color: #fff8e1;
            border-color: #ffecb3;
        }
        .analysis ul { margin-top: 0; padding-left: 20px; }
        .analysis li { margin-bottom: 5px; }
        .analysis-calc {
            font-family: "Courier New", Courier, monospace;
            font-size: 0.9em;
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 4px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }

        /* –°—Ç–∏–ª—ñ –¥–ª—è MathJax */
        .theory-box {
            font-family: Georgia, "Times New Roman", Times, serif; 
            font-size: 1.1em;
            line-height: 1.7;
        }
        .theory-box h3, .theory-box h2 {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }
		th.sortable {
    cursor: pointer;
    user-select: none;
}
th.sortable:hover {
    background-color: #e8e8e8;
}
.sort-indicator {
    float: right;
    color: #999;
    font-size: 0.8em;
}
    </style>
</head>
<body>

   
    <h3>–ö–æ–¥—É–≤–∞–Ω–Ω—è rANS</h3>

    <label for="inputText">–í–≤–µ–¥—ñ—Ç—å —Ñ—Ä–∞–∑—É:</label>
    <textarea id="inputText" rows="2">to be or not to be</textarea>
    
    <button onclick="runSimulation()">–ü–æ–±—É–¥—É–≤–∞—Ç–∏ —Ç–∞–±–ª–∏—Ü—é —á–∞—Å—Ç–æ—Ç —ñ —Å–ª–æ—Ç—ñ–≤</button>

    <div id="stepControls" style="display: none;">
        <button id="btnBack" onclick="stepBackward()" disabled>‚¨ÖÔ∏è –ù–∞–∑–∞–¥</button>
        <button id="btnForward" onclick="stepForward()">–í–ø–µ—Ä–µ–¥ ‚û°Ô∏è</button>
        <button id="btnRunToMid" onclick="">–î–æ –∫—ñ–Ω—Ü—è –∫–æ–¥—É–≤–∞–Ω–Ω—è ‚è≠Ô∏è</button>
        <button id="btnRunToFinal" onclick="">–î–æ —Ñ—ñ–Ω–∞–ª—É üèÅ</button>
    </div>
	
    <div id="results">
        <div id="freqTable"></div>
        <div id="stepDescription">–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–ü–æ–±—É–¥—É–≤–∞—Ç–∏ –°–∏–º—É–ª—è—Ü—ñ—é".</div>
        <div class="step-display" style="display: none;">
            <h3 id="stepHeader"></h3>
            <div id="currentState"></div>
            <h3 style="margin-top: 15px;">–†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫:</h3>
            <div id="stepCalculation"></div>
        </div>
        
        <div id="analysisContainer" class="analysis" style="display: none;">
            </div>
    </div>
    
    <div id="verification" style="font-weight: bold; font-size: 1.2em; margin-top: 15px;"></div>

    <div class="theory-box" style="display: none;">
        <h2>üìñ –¢–µ–æ—Ä–µ—Ç–∏—á–Ω–∞ –¥–æ–≤—ñ–¥–∫–∞: Asymmetric Numeral Systems (ANS)</h2>

        <h3>–ü—Ä–∏–Ω—Ü–∏–ø –∫–æ–¥—É–≤–∞–Ω–Ω—è rANS</h3>
        <p>
            Asymmetric Numeral Systems (ANS) ‚Äî —Ü–µ —Å—ñ–º–µ–π—Å—Ç–≤–æ –µ–Ω—Ç—Ä–æ–ø—ñ–π–Ω–∏—Ö –º–µ—Ç–æ–¥—ñ–≤ –∫–æ–¥—É–≤–∞–Ω–Ω—è, —â–æ, –ø–æ–¥—ñ–±–Ω–æ –¥–æ –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–Ω–æ–≥–æ –∫–æ–¥—É–≤–∞–Ω–Ω—è, –¥–æ—Å—è–≥–∞—é—Ç—å –µ–Ω—Ç—Ä–æ–ø—ñ–π–Ω–æ—ó –º–µ–∂—ñ —Å—Ç–∏—Å–Ω–µ–Ω–Ω—è.
            –°–∏–º—É–ª—è—Ç–æ—Ä –¥–µ–º–æ–Ω—Å—Ç—Ä—É—î –≤–∞—Ä—ñ–∞–Ω—Ç <b>rANS (range ANS)</b>.
        </p>
        <p>
            –í –æ—Å–Ω–æ–≤—ñ rANS –ª–µ–∂–∏—Ç—å –æ–ø–µ—Ä–∞—Ü—ñ—è –Ω–∞–¥ —î–¥–∏–Ω–∏–º <b>—Ü—ñ–ª–∏–º —á–∏—Å–ª–æ–º-—Å—Ç–∞–Ω–æ–º \(x\)</b>. –ö–æ–∂–µ–Ω –∫—Ä–æ–∫ –∫–æ–¥—É–≤–∞–Ω–Ω—è –∞–±–æ –¥–µ–∫–æ–¥—É–≤–∞–Ω–Ω—è –æ–Ω–æ–≤–ª—é—î —Ü–µ–π —Å—Ç–∞–Ω.
        </p>
        <p>
            <b>–ü–æ–∑–Ω–∞—á–µ–Ω–Ω—è:</b> –£ —Ñ–æ—Ä–º—É–ª–∞—Ö –Ω–∏–∂—á–µ —Ç–∞ –≤ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫–∞—Ö —Å–∏–º—É–ª—è—Ç–æ—Ä–∞, <code>//</code> –æ–∑–Ω–∞—á–∞—î —Ü—ñ–ª–æ—á–∏—Å–µ–ª—å–Ω–µ –¥—ñ–ª–µ–Ω–Ω—è (–∞–Ω–≥–ª. <i>floor division</i>), –∞ <code>%</code> ‚Äî –æ–ø–µ—Ä–∞—Ü—ñ—é –≤–∑—è—Ç—Ç—è –æ—Å—Ç–∞—á—ñ (<i>modulo</i>).
        </p>

        <ul>
            <li>
                <strong>–ö–æ–¥—É–≤–∞–Ω–Ω—è \(C(x, s)\) (–≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è —É –∑–≤–æ—Ä–æ—Ç–Ω—å–æ–º—É –ø–æ—Ä—è–¥–∫—É):</strong>
                <p>
                    –©–æ–± –¥–æ–¥–∞—Ç–∏ —Å–∏–º–≤–æ–ª \(s\) –¥–æ –ø–æ—Ç–æ—á–Ω–æ–≥–æ —Å—Ç–∞–Ω—É \(x\), –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è —Ñ–æ—Ä–º—É–ª–∞:
                </p>
                $$x_{\text{new}} = (x \mathbin{//} L_s) \cdot M + \text{bias}_s + (x \mathbin{\%} L_s)$$
            </li>
            <li>
                <strong>–î–µ–∫–æ–¥—É–≤–∞–Ω–Ω—è \(D(x)\) (–≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è —É –ø—Ä—è–º–æ–º—É –ø–æ—Ä—è–¥–∫—É):</strong>
                <ol>
                    <li>
                        –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è "—Å–ª–æ—Ç–∞" –∑–∞ —Å—Ç–∞–Ω–æ–º: 
                        \(\text{slot} = x \mathbin{\%} M\)
                    </li>
                    <li>
                        –ü–æ—à—É–∫ —Å–∏–º–≤–æ–ª—É \(s\), —â–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î —Å–ª–æ—Ç—É (—Ç–æ–±—Ç–æ \(\text{bias}_s \le \text{slot} < \text{bias}_s + L_s\)).
                    </li>
                    <li>
                        –í—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ —Å—Ç–∞–Ω—É:
                        $$x_{\text{prev}} = (x \mathbin{//} M) \cdot L_s + \text{slot} - \text{bias}_s$$
                    </li>
                </ol>
            </li>
        </ul>

   <summary style="cursor: pointer; font-weight: bold; font-size: 1.1em; color: #0056b3;">
       –ß–æ–º—É —Ü–µ –ø—Ä–∞—Ü—é—î?
    </summary>

<p>
     <b>–¶–µ –ø—Ä–∞—Ü—é—î, —Ç–æ–º—É —â–æ —Ñ–æ—Ä–º—É–ª–∏ ANS ‚Äî —Ü–µ –ø—Ä–æ—Å—Ç–æ –¥—É–∂–µ —Ö–∏—Ç—Ä–∏–π —Å–ø–æ—Å—ñ–±
    –≤–∏–∫–æ–Ω–∞—Ç–∏ –º–Ω–æ–∂–µ–Ω–Ω—è \(x_{\text{new}} \approx x \cdot (1/P(s))\),
    –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –ª–∏—à–µ —Ü—ñ–ª–æ—á–∏—Å–µ–ª—å–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó.</b>
</p>
<p>
    –ê "–º–∞–≥—ñ—è" –ø–æ–ª—è–≥–∞—î –≤ —Ç–æ–º—É, —â–æ "–≤–∞—Ä—Ç—ñ—Å—Ç—å" (—É –±—ñ—Ç–∞—Ö) –º–Ω–æ–∂–µ–Ω–Ω—è –Ω–∞ \(1/P(s)\) ‚Äî
    —Ü–µ <i>—Ç–æ—á–Ω–æ</i> \(\log_2(1/P(s))\), —â–æ —î <b>–≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è–º –µ–Ω—Ç—Ä–æ–ø—ñ—ó (—ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó)</b>,
    —è–∫—É –Ω–µ—Å–µ —Å–∏–º–≤–æ–ª \(s\).
</p>

<h3 style="font-size: 1.2em; border-bottom: 1px solid #ccc;">
    1. –ì–æ–ª–æ–≤–Ω–∞ –Ü–¥–µ—è: –ú–Ω–æ–∂–µ–Ω–Ω—è —Ç–∞ –ï–Ω—Ç—Ä–æ–ø—ñ—è
</h3>
<p>
    –£—è–≤—ñ—Ç—å, —â–æ –≤–∞—à —Å—Ç–∞–Ω \(x\) ‚Äî —Ü–µ —á–∏—Å–ª–æ, —è–∫–µ –∑–±–µ—Ä—ñ–≥–∞—î –≤—Å—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é. –©–æ–±
    –¥–æ–¥–∞—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —Å–∏–º–≤–æ–ª \(s\) (—è–∫–∏–π –º–∞—î –π–º–æ–≤—ñ—Ä–Ω—ñ—Å—Ç—å \(P(s)\)),
    –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ <i>–∑–±—ñ–ª—å—à–∏—Ç–∏</i> \(x\) –ø—Ä–æ–ø–æ—Ä—Ü—ñ–π–Ω–æ –¥–æ –∫—ñ–ª—å–∫–æ—Å—Ç—ñ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó,
    —è–∫—É –Ω–µ—Å–µ \(s\).
</p>
<p>
    –ö—ñ–ª—å–∫—ñ—Å—Ç—å —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó, —è–∫—É –Ω–µ—Å–µ \(s\), –¥–æ—Ä—ñ–≤–Ω—é—î:
    \(I(s) = \log_2(1/P(s))\) –±—ñ—Ç.
</p>
<p>
    –©–æ–± –¥–æ–¥–∞—Ç–∏ \(I(s)\) –±—ñ—Ç, –Ω–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–∫–æ–Ω–∞—Ç–∏:
    \(x_{\text{new}} = x \cdot 2^{I(s)} = x \cdot 2^{\log_2(1/P(s))} = x \cdot (1/P(s))\)
</p>
<p>
    <b>–¶–µ —ñ —î —Ç–µ–æ—Ä–µ—Ç–∏—á–Ω–∏–π —ñ–¥–µ–∞–ª:</b>
</p>
$$x_{\text{new}} \approx x \cdot \frac{1}{P(s)}$$
<p>
    –Ø–∫—â–æ \(P(s) = 0.5\) (50%), —Ç–æ \(x_{\text{new}} \approx x \cdot 2\). –ú–∏ –¥–æ–¥–∞–ª–∏ 1 –±—ñ—Ç.<br>
    –Ø–∫—â–æ \(P(s) = 0.125\) (12.5%), —Ç–æ \(x_{\text{new}} \approx x \cdot 8\). –ú–∏ –¥–æ–¥–∞–ª–∏ 3 –±—ñ—Ç–∏.
</p>

<h3 style="font-size: 1.2em; border-bottom: 1px solid #ccc;">
    2. –ê–ø—Ä–æ–∫—Å–∏–º–∞—Ü—ñ—è: –Ø–∫ ANS —Ü–µ —Ä–æ–±–∏—Ç—å
</h3>
<p>
    –ü—Ä–æ–±–ª–µ–º–∞ –≤ —Ç–æ–º—É, —â–æ \(P(s)\) ‚Äî —Ü–µ –¥—Ä—ñ–±. –ú–∏ –Ω–µ –º–æ–∂–µ–º–æ –º–Ω–æ–∂–∏—Ç–∏ –Ω–∞
    \(1/P(s)\) —É —Ü—ñ–ª–∏—Ö —á–∏—Å–ª–∞—Ö. rANS –≤–∏—Ä—ñ—à—É—î —Ü–µ, –∞–ø—Ä–æ–∫—Å–∏–º—É—é—á–∏ –π–º–æ–≤—ñ—Ä–Ω–æ—Å—Ç—ñ:
</p>
$$P(s) \approx \frac{L_s}{M}$$
<p>
    (–¥–µ \(L_s\) ‚Äî –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Å–ª–æ—Ç—ñ–≤, \(M\) ‚Äî –æ—Å–Ω–æ–≤–∞, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ 1024)
</p>
<p>
    –¢–µ–ø–µ—Ä –Ω–∞—à–∞ —ñ–¥–µ–∞–ª—å–Ω–∞ —Ñ–æ—Ä–º—É–ª–∞ \(x_{\text{new}} \approx x \cdot (1/P(s))\)
    –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –Ω–∞:
</p>
$$x_{\text{new}} \approx x \cdot \frac{1}{(L_s / M)} \implies x_{\text{new}} \approx x \cdot \frac{M}{L_s}$$
<p>
    –û—Ç–∂–µ, <b>–≤—Å–µ, —â–æ —Ä–æ–±–ª—è—Ç—å —Ñ–æ—Ä–º—É–ª–∏ ANS, ‚Äî —Ü–µ –Ω–∞–º–∞–≥–∞—é—Ç—å—Å—è —è–∫–æ–º–æ–≥–∞ —Ç–æ—á–Ω—ñ—à–µ
    –æ–±—á–∏—Å–ª–∏—Ç–∏ \(x \cdot (M / L_s)\), –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –ª–∏—à–µ —Ü—ñ–ª–æ—á–∏—Å–µ–ª—å–Ω—ñ
    –æ–ø–µ—Ä–∞—Ü—ñ—ó <code>//</code>, <code>%</code> —Ç–∞ <code>+</code>.</b>
</p>

<h3 style="font-size: 1.2em; border-bottom: 1px solid #ccc;">
    3. –Ø–∫ —Å–∞–º–µ —Ñ–æ—Ä–º—É–ª–∏ –≤–∏–∫–æ–Ω—É—é—Ç—å —Ü–µ –º–Ω–æ–∂–µ–Ω–Ω—è?
</h3>
<p>
    –ü–æ–¥–∏–≤–∏–º–æ—Å—è –Ω–∞ —Ñ–æ—Ä–º—É–ª—É –∫–æ–¥—É–≤–∞–Ω–Ω—è:
</p>
$$x_{\text{new}} = (x \mathbin{//} L_s) \cdot M + \text{bias}_s + (x \mathbin{\%} L_s)$$
<p>
    –í–æ–Ω–∞ —Ä–æ–∑–±–∏–≤–∞—î \(x\) –Ω–∞ –¥–≤—ñ —á–∞—Å—Ç–∏–Ω–∏, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ "—Å–∏—Å—Ç–µ–º—É —á–∏—Å–ª–µ–Ω–Ω—è"
    –∑ –æ—Å–Ω–æ–≤–æ—é \(L_s\):
</p>
<ul>
    <li><code>x // L_s</code> ‚Äî "—Å—Ç–∞—Ä—à—ñ —Ä–æ–∑—Ä—è–¥–∏" (–∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ–≤–Ω–∏—Ö –±–ª–æ–∫—ñ–≤ –ø–æ \(L_s\))</li>
    <li><code>x % L_s</code> ‚Äî "–º–æ–ª–æ–¥—à—ñ —Ä–æ–∑—Ä—è–¥–∏" (–∑–∞–ª–∏—à–æ–∫, –≤—ñ–¥ 0 –¥–æ \(L_s-1\))</li>
</ul>
<p>
    –ü–æ —Å—É—Ç—ñ, \(x = (x \mathbin{//} L_s) \cdot L_s + (x \mathbin{\%} L_s)\).
    –ü—ñ–¥—Å—Ç–∞–≤–∏–º–æ —Ü–µ –≤ –Ω–∞—à—É "—ñ–¥–µ–∞–ª—å–Ω—É" —Ñ–æ—Ä–º—É–ª—É \(x \cdot (M / L_s)\):
</p>
$$x_{\text{new}} \approx \left( (x \mathbin{//} L_s) \cdot L_s + (x \mathbin{\%} L_s) \right) \cdot \frac{M}{L_s}$$
<p>–†–æ–∑–∫—Ä–∏—î–º–æ –¥—É–∂–∫–∏:</p>
$$x_{\text{new}} \approx (x \mathbin{//} L_s) \cdot L_s \cdot \frac{M}{L_s} + (x \mathbin{\%} L_s) \cdot \frac{M}{L_s}$$
<p>\(L_s\) —Å–∫–æ—Ä–æ—á—É—î—Ç—å—Å—è:</p>
$$x_{\text{new}} \approx \underbrace{(x \mathbin{//} L_s) \cdot M}_{\text{–ß–∞—Å—Ç–∏–Ω–∞ 1}} + \underbrace{(x \mathbin{\%} L_s) \cdot \frac{M}{L_s}}_{\text{–ß–∞—Å—Ç–∏–Ω–∞ 2}}$$
<p>–ü–æ—Ä—ñ–≤–Ω—è–π—Ç–µ —Ü–µ –∑ —Ä–µ–∞–ª—å–Ω–æ—é —Ñ–æ—Ä–º—É–ª–æ—é ANS:</p>
$$x_{\text{new}} = \underbrace{(x \mathbin{//} L_s) \cdot M}_{\text{–ß–∞—Å—Ç–∏–Ω–∞ 1}} + \underbrace{\text{bias}_s + (x \mathbin{\%} L_s)}_{\text{–ê–ø—Ä–æ–∫—Å–∏–º–∞—Ü—ñ—è –ß–∞—Å—Ç–∏–Ω–∏ 2}}$$
<blockquote style="background: #fff8e1; border-left: 5px solid #ffecb3; padding: 10px;">
    <ul>
        <li><b>–ß–∞—Å—Ç–∏–Ω–∞ 1</b> –∑–±—ñ–≥–∞—î—Ç—å—Å—è —ñ–¥–µ–∞–ª—å–Ω–æ.</li>
        <li>–†–µ–∞–ª—å–Ω–∞ —Ñ–æ—Ä–º—É–ª–∞ ANS –∑–∞–º—ñ–Ω—é—î "–Ω–µ–∑—Ä—É—á–Ω—É" –¥—Ä–æ–±–æ–≤—É <b>–ß–∞—Å—Ç–∏–Ω—É 2</b> –Ω–∞
            \(\text{bias}_s + (x \mathbin{\%} L_s)\).</li>
    </ul>
    –¶–µ —ñ —î –≤—Å—è —Å—É—Ç—å: \(\text{bias}_s + (x \mathbin{\%} L_s)\) ‚Äî —Ü–µ
    —Ü—ñ–ª–æ—á–∏—Å–µ–ª—å–Ω–∞ –∞–ø—Ä–æ–∫—Å–∏–º–∞—Ü—ñ—è –¥–ª—è \((x \mathbin{\%} L_s) \cdot (M / L_s)\).
</blockquote>



        <h3>–ê–Ω–∞–ª–æ–≥—ñ—è –∑ –ê—Ä–∏—Ñ–º–µ—Ç–∏—á–Ω–∏–º –ö–æ–¥—É–≤–∞–Ω–Ω—è–º (AC)</h3>
        <p>
            ANS —Ç–∞ AC —î —Å–ø–æ—Ä—ñ–¥–Ω–µ–Ω–∏–º–∏, –æ—Å–∫—ñ–ª—å–∫–∏ –æ–±–∏–¥–≤–∞ –º–µ—Ç–æ–¥–∏ –¥–æ—Å—è–≥–∞—é—Ç—å –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ —Å—Ç–∏—Å–Ω–µ–Ω–Ω—è, –Ω–∞–±–ª–∏–∂–∞—é—á–∏—Å—å –¥–æ –µ–Ω—Ç—Ä–æ–ø—ñ–π–Ω–æ—ó –º–µ–∂—ñ.
        </p>
        <ul>
            <li>
                <b>–ê—Ä–∏—Ñ–º–µ—Ç–∏—á–Ω–µ –∫–æ–¥—É–≤–∞–Ω–Ω—è (AC)</b> –æ–ø–µ—Ä—É—î —ñ–Ω—Ç–µ—Ä–≤–∞–ª–æ–º <code>[low, high)</code>,
                —è–∫–∏–π –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—î –ø–æ—Ç–æ—á–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è.
            </li>
            <li>
                <b>ANS</b> –æ–ø–µ—Ä—É—î <b>–æ–¥–Ω–∏–º —Ü—ñ–ª–∏–º —á–∏—Å–ª–æ–º-—Å—Ç–∞–Ω–æ–º \(x\)</b>, —è–∫–µ –∞–∫—É–º—É–ª—é—î –≤
                —Å–æ–±—ñ –≤—Å—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è.
            </li>
        </ul>
        <p>
            –ü—Ä–æ—Ü–µ—Å —Ä–µ-–Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—ó –≤ AC (–∑—Å—É–≤ –±—ñ—Ç—ñ–≤, –∫–æ–ª–∏ –º–µ–∂—ñ —ñ–Ω—Ç–µ—Ä–≤–∞–ª—É –∑–±—ñ–≥–∞—é—Ç—å—Å—è)
            –º–∞—î –ø—Ä—è–º–∏–π –∞–Ω–∞–ª–æ–≥ —É –ø–æ—Ç–æ–∫–æ–≤—ñ–π —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó ANS.
        </p>
        
        <h3>–ü—Ä–∞–∫—Ç–∏—á–Ω–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è (–†–µ-–Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è)</h3>
        <p>
            –¶–µ–π —Å–∏–º—É–ª—è—Ç–æ—Ä –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î <code>BigInt</code> (–¥–æ–≤–≥—É –∞—Ä–∏—Ñ–º–µ—Ç–∏–∫—É), —â–æ–± –¥–æ–∑–≤–æ–ª–∏—Ç–∏
            —Å—Ç–∞–Ω—É \(x\) —Ä–æ—Å—Ç–∏ –¥–æ–≤—ñ–ª—å–Ω–æ. –¶–µ —Ä–æ–±–∏—Ç—å—Å—è –≤–∏–∫–ª—é—á–Ω–æ –∑ –¥–∏–¥–∞–∫—Ç–∏—á–Ω–æ—é –º–µ—Ç–æ—é –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—ó
            "—á–∏—Å—Ç–æ—ó" –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏.
        </p>
        <p>
            <b>–£ —Ä–µ–∞–ª—å–Ω–∏—Ö –∫–æ–¥–µ–∫–∞—Ö (–ø—Ä–∞–∫—Ç–∏—á–Ω–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è) –¥–æ–≤–≥–∞ –∞—Ä–∏—Ñ–º–µ—Ç–∏–∫–∞ –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è.</b>
            –ó–∞–º—ñ—Å—Ç—å —Ü—å–æ–≥–æ –∑–∞—Å—Ç–æ—Å–æ–≤—É—î—Ç—å—Å—è <b>–ø–æ—Ç–æ–∫–æ–≤–∏–π (streaming) —Ä–µ–∂–∏–º</b>:
        </p>
        <p>
            –°—Ç–∞–Ω \(x\) –æ–±–º–µ–∂–µ–Ω–∏–π —Ä–æ–∑—Ä—è–¥–Ω—ñ—Å—Ç—é –º–∞—à–∏–Ω–∏ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, 32 –∞–±–æ 64 –±—ñ—Ç–∏).
            –ö–æ–ª–∏ –≤ –ø—Ä–æ—Ü–µ—Å—ñ –∫–æ–¥—É–≤–∞–Ω–Ω—è \(x\) —Å—Ç–∞—î –∑–∞–Ω–∞–¥—Ç–æ –≤–µ–ª–∏–∫–∏–º —ñ –≤–∏—Ö–æ–¥–∏—Ç—å –∑–∞ –º–µ–∂—ñ
            —Ü—å–æ–≥–æ –¥—ñ–∞–ø–∞–∑–æ–Ω—É, –π–æ–≥–æ "–Ω–∞–¥–ª–∏—à–∫–æ–≤—ñ" –±—ñ—Ç–∏ "–≤–∏—à—Ç–æ–≤—Ö—É—é—Ç—å—Å—è" —É –≤–∏—Ö—ñ–¥–Ω–∏–π –±—ñ—Ç–æ–≤–∏–π –ø–æ—Ç—ñ–∫. –ü—ñ–¥ —á–∞—Å –¥–µ–∫–æ–¥—É–≤–∞–Ω–Ω—è
            —Ü—ñ –±—ñ—Ç–∏ –∑—á–∏—Ç—É—é—Ç—å—Å—è –Ω–∞–∑–∞–¥ —É —Å—Ç–∞–Ω \(x\), –∫–æ–ª–∏ –≤—ñ–Ω —Å—Ç–∞—î –∑–∞–Ω–∞–¥—Ç–æ –º–∞–ª–∏–º.
            –¶–µ–π –ø—Ä–æ—Ü–µ—Å –Ω–∞–∑–∏–≤–∞—î—Ç—å—Å—è <b>—Ä–µ-–Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—î—é</b> —ñ –¥–æ–∑–≤–æ–ª—è—î ANS –ø—Ä–∞—Ü—é–≤–∞—Ç–∏
            –Ω–∞–¥–∑–≤–∏—á–∞–π–Ω–æ —à–≤–∏–¥–∫–æ.
        </p>

        <h3>–°—Ñ–µ—Ä–∏ –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è</h3>
        <p>
            –ó–∞–≤–¥—è–∫–∏ –ø–æ—î–¥–Ω–∞–Ω–Ω—é –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ (–Ω–∞ —Ä—ñ–≤–Ω—ñ AC) —Ç–∞ —à–≤–∏–¥–∫–æ—Å—Ç—ñ (–Ω–∞–±–ª–∏–∂–µ–Ω—ñ–π –¥–æ
            –∫–æ–¥—É–≤–∞–Ω–Ω—è –•–∞—Ñ—Ñ–º–∞–Ω–∞), ANS —Å—Ç–∞–≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–º –¥–µ-—Ñ–∞–∫—Ç–æ —É –±–∞–≥–∞—Ç—å–æ—Ö —Å—É—á–∞—Å–Ω–∏—Ö
            –∞–ª–≥–æ—Ä–∏—Ç–º–∞—Ö —Å—Ç–∏—Å–Ω–µ–Ω–Ω—è.
        </p>
        <ul>
            <li><b>Zstandard (zstd)</b> ‚Äî —É–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º —Å—Ç–∏—Å–Ω–µ–Ω–Ω—è –≤—ñ–¥ Facebook, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î ANS.</li>
            <li><b>LZFSE</b> ‚Äî –∞–ª–≥–æ—Ä–∏—Ç–º —Å—Ç–∏—Å–Ω–µ–Ω–Ω—è –≤—ñ–¥ Apple, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –≤ macOS —Ç–∞ iOS.</li>
            <li><b>CRAM</b> ‚Äî —Ñ–æ—Ä–º–∞—Ç —Å—Ç–∏—Å–Ω–µ–Ω–Ω—è –≥–µ–Ω–æ–º–Ω–∏—Ö –¥–∞–Ω–∏—Ö (—á–∞—Å—Ç–∏–Ω–∞ SAMtools).</li>
        </ul>
        
        <h3>–ê–Ω–∞–ª—ñ–∑ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ (–ï–Ω—Ç—Ä–æ–ø—ñ—è)</h3>
        <p>
            –ï–Ω—Ç—Ä–æ–ø—ñ—è \(H\) –¥–∂–µ—Ä–µ–ª–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –≤–∏–∑–Ω–∞—á–∞—î —Ç–µ–æ—Ä–µ—Ç–∏—á–Ω–∏–π –º—ñ–Ω—ñ–º—É–º
            –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –±—ñ—Ç, –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏—Ö –¥–ª—è –∫–æ–¥—É–≤–∞–Ω–Ω—è –æ–¥–Ω–æ–≥–æ —Å–∏–º–≤–æ–ª—É –≤ —Å–µ—Ä–µ–¥–Ω—å–æ–º—É:
        </p>
        $$H = -\sum_{i} p_i \log_2(p_i)$$
        <p>
            –°–µ—Ä–µ–¥–Ω—è –¥–æ–≤–∂–∏–Ω–∞ –∫–æ–¥—É \(L\), —è–∫—É –¥–æ—Å—è–≥–∞—î ANS, —Ä–æ–∑—Ä–∞—Ö–æ–≤—É—î—Ç—å—Å—è —è–∫ –∑–∞–≥–∞–ª—å–Ω–∞
            –∫—ñ–ª—å–∫—ñ—Å—Ç—å –±—ñ—Ç, –¥–æ–¥–∞–Ω–∏—Ö –¥–æ —Å—Ç–∞–Ω—É, –ø–æ–¥—ñ–ª–µ–Ω–∞ –Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Å–∏–º–≤–æ–ª—ñ–≤:
            \(\text{bits} = \log_2(x_{\text{final}}) - \log_2(x_{\text{initial}})\).
            –°–µ—Ä–µ–¥–Ω—è –¥–æ–≤–∂–∏–Ω–∞ \(L = \text{bits} / N\).
        </p>
        <p>
            ANS –Ω–∞–±–ª–∏–∂–∞—î—Ç—å—Å—è –¥–æ \(H\) –∑–Ω–∞—á–Ω–æ –∫—Ä–∞—â–µ –∑–∞ –•–∞—Ñ—Ñ–º–∞–Ω–∞, –æ—Å–∫—ñ–ª—å–∫–∏ \(L\) –Ω–µ
            –æ–±–º–µ–∂–µ–Ω–∞ —Ü—ñ–ª–∏–º —á–∏—Å–ª–æ–º –±—ñ—Ç. –Ñ–¥–∏–Ω–∏–º –¥–∂–µ—Ä–µ–ª–æ–º –Ω–µ–µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ —î –ø–æ—Ö–∏–±–∫–∞
            –∞–ø—Ä–æ–∫—Å–∏–º–∞—Ü—ñ—ó –π–º–æ–≤—ñ—Ä–Ω–æ—Å—Ç–µ–π \(P(s)\) —á–µ—Ä–µ–∑ –¥–∏—Å–∫—Ä–µ—Ç–Ω—ñ —Å–ª–æ—Ç–∏ \(L_s / M\).
        </p>
        
        <h3>–í–∏–±—ñ—Ä –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ \(M\)</h3>
        <p>
            –ü–∞—Ä–∞–º–µ—Ç—Ä \(M\) (—É —Å–∏–º—É–ª—è—Ç–æ—Ä—ñ \(M=1024 = 2^{10}\)) ‚Äî —Ü–µ "–æ—Å–Ω–æ–≤–∞ —Å–∏—Å—Ç–µ–º–∏ —á–∏—Å–ª–µ–Ω–Ω—è",
            –∞–±–æ –∑–∞–≥–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å "—Å–ª–æ—Ç—ñ–≤", –Ω–∞ —è–∫—ñ –¥—ñ–ª—è—Ç—å—Å—è –≤—Å—ñ –π–º–æ–≤—ñ—Ä–Ω–æ—Å—Ç—ñ.
            –ô–æ–≥–æ –≤–∏–±—ñ—Ä —î –∫–æ–º–ø—Ä–æ–º—ñ—Å–æ–º:
        </p>
        <ul>
            <li>
                <b>–ë—ñ–ª—å—à–µ \(M\)</b>: –¢–æ—á–Ω—ñ—à–∞ –∞–ø—Ä–æ–∫—Å–∏–º–∞—Ü—ñ—è –π–º–æ–≤—ñ—Ä–Ω–æ—Å—Ç–µ–π (–≤–∏—Å–æ–∫–∞
                –µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å —Å—Ç–∏—Å–Ω–µ–Ω–Ω—è, –±–ª–∏–∑—å–∫–∞ –¥–æ \(H\)).
            </li>
            <li>
                <b>–ú–µ–Ω—à–µ \(M\)</b>: –®–≤–∏–¥—à—ñ –æ–±—á–∏—Å–ª–µ–Ω–Ω—è, –º–µ–Ω—à—ñ —Ç–∞–±–ª–∏—Ü—ñ —Å—Ç–∞–Ω—É.
            </li>
        </ul>
        <p>
            –£ –ø—Ä–∞–∫—Ç–∏—á–Ω–∏—Ö —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è—Ö \(M\) <b>–∑–∞–≤–∂–¥–∏ —î —Å—Ç—É–ø–µ–Ω–µ–º –¥–≤—ñ–π–∫–∏</b>
            (–Ω–∞–ø—Ä., \(2^{10}\), \(2^{12}\)). –¶–µ –¥–æ–∑–≤–æ–ª—è—î –∑–∞–º—ñ–Ω–∏—Ç–∏ –≤—ñ–¥–Ω–æ—Å–Ω–æ –ø–æ–≤—ñ–ª—å–Ω—ñ
            –æ–ø–µ—Ä–∞—Ü—ñ—ó <code>// M</code> —Ç–∞ <code>% M</code> –Ω–∞ –Ω–∞–¥–∑–≤–∏—á–∞–π–Ω–æ —à–≤–∏–¥–∫—ñ
            –±—ñ—Ç–æ–≤—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó –∑—Å—É–≤—É (<code>&gt;&gt;</code>) —Ç–∞ –º–∞—Å–∫—É–≤–∞–Ω–Ω—è (<code>&amp;</code>).
        </p>
		<details>
    <summary style="cursor: pointer; font-weight: bold; font-size: 1.1em; color: #0056b3;">
        üìñ –°—É—á–∞—Å–Ω—ñ –Ω–∞–ø—Ä—è–º–∫–∏: –ù–µ–π—Ä–æ–Ω–Ω–µ —Å—Ç–∏—Å–Ω–µ–Ω–Ω—è (–†–æ–∑–≥–æ—Ä–Ω—É—Ç–∏)
    </summary>

    <div style="padding-top: 15px;">
        <p>
            –°—É—á–∞—Å–Ω—ñ –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è —É —Å—Ç–∏—Å–Ω–µ–Ω–Ω—ñ –±–µ–∑ –≤—Ç—Ä–∞—Ç –∑–æ—Å–µ—Ä–µ–¥–∂–µ–Ω—ñ –Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ
            –Ω–µ–π—Ä–æ–Ω–Ω–∏—Ö –º–µ—Ä–µ–∂ –¥–ª—è –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è <b>–º–æ–¥–µ–ª—ñ –ø–µ—Ä–µ–¥–±–∞—á–µ–Ω–Ω—è</b>. –ë—É–¥—å-—è–∫–∏–π
            –∫–æ–º–ø—Ä–µ—Å–æ—Ä —Å–∫–ª–∞–¥–∞—î—Ç—å—Å—è –∑ –¥–≤–æ—Ö —á–∞—Å—Ç–∏–Ω: –º–æ–¥–µ–ª—ñ, —â–æ –ø–µ—Ä–µ–¥–±–∞—á–∞—î
            –π–º–æ–≤—ñ—Ä–Ω—ñ—Å—Ç—å –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ —Å–∏–º–≤–æ–ª—É, —Ç–∞ –µ–Ω—Ç—Ä–æ–ø—ñ–π–Ω–æ–≥–æ –∫–æ–¥–µ—Ä–∞, —â–æ
            –∫–æ–¥—É—î —Ü–µ–π —Å–∏–º–≤–æ–ª –Ω–∞ –æ—Å–Ω–æ–≤—ñ –π–æ–≥–æ –π–º–æ–≤—ñ—Ä–Ω–æ—Å—Ç—ñ.
        </p>
        <p>
            –ö–ª–∞—Å–∏—á–Ω—ñ –º–µ—Ç–æ–¥–∏ (LZ, PPM) –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å –ø—Ä–æ—Å—Ç—ñ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω—ñ –º–æ–¥–µ–ª—ñ.
            –ù–æ–≤—ñ—Ç–Ω—ñ –ø—ñ–¥—Ö–æ–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å –≥–ª–∏–±–æ–∫—ñ –Ω–µ–π—Ä–æ–Ω–Ω—ñ –º–µ—Ä–µ–∂—ñ (RNN,
            –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–µ—Ä–∏) –¥–ª—è –∑–Ω–∞—á–Ω–æ —Ç–æ—á–Ω—ñ—à–æ–≥–æ –∞–Ω–∞–ª—ñ–∑—É –∫–æ–Ω—Ç–µ–∫—Å—Ç—É —Ç–∞
            –ø–µ—Ä–µ–¥–±–∞—á–µ–Ω–Ω—è –π–º–æ–≤—ñ—Ä–Ω–æ—Å—Ç–µ–π. –ß–∏–º —Ç–æ—á–Ω—ñ—à–µ –ø–µ—Ä–µ–¥–±–∞—á–µ–Ω–Ω—è, —Ç–∏–º –º–µ–Ω—à–µ
            "—ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó" (–µ–Ω—Ç—Ä–æ–ø—ñ—ó) –Ω–µ—Å–µ –≤ —Å–æ–±—ñ —Ä–µ–∞–ª—å–Ω–∏–π —Å–∏–º–≤–æ–ª, —ñ —Ç–∏–º –º–µ–Ω—à–µ
            –±—ñ—Ç –ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–ª—è –π–æ–≥–æ –∫–æ–¥—É–≤–∞–Ω–Ω—è.
        </S>

        <blockquote style="background: #f4f4f4; border-left: 5px solid #ccc; padding: 10px; margin-left: 20px;">
            –ù–∞–ø—Ä–∏–∫–ª–∞–¥, –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç—É "...–≤–ø–∞–≤ –±—ñ–ª–∏–π, –ø—É—Ö–Ω–∞—Å—Ç–∏–π —Å–Ω_":
            <pre style="font-family: 'Courier New', monospace; margin-top: 5px; margin-bottom: 0;">
–π–º–æ–≤—ñ—Ä–Ω–æ—Å—Ç—ñ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ —Å–∏–º–≤–æ–ª—É
—ñ ‚Äî 99.9%
–∞ ‚Äî 0.01%
–∫ ‚Äî 0.005%
...—ñ —Ç.–¥.</pre>
        </blockquote>
        <p style="margin-top: 15px;">
            –¶—ñ–∫–∞–≤–æ, —â–æ –≤ —è–∫–æ—Å—Ç—ñ –µ–Ω—Ç—Ä–æ–ø—ñ–π–Ω–æ–≥–æ –∫–æ–¥–µ—Ä–∞ –≤ —Ç–∞–∫–∏—Ö —Å–∏—Å—Ç–µ–º–∞—Ö
            –º–∞–π–∂–µ –∑–∞–≤–∂–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è <b>ANS (Asymmetric Numeral Systems)</b> ‚Äî
            —Å–∞–º–µ —Ç–æ–π –∞–ª–≥–æ—Ä–∏—Ç–º, —â–æ –¥–µ–º–æ–Ω—Å—Ç—Ä—É—î—Ç—å—Å—è —É —Ü—å–æ–º—É —Å–∏–º—É–ª—è—Ç–æ—Ä—ñ.
            –ô–æ–≥–æ –∑–¥–∞—Ç–Ω—ñ—Å—Ç—å –∫–æ–¥—É–≤–∞—Ç–∏ —Å–∏–º–≤–æ–ª–∏ –¥—Ä–æ–±–æ–≤–æ—é –∫—ñ–ª—å–∫—ñ—Å—Ç—é –±—ñ—Ç, —â–æ
            —ñ–¥–µ–∞–ª—å–Ω–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –ø–µ—Ä–µ–¥–±–∞—á–µ–Ω—ñ–π –Ω–µ–π—Ä–æ–º–µ—Ä–µ–∂–µ—é –π–º–æ–≤—ñ—Ä–Ω–æ—Å—Ç—ñ,
            —Ä–æ–±–∏—Ç—å –π–æ–≥–æ –Ω–µ–∑–∞–º—ñ–Ω–Ω–∏–º –¥–ª—è —Ü—ñ—î—ó –∑–∞–¥–∞—á—ñ.
        </p>
        <p>
            –ì–æ–ª–æ–≤–Ω–∏–º –Ω–µ–¥–æ–ª—ñ–∫–æ–º –Ω–µ–π—Ä–æ–Ω–Ω–æ–≥–æ —Å—Ç–∏—Å–Ω–µ–Ω–Ω—è, —è–∫–∏–π –ø–æ–∫–∏ —â–æ
            –∑–∞–≤–∞–∂–∞—î –π–æ–≥–æ –º–∞—Å–æ–≤–æ–º—É –≤–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—é, —î –Ω–∞–¥–∑–≤–∏—á–∞–π–Ω–æ –≤–∏—Å–æ–∫—ñ
            –æ–±—á–∏—Å–ª—é–≤–∞–ª—å–Ω—ñ –≤–∏—Ç—Ä–∞—Ç–∏ (–ø–æ–≤—ñ–ª—å–Ω–∞ —à–≤–∏–¥–∫—ñ—Å—Ç—å) –ø–æ—Ä—ñ–≤–Ω—è–Ω–æ –∑
            —Ç—Ä–∞–¥–∏—Ü—ñ–π–Ω–∏–º–∏ –º–µ—Ç–æ–¥–∞–º–∏.
        </p>

        <table style="width:100%; border-collapse: collapse; margin-top: 15px;">
            <thead>
                <tr style="background-color: #f2f2f2;">
                    <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">–ú–µ—Ç–æ–¥</th>
                    <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">–°—Ç—É–ø—ñ–Ω—å —Å—Ç–∏—Å–Ω–µ–Ω–Ω—è</th>
                    <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">–®–≤–∏–¥–∫—ñ—Å—Ç—å</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td style="border: 1px solid #ddd; padding: 8px;">LZ4</td>
                    <td style="border: 1px solid #ddd; padding: 8px;">–ù–∏–∑—å–∫–∏–π</td>
                    <td style="border: 1px solid #ddd; padding: 8px;">‚ö°‚ö°‚ö°‚ö°‚ö° (–ù–∞–¥—à–≤–∏–¥–∫–∏–π)</td>
                </tr>
                <tr>
                    <td style="border: 1px solid #ddd; padding: 8px;">Zstandard (zstd)</td>
                    <td style="border: 1px solid #ddd; padding: 8px;">–í–∏—Å–æ–∫–∏–π</td>
                    <td style="border: 1px solid #ddd; padding: 8px;">‚ö°‚ö°‚ö° (–î—É–∂–µ —à–≤–∏–¥–∫–∏–π)</td>
                </tr>
                <tr>
                    <td style="border: 1px solid #ddd; padding: 8px;">7z (LZMA)</td>
                    <td style="border: 1px solid #ddd; padding: 8px;">–î—É–∂–µ –≤–∏—Å–æ–∫–∏–π</td>
                    <td style="border: 1px solid #ddd; padding: 8px;">‚ö° (–ü–æ–≤—ñ–ª—å–Ω–∏–π)</td>
                </tr>
                <tr>
                    <td style="border: 1px solid #ddd; padding: 8px;"><b>–ù–µ–π—Ä–æ–Ω–Ω–∏–π (NN + ANS)</b></td>
                    <td style="border: 1px solid #ddd; padding: 8px;"><b>–ù–∞–π–∫—Ä–∞—â–∏–π</b></td>
                    <td style="border: 1px solid #ddd; padding: 8px;">üê¢ (–ù–∞–¥–∑–≤–∏—á–∞–π–Ω–æ –ø–æ–≤—ñ–ª—å–Ω–∏–π)</td>
                </tr>
            </tbody>
        </table>
    </div>
</details>
    </div>




    <script>
        // --- –ì–ª–æ–±–∞–ª—å–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ ---
        const M_NORM_BITS = 10;
        const M_NORM = 1 << M_NORM_BITS; // 1024
        const M_NORM_N = BigInt(M_NORM);

        // --- –ì–ª–æ–±–∞–ª—å–Ω–∏–π —Å—Ç–∞–Ω —Å–∏–º—É–ª—è—Ü—ñ—ó ---
        let symbols = {};
        let allSteps = [];
        let currentStep = -1;
        let originalText = "";
        let midStepIndex = -1;
        let finalStepIndex = -1;
		let sortConfig = {
		key: 'freq', // –ö–æ–ª–æ–Ω–∫–∞ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º
		dir: 'desc'   // –ù–∞–ø—Ä—è–º–æ–∫ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º
		};
		
		/**
 * –û–Ω–æ–≤–ª—é—î —Å—Ç–∞–Ω —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è —ñ –ø–µ—Ä–µ–º–∞–ª—å–æ–≤—É—î —Ç–∞–±–ª–∏—Ü—é.
 * –í–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –∑ onclick –Ω–∞ <th>.
 */
function sortTable(key) {
    if (sortConfig.key === key) {
        // –¢–∞ —Å–∞–º–∞ –∫–æ–ª–æ–Ω–∫–∞, –∑–º—ñ–Ω—é—î–º–æ –Ω–∞–ø—Ä—è–º–æ–∫
        sortConfig.dir = (sortConfig.dir === 'asc') ? 'desc' : 'asc';
    } else {
        // –ù–æ–≤–∞ –∫–æ–ª–æ–Ω–∫–∞, —Å–æ—Ä—Ç—É—î–º–æ –∑–∞ –∑—Ä–æ—Å—Ç–∞–Ω–Ω—è–º
        sortConfig.key = key;
        sortConfig.dir = 'asc';
    }
    
    // –ü–µ—Ä–µ–º–∞–ª—å–æ–≤—É—î–º–æ —Ç–∞–±–ª–∏—Ü—é –∑ –ø–æ—Ç–æ—á–Ω–∏–º–∏ –¥–∞–Ω–∏–º–∏ 'symbols'
    // (—Ü–µ –Ω–µ –∑–∞–ø—É—Å–∫–∞—î –ø–æ–≤–Ω—É —Å–∏–º—É–ª—è—Ü—ñ—é)
    renderFreqTable();
}

/**
 * –î–æ–ø–æ–º—ñ–∂–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è (‚ñ≤/‚ñº).
 */
function getSortIndicator(key) {
    if (sortConfig.key !== key) {
        return '<span class="sort-indicator">‚Üï</span>'; // –ù–µ–∞–∫—Ç–∏–≤–Ω–∞
    }
    return (sortConfig.dir === 'asc')
        ? '<span class="sort-indicator">‚ñ≤</span>' // –ó–∞ –∑—Ä–æ—Å—Ç–∞–Ω–Ω—è–º
        : '<span class="sort-indicator">‚ñº</span>'; // –ó–∞ —Å–ø–∞–¥–∞–Ω–Ω—è–º
}
		
        function runSimulation() {
            originalText = document.getElementById('inputText').value;
            if (originalText.length === 0) {
                alert("–í–≤–µ–¥—ñ—Ç—å —Ç–µ–∫—Å—Ç.");
                return;
            }
            
            // 0. –°–∫–∏–¥–∞–Ω–Ω—è —Å—Ç–∞–Ω—É
            allSteps = [];
            currentStep = -1;
            midStepIndex = -1;
            finalStepIndex = -1;
            document.getElementById('freqTable').innerHTML = '';
            document.getElementById('verification').innerHTML = '';
            document.querySelector('.theory-box').style.display = 'block';
            document.querySelector('.step-display').style.display = 'none';
            document.getElementById('analysisContainer').style.display = 'none';
			sortConfig = { key: 'freq', dir: 'desc' }; // –°–∫–∏–¥–∞–Ω–Ω—è —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è
            // 1. –ß–∞—Å—Ç–æ—Ç–∏
            const freqMap = {};
            for (const char of originalText) {
                freqMap[char] = (freqMap[char] || 0) + 1;
            }

            // 2. –ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è
            symbols = normalizeFrequencies(freqMap, originalText.length);
            
            // 3. –ü–æ–±—É–¥–æ–≤–∞ —Ç–∞–±–ª–∏—Ü—ñ
            buildTables();
            
            // 4. –í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è —Ç–∞–±–ª–∏—Ü—ñ
            renderFreqTable();
            
            // 5. –ü–æ–±—É–¥–æ–≤–∞ –∫—Ä–æ–∫—ñ–≤ —Å–∏–º—É–ª—è—Ü—ñ—ó
            buildSimulationSteps(originalText);

            // 6. –ê–∫—Ç–∏–≤–∞—Ü—ñ—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è
            document.getElementById('stepControls').style.display = 'block';
            document.getElementById('btnRunToMid').onclick = () => jumpToStep(midStepIndex);
            document.getElementById('btnRunToFinal').onclick = () => jumpToStep(finalStepIndex);
            
            renderStep(0); // –í—ñ–¥–æ–±—Ä–∞–∑–∏—Ç–∏ –ø–µ—Ä—à–∏–π –∫—Ä–æ–∫
        }

        // --- –§—É–Ω–∫—Ü—ñ—ó –ø–æ–±—É–¥–æ–≤–∏ —Å–∏–º—É–ª—è—Ü—ñ—ó ---
        
        function normalizeFrequencies(freqMap, totalChars) {
            let syms = {};
            let currentSum = 0;
            const keys = Object.keys(freqMap);
            
            for (let i = 0; i < keys.length; i++) {
                const char = keys[i];
                const prob = freqMap[char] / totalChars;
                const L = (i === keys.length - 1)
                    ? M_NORM - currentSum
                    : Math.max(1, Math.floor(prob * M_NORM));

                syms[char] = { L: L, L_n: BigInt(L), prob: prob, freq: freqMap[char] };
                currentSum += L;
            }
            
            if (currentSum > M_NORM) {
                let maxL = -1, maxChar = null;
                for(const char in syms) {
                    if (syms[char].L > maxL) (maxL = syms[char].L, maxChar = char);
                }
                const diff = currentSum - M_NORM;
                syms[maxChar].L -= diff;
                syms[maxChar].L_n = BigInt(syms[maxChar].L);
            }
            return syms;
        }

        function buildTables() {
            let currentBias = 0;
            const sortedChars = Object.keys(symbols).sort();
            for (const char of sortedChars) {
                symbols[char].bias = currentBias;
                symbols[char].bias_n = BigInt(currentBias);
                currentBias += symbols[char].L;
            }
        }

        function buildSimulationSteps(text) {
            let x_n = M_NORM_N;
            
            allSteps.push({
                type: 'init',
                x_before: x_n, x_after: x_n,
                desc: `–ü–æ—á–∞—Ç–∫–æ–≤–∏–π —Å—Ç–∞–Ω. –ü–æ—á–∏–Ω–∞—î–º–æ –∫–æ–¥—É–≤–∞–Ω–Ω—è (—É –∑–≤–æ—Ä–æ—Ç–Ω—å–æ–º—É –ø–æ—Ä—è–¥–∫—É).`,
                calc_html: `x = ${x_n}`
            });

            // --- –ï—Ç–∞–ø –∫–æ–¥—É–≤–∞–Ω–Ω—è ---
            for (let i = text.length - 1; i >= 0; i--) {
                const char = text[i];
                const s = symbols[char];
                const x_old_n = x_n;

                const x_div_L = x_old_n / s.L_n;
                const x_mod_L = x_old_n % s.L_n;
                x_n = (x_div_L * M_NORM_N) + s.bias_n + x_mod_L;

                let calc_html = `<b>x_new = (x // L) * M + bias + (x % L)</b><br>`;
                calc_html += `x_new = (${x_old_n} // ${s.L_n}) * ${M_NORM_N} + ${s.bias_n} + (${x_old_n} % ${s.L_n})<br>`;
                calc_html += `<b>x_new = ${x_n}</b>`;

                allSteps.push({
                    type: 'encoding', char: char, x_before: x_old_n, x_after: x_n,
                    desc: `–ö–æ–¥—É—î–º–æ —Å–∏–º–≤–æ–ª '<b>${char}</b>' (–∑ –ø–æ–∑–∏—Ü—ñ—ó ${i}).`,
                    calc_html: calc_html
                });
            }
            
            const finalState = x_n;
            
            // --- –ü–µ—Ä–µ—Ö—ñ–¥ ---
            allSteps.push({
                type: 'mid', x_before: finalState, x_after: finalState,
                desc: `–ö–æ–¥—É–≤–∞–Ω–Ω—è –∑–∞–≤–µ—Ä—à–µ–Ω–æ. –ü–æ—á–∏–Ω–∞—î–º–æ –¥–µ–∫–æ–¥—É–≤–∞–Ω–Ω—è (—É –ø—Ä—è–º–æ–º—É –ø–æ—Ä—è–¥–∫—É).`,
                calc_html: `–§—ñ–Ω–∞–ª—å–Ω–∏–π —Å—Ç–∞–Ω: x = ${finalState}`
            });
            midStepIndex = allSteps.length - 1;

            // --- –ï—Ç–∞–ø –¥–µ–∫–æ–¥—É–≤–∞–Ω–Ω—è ---
            let decoded_text = '';
            for (let i = 0; i < text.length; i++) {
                const x_old_n = x_n;
                const slot_n = x_n % M_NORM_N;
                const slot = Number(slot_n);
                const { char, s } = findSymbolBySlot(slot);
                const x_div_M = x_old_n / M_NORM_N;
                x_n = (x_div_M * s.L_n) + slot_n - s.bias_n;
                decoded_text += char;

                let calc_html = `<b>slot = x % M</b> = ${x_old_n} % ${M_NORM_N} = <b>${slot_n}</b><br>`;
                calc_html += `‚ûî —à—É–∫–∞—î–º–æ —Å–∏–º–≤–æ–ª –¥–ª—è slot ${slot}... ‚ûî —Ü–µ '<b>${char}</b>'<br><br>`;
                calc_html += `<b>x_prev = (x // M) * L + slot - bias</b><br>`;
                calc_html += `x_prev = (${x_old_n} // ${M_NORM_N}) * ${s.L_n} + ${slot_n} - ${s.bias_n}<br>`;
                calc_html += `<b>x_prev = ${x_n}</b>`;
                
                allSteps.push({
                    type: 'decoding', char: char, x_before: x_old_n, x_after: x_n,
                    desc: `–î–µ–∫–æ–¥—É—î–º–æ —Å–∏–º–≤–æ–ª ${i+1}/${text.length}. –î–µ–∫–æ–¥–æ–≤–∞–Ω–æ: "${decoded_text}"`,
                    calc_html: calc_html
                });
            }

            // --- –§—ñ–Ω–∞–ª ---
            allSteps.push({
                type: 'final', x_before: x_n, x_after: x_n,
                desc: `–î–µ–∫–æ–¥—É–≤–∞–Ω–Ω—è –∑–∞–≤–µ—Ä—à–µ–Ω–æ.`,
                calc_html: `–û—Å—Ç–∞—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω x = ${x_n} (–º–∞—î –¥–æ—Ä—ñ–≤–Ω—é–≤–∞—Ç–∏ –ø–æ—á–∞—Ç–∫–æ–≤–æ–º—É —Å—Ç–∞–Ω—É).`
            });
            finalStepIndex = allSteps.length - 1;
        }
        
        function findSymbolBySlot(slot) {
            for (const char in symbols) {
                const s = symbols[char];
                if (slot >= s.bias && slot < s.bias + s.L) {
                    return { char, s };
                }
            }
            return null;
        }

        // --- –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Å—Ç–∞–Ω–æ–º —Ç–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ ---
        
        function jumpToStep(index) { renderStep(index); }
        function stepForward() { if (currentStep < allSteps.length - 1) renderStep(currentStep + 1); }
        function stepBackward() { if (currentStep > 0) renderStep(currentStep - 1); }

        function renderStep(index) {
            currentStep = index;
            const step = allSteps[currentStep];
            
            document.querySelector('.step-display').style.display = 'block';
            document.getElementById('stepDescription').innerHTML = `<b>–ö—Ä–æ–∫ ${currentStep + 1}/${allSteps.length}:</b> ${step.desc}`;
            
            const header = document.getElementById('stepHeader');
            if (step.type === 'encoding') header.innerHTML = `1. –ö–æ–¥—É–≤–∞–Ω–Ω—è (–°–∏–º–≤–æ–ª '<b>${step.char}</b>')`;
            else if (step.type === 'decoding') header.innerHTML = `2. –î–µ–∫–æ–¥—É–≤–∞–Ω–Ω—è (–°–∏–º–≤–æ–ª '<b>${step.char}</b>')`;
            else header.innerHTML = `–°–∏—Å—Ç–µ–º–Ω–∏–π –∫—Ä–æ–∫`;

            document.getElementById('currentState').innerHTML = `<b>–ü–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω x:</b> ${step.x_before}`;
            document.getElementById('stepCalculation').innerHTML = step.calc_html;

            document.getElementById('btnBack').disabled = (currentStep === 0);
            document.getElementById('btnForward').disabled = (currentStep === allSteps.length - 1);

            const verificationDiv = document.getElementById('verification');
            const analysisDiv = document.getElementById('analysisContainer');

            if (step.type === 'final') {
                 const success = step.x_after === allSteps[0].x_before;
                verificationDiv.innerHTML = success 
                    ? `‚úÖ –í–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—è —É—Å–ø—ñ—à–Ω–∞! –ü–æ—á–∞—Ç–∫–æ–≤–∏–π —Å—Ç–∞–Ω (${allSteps[0].x_before}) = —Ñ—ñ–Ω–∞–ª—å–Ω–∏–π —Å—Ç–∞–Ω (${step.x_after}).`
                    : `‚ùå –ü–æ–º–∏–ª–∫–∞ –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—ó! –ü–æ—á–∞—Ç–∫–æ–≤–∏–π —Å—Ç–∞–Ω (${allSteps[0].x_before}) != —Ñ—ñ–Ω–∞–ª—å–Ω–∏–π —Å—Ç–∞–Ω (${step.x_after}).`;
                verificationDiv.style.color = success ? "green" : "red";
                
                // –ó–∞–ø—É—Å–∫ –∞–Ω–∞–ª—ñ–∑—É
                analysisDiv.innerHTML = renderAnalysis();
                analysisDiv.style.display = 'block';

            } else {
                verificationDiv.innerHTML = '';
                analysisDiv.style.display = 'none';
            }
        }

      
	  /**
 * –û–Ω–æ–≤–ª–µ–Ω–æ: –í—ñ–¥–æ–±—Ä–∞–∂–∞—î —Ç–∞–±–ª–∏—Ü—é —Å–∏–º–≤–æ–ª—ñ–≤,
 * –≤—ñ–¥—Å–æ—Ä—Ç–æ–≤–∞–Ω—É –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ global sortConfig.
 */
function renderFreqTable() {
    let html = `<h3>–¢–∞–±–ª–∏—Ü—è —Å–∏–º–≤–æ–ª—ñ–≤ (–ù–æ—Ä–º–∞–ª—ñ–∑–æ–≤–∞–Ω–∞ –Ω–∞ M = ${M_NORM})</h3>`;
    
    // –î–æ–¥–∞—î–º–æ .sortable, onclick —Ç–∞ —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä–∏ –¥–æ –∑–∞–≥–æ–ª–æ–≤–∫—ñ–≤
    html += `<table><thead><tr>
        <th class="sortable" onclick="sortTable('char')">
            –°–∏–º–≤–æ–ª ${getSortIndicator('char')}
        </th>
        <th class="sortable" onclick="sortTable('freq')">
            –ß–∞—Å—Ç–æ—Ç–∞ (Freq) ${getSortIndicator('freq')}
        </th>
        <th class="sortable" onclick="sortTable('prob')">
            –ô–º–æ–≤—ñ—Ä–Ω—ñ—Å—Ç—å (P) ${getSortIndicator('prob')}
        </th>
        <th class="sortable" onclick="sortTable('L')">
            L (—Å–ª–æ—Ç–∏) ${getSortIndicator('L')}
        </th>
        <th class="sortable" onclick="sortTable('bias')">
            Bias (–∑—Å—É–≤) ${getSortIndicator('bias')}
        </th>
    </tr></thead><tbody>`;

    // 1. –ü–µ—Ä–µ—Ç–≤–æ—Ä—é—î–º–æ –æ–±'—î–∫—Ç 'symbols' –Ω–∞ –º–∞—Å–∏–≤ –¥–ª—è —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è
    let dataArray = Object.entries(symbols).map(([char, data]) => ({
        char: char,
        ...data
    }));

    // 2. –°–æ—Ä—Ç—É—î–º–æ –º–∞—Å–∏–≤ –Ω–∞ –æ—Å–Ω–æ–≤—ñ 'sortConfig'
    dataArray.sort((a, b) => {
        let valA = a[sortConfig.key];
        let valB = b[sortConfig.key];

        let comparison = 0;
        if (valA > valB) {
            comparison = 1;
        } else if (valA < valB) {
            comparison = -1;
        }
        
        return (sortConfig.dir === 'asc') ? comparison : -comparison;
    });

    // 3. –í—ñ–¥–æ–±—Ä–∞–∂–∞—î–º–æ –≤—ñ–¥—Å–æ—Ä—Ç–æ–≤–∞–Ω–∏–π –º–∞—Å–∏–≤
    if (dataArray.length === 0) {
        html += '<tr><td colspan="5">–î–∞–Ω—ñ —â–µ –Ω–µ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω—ñ.</td></tr>';
    } else {
        for (const s of dataArray) {
            html += `<tr>
                <td>'${s.char === ' ' ? ' ' : s.char}'</td>
                <td>${s.freq}</td>
                <td>${(s.prob * 100).toFixed(2)}%</td>
                <td><b>${s.L}</b> (‚âà ${(s.prob * M_NORM).toFixed(2)})</td>
                <td>${s.bias}</td>
            </tr>`;
        }
    }

    html += '</tbody></table>';
    document.getElementById('freqTable').innerHTML = html;
}

        // --- ****** –û–°–ù–û–í–ù–ê –ó–ú–Ü–ù–ê –¢–£–¢ ****** ---
        // --- –ù–æ–≤–∞, –∫–æ—Ä–µ–∫—Ç–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –∞–Ω–∞–ª—ñ–∑—É ---
        function renderAnalysis() {
            const totalChars = originalText.length;
            const uniqueChars = Object.keys(symbols).length;
            
            // 1. –†—ñ–≤–Ω–æ–º—ñ—Ä–Ω–∏–π –∫–æ–¥
            const fixedBitsPerChar = (uniqueChars > 1) ? Math.ceil(Math.log2(uniqueChars)) : 1;
            const originalBits = totalChars * fixedBitsPerChar;

            // 2. –ï–Ω—Ç—Ä–æ–ø—ñ—è (H)
            let entropy = 0;
            for (const char in symbols) {
                const prob = symbols[char].prob;
                if (prob > 0) {
                    entropy -= prob * Math.log2(prob);
                }
            }
            const theoreticalTotalBits = entropy * totalChars;

            // 3. ANS (L_actual) - –ú–∞—Ç–µ–º–∞—Ç–∏—á–Ω–æ –∫–æ—Ä–µ–∫—Ç–Ω–∏–π —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫
            // –ú–∏ —Å—É–º—É—î–º–æ *—Å–ø—Ä–∞–≤–∂–Ω—é* –≤–∞—Ä—Ç—ñ—Å—Ç—å –∫–æ–¥—É–≤–∞–Ω–Ω—è (log2(M/L))
            // –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ —Å–∏–º–≤–æ–ª—É —É –≤—Ö—ñ–¥–Ω–æ–º—É —Ä—è–¥–∫—É.
            
            let totalCompressedBits = 0;
            let calculationExplanation = '<ul>';
            
            // (A) –†–æ–∑—Ä–∞—Ö–æ–≤—É—î–º–æ –≤–∞—Ä—Ç—ñ—Å—Ç—å –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ *—Ç–∏–ø—É* —Å–∏–º–≤–æ–ª—ñ–≤ (–¥–ª—è –ø–æ—è—Å–Ω–µ–Ω–Ω—è)
            let symbolCosts = {};
            for (const char in symbols) {
                 const s = symbols[char];
                 const L = s.L;
                 const bits_for_char = Math.log2(M_NORM) - Math.log2(L);
                 symbolCosts[char] = bits_for_char;
                 
                 calculationExplanation += `
                    <li><b>'${char}' (L=${L})</b>: 
                        log‚ÇÇ(${M_NORM}) - log‚ÇÇ(${L}) = 
                        10.00 - ${Math.log2(L).toFixed(3)} = 
                        <b>${bits_for_char.toFixed(4)} –±—ñ—Ç</b>
                    </li>`;
            }
            calculationExplanation += '</ul>';

            // (B) –†–æ–∑—Ä–∞—Ö–æ–≤—É—î–º–æ *–∑–∞–≥–∞–ª—å–Ω—É* –≤–∞—Ä—Ç—ñ—Å—Ç—å, –ø—Ä–æ—Å—É–º—É–≤–∞–≤—à–∏ –ø–æ –≤—Å—å–æ–º—É —Ç–µ–∫—Å—Ç—É
            for (const char of originalText) {
                if (symbolCosts[char]) {
                    totalCompressedBits += symbolCosts[char];
                }
            }
            
            const avgLength = totalCompressedBits / totalChars;
            const efficiency = (entropy > 0 && avgLength > 0) ? (entropy / avgLength) : 1;

            // 4. –†–µ–Ω–¥–µ—Ä–∏–Ω–≥
            let html = '<h3>üìä –ê–Ω–∞–ª—ñ–∑ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ</h3>';
            
         
            html += `<p>–†–µ–∑—É–ª—å—Ç–∞—Ç ANS ‚Äî —Ü–µ <b>—Å—É–º–∞ —Ç–µ–æ—Ä–µ—Ç–∏—á–Ω–∏—Ö "–≤–∞—Ä—Ç–æ—Å—Ç–µ–π"</b> –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ —Å–∏–º–≤–æ–ª—É 
                     –≤ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—ñ. –í–∞—Ä—Ç—ñ—Å—Ç—å (—É –±—ñ—Ç–∞—Ö) –¥–ª—è —Å–∏–º–≤–æ–ª—É <code>s</code>
                     –æ–±—á–∏—Å–ª—é—î—Ç—å—Å—è –Ω–∞ –æ—Å–Ω–æ–≤—ñ –π–æ–≥–æ –∫–≤–∞–Ω—Ç–æ–≤–∞–Ω–æ—ó –π–º–æ–≤—ñ—Ä–Ω–æ—Å—Ç—ñ (<code>L/M</code>) –∑–∞ —Ñ–æ—Ä–º—É–ª–æ—é:</p>`;
            html += `<div class="analysis-calc"><b>–í–∞—Ä—Ç—ñ—Å—Ç—å(s) = log‚ÇÇ(M) - log‚ÇÇ(L[s])</b>`;
            html += calculationExplanation;
            html += `<p style="margin-top:10px; border-top: 1px solid #ccc; padding-top: 10px;">
                        <b>–ó–∞–≥–∞–ª—å–Ω–∏–π —Ä–æ–∑–º—ñ—Ä (L * N)</b> = –°—É–º–∞ –≤–∞—Ä—Ç–æ—Å—Ç–µ–π –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –∑ ${totalChars} —Å–∏–º–≤–æ–ª—ñ–≤ –≤ —Ä—è–¥–∫—É.
                     </p></div>`;
            
            html += `<h4 style="margin-top: 20px;">–ó–∞–≥–∞–ª—å–Ω—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ (–¥–ª—è ${totalChars} —Å–∏–º–≤–æ–ª—ñ–≤):</h4>`;
            html += `<ul>
                <li><b>–ï–Ω—Ç—Ä–æ–ø—ñ—è –¥–∂–µ—Ä–µ–ª–∞ (H):</b> ${entropy.toFixed(4)} –±—ñ—Ç/—Å–∏–º–≤–æ–ª</li>
                <li><b>–°–µ—Ä–µ–¥–Ω—è –¥–æ–≤–∂–∏–Ω–∞ (ANS):</b> ${avgLength.toFixed(4)} –±—ñ—Ç/—Å–∏–º–≤–æ–ª</li>
                <li><b>–°–µ—Ä–µ–¥–Ω—è –¥–æ–≤–∂–∏–Ω–∞ (–†—ñ–≤–Ω–æ–º—ñ—Ä–Ω–∏–π –∫–æ–¥):</b> ${fixedBitsPerChar} –±—ñ—Ç/—Å–∏–º–≤–æ–ª</li>
            </ul>
            <h4>–ó–∞–≥–∞–ª—å–Ω–∏–π —Ä–æ–∑–º—ñ—Ä:</h4>
            <ul>
                <li><b>–¢–µ–æ—Ä–µ—Ç–∏—á–Ω–∏–π –º—ñ–Ω—ñ–º—É–º (H * N):</b> ${theoreticalTotalBits.toFixed(4)} –±—ñ—Ç</li>
                <li><b>–†–µ–∑—É–ª—å—Ç–∞—Ç ANS (L * N):</b> ${totalCompressedBits.toFixed(4)} –±—ñ—Ç</li>
                <li><b>–†—ñ–≤–Ω–æ–º—ñ—Ä–Ω–∏–π –∫–æ–¥ (Fixed * N):</b> ${originalBits} –±—ñ—Ç</li>
            </ul>
            <p>
                <b>–ï—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å (H / L_ans):</b> ${efficiency.toFixed(4)} (<b>${(efficiency * 100).toFixed(2)}%</b>)
                <br>
                <b>–í–∏—Å–Ω–æ–≤–æ–∫:</b> –†–µ–∑—É–ª—å—Ç–∞—Ç ANS (${totalCompressedBits.toFixed(4)} –±—ñ—Ç) 
                <b>—Ç—Ä–æ—Ö–∏ –≤–∏—â–∏–π</b> –∑–∞ –µ–Ω—Ç—Ä–æ–ø—ñ–π–Ω–∏–π –ª—ñ–º—ñ—Ç (${theoreticalTotalBits.toFixed(4)} –±—ñ—Ç). 
                –¶—è —Ä—ñ–∑–Ω–∏—Ü—è –≤–∏–Ω–∏–∫–∞—î —á–µ—Ä–µ–∑ –Ω–µ—Ç–æ—á–Ω—ñ—Å—Ç—å –∫–≤–∞–Ω—Ç–∏–∑–∞—Ü—ñ—ó <code>P(s)</code> —É <code>L/M</code>.
            </p>`;
            
            return html;
        }

    </script>
</body>
</html>