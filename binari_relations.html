<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>–°–∏–º—É–ª—è—Ç–æ—Ä –ë—ñ–Ω–∞—Ä–Ω–∏—Ö –í—ñ–¥–Ω–æ—à–µ–Ω—å (–õ—ñ–Ω—ñ–π–Ω–∏–π)</title>
    <style>
        :root {
            --primary: #3498db;
            --success: #2ecc71;
            --warning: #f39c12;
            --danger: #e74c3c;
            --dark: #2c3e50;
            --light: #ecf0f1;
            --bg: #f9f9f9;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            color: var(--dark);
        }

        h1 { margin-bottom: 5px; }
        .subtitle { color: #7f8c8d; margin-bottom: 20px; font-size: 0.9rem; }

        /* Layout */
        .main-layout {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
            justify-content: center;
            max-width: 1200px;
            width: 100%;
            align-items: flex-start;
        }

        .panel {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* Matrix Grid */
        .matrix-grid {
            display: grid;
            grid-template-columns: 40px repeat(3, 50px);
            grid-template-rows: 40px repeat(3, 50px);
            gap: 4px;
            margin-bottom: 10px;
        }

        .cell {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s;
            user-select: none;
        }

        .header-cell {
            font-weight: bold;
            color: var(--primary);
            cursor: default;
            font-size: 1rem;
        }

        .matrix-cell {
            background-color: var(--light);
            border: 2px solid #bdc3c7;
            color: #bdc3c7;
        }

        .matrix-cell.active {
            background-color: var(--primary);
            border-color: var(--primary);
            color: white;
            transform: scale(1.05);
            box-shadow: 0 2px 5px rgba(52, 152, 219, 0.4);
        }
        
        /* Highlights for matrix */
        .cell.diag-highlight { border-style: dashed; border-color: #95a5a6; }
        
        /* Graph Visualization */
        #graph-container {
            position: relative;
            width: 400px;
            height: 220px; /* Reduced height for linear layout */
            background: white;
            border: 1px solid #eee;
            border-radius: 12px;
        }
        
        svg { width: 100%; height: 100%; }
        
        .node-circle { 
            fill: var(--primary); 
            stroke: white; 
            stroke-width: 2px;
            transition: fill 0.3s;
        }
        .node-text { 
            fill: white; 
            font-weight: bold; 
            font-size: 16px; 
            pointer-events: none;
            font-family: monospace;
        }
        
        /* Edges */
        marker { fill: var(--dark); }
        path.edge {
            stroke: var(--dark);
            stroke-width: 2;
            fill: none;
            transition: d 0.3s ease;
        }
        path.edge:hover { stroke: var(--warning); stroke-width: 3; cursor: pointer;}
        path.edge.loop { stroke: var(--danger); }

        /* Properties Panel */
        .properties-panel {
            width: 300px;
        }

        .prop-item {
            padding: 8px 12px;
            margin-bottom: 6px;
            border-radius: 6px;
            background: #f0f3f4;
            color: #95a5a6;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
            transition: all 0.3s;
        }

        .prop-item.active {
            background: #e8f8f5; /* Light Green bg */
            color: var(--dark);
            font-weight: 600;
            border-left: 4px solid var(--success);
        }

        .prop-item .status { font-weight: bold; }

        /* Result Badge */
        .result-badge {
            margin-top: 15px;
            padding: 12px;
            background: var(--dark);
            color: white;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
            font-size: 0.9rem;
            line-height: 1.4;
            min-height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .result-badge.found {
            background: linear-gradient(135deg, #8e44ad, #c0392b); 
        }

        /* Controls */
        .presets {
            width: 100%;
            margin-top: 20px;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: center;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }
        button {
            padding: 6px 12px;
            font-size: 0.85rem;
            border: 1px solid #bdc3c7;
            border-radius: 4px;
            background: white;
            color: var(--dark);
            cursor: pointer;
            transition: all 0.2s;
        }
        button:hover { background: var(--light); border-color: var(--dark); }
        button.active-preset { background: var(--dark); color: white; border-color: var(--dark); }

        /* SPOILER / THEORY SECTION */
        .theory-section {
            max-width: 900px;
            width: 100%;
            margin-top: 30px;
            background: white;
            border-radius: 8px;
            border: 1px solid #ddd;
            overflow: hidden;
        }

        details {
            width: 100%;
        }

        summary {
            padding: 15px 20px;
            background: #f7f9fa;
            cursor: pointer;
            font-weight: bold;
            color: var(--dark);
            list-style: none; /* Hide default arrow in some browsers */
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        summary::-webkit-details-marker { display: none; }
        
        summary::after {
            content: '+'; 
            font-size: 1.5em;
            font-weight: normal;
        }
        details[open] summary::after { content: '‚àí'; }

        .theory-content {
            padding: 20px;
            line-height: 1.6;
            font-size: 0.95rem;
        }

        .theory-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        .theory-table th, .theory-table td {
            border: 1px solid #eee;
            padding: 10px;
            text-align: left;
            vertical-align: top;
        }
        .theory-table th { background: #f4f6f7; color: var(--dark); width: 20%; }
        .theory-table td { width: 40%; }
        
        code { background: #eee; padding: 2px 4px; border-radius: 3px; font-family: monospace;}

    </style>
</head>
<body>

    <h1>–õ–∞–±–æ—Ä–∞—Ç–æ—Ä—ñ—è –ë—ñ–Ω–∞—Ä–Ω–∏—Ö –í—ñ–¥–Ω–æ—à–µ–Ω—å</h1>
    <div class="subtitle">–Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∏–π —Å–∏–º—É–ª—è—Ç–æ—Ä –¥–ª—è –≤–∏–≤—á–µ–Ω–Ω—è –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç–µ–π —Ç–∞ —Ç–∏–ø—ñ–≤ –≤—ñ–¥–Ω–æ—à–µ–Ω—å</div>

    <div class="main-layout">
        
        <div class="panel">
            <div style="font-weight: bold; margin-bottom:10px;">–ú–∞—Ç—Ä–∏—Ü—è</div>
            <div class="matrix-grid" id="matrix"></div>
            <div style="font-size: 0.75rem; color: #95a5a6; text-align: center; max-width: 200px;">
                –ö–ª—ñ–∫ –ø–æ –∫–æ–º—ñ—Ä—Ü—ñ (i, j) —Å—Ç–≤–æ—Ä—é—î –¥—É–≥—É –≤—ñ–¥ i –¥–æ j.
            </div>
        </div>

        <div class="panel" id="graph-container">
            <svg id="graph-svg" viewBox="0 0 400 220">
                <defs>
                    <marker id="arrowhead" markerWidth="12" markerHeight="10" 
                    refX="27" refY="3.5" orient="auto">
                      <polygon points="0 0, 10 3.5, 0 7" fill="#2c3e50" />
                    </marker>
                    <marker id="arrowhead-loop" markerWidth="12" markerHeight="10" 
                    refX="26" refY="3.5" orient="auto">
                      <polygon points="0 0, 10 3.5, 0 7" fill="#e74c3c" />
                    </marker>
                </defs>
                
                <g id="edges-layer"></g>
                
                <g id="nodes-layer">
                    <circle cx="80" cy="110" r="18" class="node-circle" id="node-0" />
                    <text x="80" y="115" text-anchor="middle" class="node-text">a</text>

                    <circle cx="200" cy="110" r="18" class="node-circle" id="node-1" />
                    <text x="200" y="115" text-anchor="middle" class="node-text">b</text>

                    <circle cx="320" cy="110" r="18" class="node-circle" id="node-2" />
                    <text x="320" y="115" text-anchor="middle" class="node-text">c</text>
                </g>
            </svg>
        </div>

        <div class="panel properties-panel">
            <div style="font-weight: bold; margin-bottom:10px;">–í–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ</div>
            
            <div class="prop-item" id="prop-refl">
                <span>–†–µ—Ñ–ª–µ–∫—Å–∏–≤–Ω–µ (–≤—Å—ñ –ø–µ—Ç–ª—ñ)</span> <span class="status"></span>
            </div>
            <div class="prop-item" id="prop-irrefl">
                <span>–ê–Ω—Ç–∏—Ä–µ—Ñ–ª–µ–∫—Å–∏–≤–Ω–µ (–±–µ–∑ –ø–µ—Ç–µ–ª—å)</span> <span class="status"></span>
            </div>
            <div class="prop-item" id="prop-sym">
                <span>–°–∏–º–µ—Ç—Ä–∏—á–Ω–µ (–¥–≤–æ—Å—Ç–æ—Ä–æ–Ω–Ω—î)</span> <span class="status"></span>
            </div>
            <div class="prop-item" id="prop-antisym">
                <span>–ê–Ω—Ç–∏—Å–∏–º–µ—Ç—Ä–∏—á–Ω–µ (–æ–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω—î)</span> <span class="status"></span>
            </div>
            <div class="prop-item" id="prop-trans">
                <span>–¢—Ä–∞–Ω–∑–∏—Ç–∏–≤–Ω–µ (—à–ª—è—Ö–∏ —Å–∫–æ—Ä–æ—á—É—é—Ç—å—Å—è)</span> <span class="status"></span>
            </div>
            <div class="prop-item" id="prop-complete">
                <span>–ü–æ–≤–Ω–µ / –ó–≤'—è–∑–Ω–µ (–≤—Å—ñ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—ñ)</span> <span class="status"></span>
            </div>

            <div id="result-box" class="result-badge">
                –ó–≤–∏—á–∞–π–Ω–µ –≤—ñ–¥–Ω–æ—à–µ–Ω–Ω—è
            </div>

            <div class="presets">
                <button onclick="loadPreset('empty')">–°–∫–∏–Ω—É—Ç–∏</button>
                <button onclick="loadPreset('equivalence')">–ï–∫–≤—ñ–≤–∞–ª–µ–Ω—Ç–Ω—ñ—Å—Ç—å</button>
                <button onclick="loadPreset('linearOrder')">–õ—ñ–Ω—ñ–π–Ω–∏–π –ø–æ—Ä—è–¥–æ–∫</button>
                <button onclick="loadPreset('partialOrder')">–ß–∞—Å—Ç–∫–æ–≤–∏–π –ø–æ—Ä—è–¥–æ–∫</button>
                <button onclick="loadPreset('strictOrder')">–°—Ç—Ä–æ–≥–∏–π –ø–æ—Ä—è–¥–æ–∫</button>
            </div>
        </div>
    </div>

    <div class="theory-section">
        <details>
            <summary>üìò –¢–µ–æ—Ä–µ—Ç–∏—á–Ω–∞ –¥–æ–≤—ñ–¥–∫–∞ (–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å, —â–æ–± —Ä–æ–∑–≥–æ—Ä–Ω—É—Ç–∏)</summary>
            <div class="theory-content">
                <p><strong>–ü–æ–∑–Ω–∞—á–µ–Ω–Ω—è:</strong> –ú–∞—î–º–æ –º–Ω–æ–∂–∏–Ω—É $A = \{a, b, c\}$. –í—ñ–¥–Ω–æ—à–µ–Ω–Ω—è $R$ ‚Äî —Ü–µ –ø—ñ–¥–º–Ω–æ–∂–∏–Ω–∞ –ø–∞—Ä $(x, y)$. –Ø–∫—â–æ $(x, y) \in R$, –º–∏ –º–∞–ª—é—î–º–æ —Å—Ç—Ä—ñ–ª–∫—É –≤—ñ–¥ $x$ –¥–æ $y$.</p>
                
                <table class="theory-table">
                    <thead>
                        <tr>
                            <th>–í–ª–∞—Å—Ç–∏–≤—ñ—Å—Ç—å</th>
                            <th>–í–∏–∑–Ω–∞—á–µ–Ω–Ω—è</th>
                            <th>–ü—Ä–∏–∫–ª–∞–¥–∏</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>–†–µ—Ñ–ª–µ–∫—Å–∏–≤–Ω–µ</strong></td>
                            <td>–ö–æ–∂–µ–Ω –µ–ª–µ–º–µ–Ω—Ç –º–∞—î –∑–≤'—è–∑–æ–∫ —ñ–∑ —Å–∞–º–∏–º —Å–æ–±–æ—é (–ø–µ—Ç–ª—é).<br><code>‚àÄx: (x,x) ‚àà R</code></td>
                            <td>"–î–æ—Ä—ñ–≤–Ω—é—î" ($=$), "–ë—É—Ç–∏ —Å—Ö–æ–∂–∏–º –Ω–∞", "–ú–∞—Ç–∏ —Ç—É —Å–∞–º—É –Ω–∞–∑–≤—É".<br><em>–ê–Ω—Ç–∏-–ø—Ä–∏–∫–ª–∞–¥:</em> "–ú–µ–Ω—à–µ –∑–∞" ($<$).</td>
                        </tr>
                        <tr>
                            <td><strong>–ê–Ω—Ç–∏—Ä–µ—Ñ–ª–µ–∫—Å–∏–≤–Ω–µ</strong></td>
                            <td>–ñ–æ–¥–µ–Ω –µ–ª–µ–º–µ–Ω—Ç –Ω–µ –º–∞—î –ø–µ—Ç–ª—ñ.<br><code>‚àÄx: (x,x) ‚àâ R</code></td>
                            <td>"–°—Ç—Ä–æ–≥–æ –±—ñ–ª—å—à–µ" ($>$), "–ë—É—Ç–∏ –±–∞—Ç—å–∫–æ–º".</td>
                        </tr>
                        <tr>
                            <td><strong>–°–∏–º–µ—Ç—Ä–∏—á–Ω–µ</strong></td>
                            <td>–Ø–∫—â–æ —î —à–ª—è—Ö —Ç—É–¥–∏, —î —ñ —à–ª—è—Ö –Ω–∞–∑–∞–¥.<br><code>(x,y) ‚àà R ‚áí (y,x) ‚àà R</code></td>
                            <td>"–ë—É—Ç–∏ —Ä–æ–¥–∏—á–µ–º", "–ë—É—Ç–∏ —Å—É—Å—ñ–¥–æ–º", "–ù–µ –¥–æ—Ä—ñ–≤–Ω—é–≤–∞—Ç–∏" ($\neq$).</td>
                        </tr>
                        <tr>
                            <td><strong>–ê–Ω—Ç–∏—Å–∏–º–µ—Ç—Ä–∏—á–Ω–µ</strong></td>
                            <td>–ú—ñ–∂ —Ä—ñ–∑–Ω–∏–º–∏ –µ–ª–µ–º–µ–Ω—Ç–∞–º–∏ –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ –ø–æ–¥–≤—ñ–π–Ω–æ–≥–æ –∑–≤'—è–∑–∫—É.<br><code>(x,y) ‚àà R ‚àß (y,x) ‚àà R ‚áí x=y</code></td>
                            <td>"–ú–µ–Ω—à–µ –∞–±–æ –¥–æ—Ä—ñ–≤–Ω—é—î" ($\le$), "–Ñ –ø—ñ–¥–º–Ω–æ–∂–∏–Ω–æ—é" ($\subseteq$).<br><em>–î–æ–∑–≤–æ–ª—è—î –ø–µ—Ç–ª—ñ!</em></td>
                        </tr>
                        <tr>
                            <td><strong>–¢—Ä–∞–Ω–∑–∏—Ç–∏–≤–Ω–µ</strong></td>
                            <td>–ü—Ä–∏–Ω—Ü–∏–ø "–¥—Ä—É–≥ –º–æ–≥–æ –¥—Ä—É–≥–∞ ‚Äî –º—ñ–π –¥—Ä—É–≥".<br><code>(x,y) ‚àà R ‚àß (y,z) ‚àà R ‚áí (x,z) ‚àà R</code></td>
                            <td>"–ë—ñ–ª—å—à–µ", "–î—ñ–ª–∏—Ç—å—Å—è –Ω–∞", "–ü—Ä–µ–¥–∫".<br><em>–ê–Ω—Ç–∏-–ø—Ä–∏–∫–ª–∞–¥:</em> "–ü–µ—Ä–µ–º—ñ–≥ —É –º–∞—Ç—á—ñ" (–ê –ø–µ—Ä–µ–º—ñ–≥ –ë, –ë –ø–µ—Ä–µ–º—ñ–≥ –í, –∞–ª–µ –ê –º—ñ–≥ –ø—Ä–æ–≥—Ä–∞—Ç–∏ –í).</td>
                        </tr>
                    </tbody>
                </table>

                <h3 style="margin-top:20px; border-bottom: 1px solid #eee; padding-bottom: 5px;">–¢–∏–ø–∏ –≤—ñ–¥–Ω–æ—à–µ–Ω—å</h3>
                <ul style="list-style-type: disc; padding-left: 20px;">
                    <li><strong>–í—ñ–¥–Ω–æ—à–µ–Ω–Ω—è –µ–∫–≤—ñ–≤–∞–ª–µ–Ω—Ç–Ω–æ—Å—Ç—ñ</strong> = –†–µ—Ñ–ª–µ–∫—Å–∏–≤–Ω–µ + –°–∏–º–µ—Ç—Ä–∏—á–Ω–µ + –¢—Ä–∞–Ω–∑–∏—Ç–∏–≤–Ω–µ. <br><em>(–†–æ–∑–±–∏–≤–∞—î –º–Ω–æ–∂–∏–Ω—É –Ω–∞ –≥—Ä—É–ø–∏ —Å—Ö–æ–∂–∏—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤. –ù–∞–ø—Ä–∏–∫–ª–∞–¥: –∑–∞–ª–∏—à–æ–∫ –≤—ñ–¥ –¥—ñ–ª–µ–Ω–Ω—è).</em></li>
                    <li><strong>–ß–∞—Å—Ç–∫–æ–≤–∏–π –ø–æ—Ä—è–¥–æ–∫ ($\preceq$)</strong> = –†–µ—Ñ–ª–µ–∫—Å–∏–≤–Ω–µ + –ê–Ω—Ç–∏—Å–∏–º–µ—Ç—Ä–∏—á–Ω–µ + –¢—Ä–∞–Ω–∑–∏—Ç–∏–≤–Ω–µ. <br><em>(–Ü—î—Ä–∞—Ä—Ö—ñ—è, –¥–µ –Ω–µ –≤—Å—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ –º–æ–∂–Ω–∞ –ø–æ—Ä—ñ–≤–Ω—è—Ç–∏. –ù–∞–ø—Ä–∏–∫–ª–∞–¥: –≤–∫–ª—é—á–µ–Ω–Ω—è –º–Ω–æ–∂–∏–Ω).</em></li>
                    <li><strong>–õ—ñ–Ω—ñ–π–Ω–∏–π –ø–æ—Ä—è–¥–æ–∫ ($\le$)</strong> = –ß–∞—Å—Ç–∫–æ–≤–∏–π –ø–æ—Ä—è–¥–æ–∫ + –ü–æ–≤–Ω–æ—Ç–∞. <br><em>(–í—Å—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ –≤–∏—à–∏–∫—É–≤–∞–Ω—ñ –≤ —Ä—è–¥. –ù–∞–ø—Ä–∏–∫–ª–∞–¥: —á–∏—Å–ª–∞ –Ω–∞ –æ—Å—ñ).</em></li>
                    <li><strong>–°—Ç—Ä–æ–≥–∏–π –ø–æ—Ä—è–¥–æ–∫ ($<$)</strong> = –ê–Ω—Ç–∏—Ä–µ—Ñ–ª–µ–∫—Å–∏–≤–Ω–µ + –ê–Ω—Ç–∏—Å–∏–º–µ—Ç—Ä–∏—á–Ω–µ + –¢—Ä–∞–Ω–∑–∏—Ç–∏–≤–Ω–µ.</li>
                </ul>
            </div>
        </details>
    </div>

    <script>
        // --- STATE ---
        let matrix = [
            [0, 0, 0],
            [0, 0, 0],
            [0, 0, 0]
        ];
        const nodes = ['a', 'b', 'c'];
        // Coordinates for Linear Layout (y=110)
        const nodeCoords = [
            {x: 80, y: 110},
            {x: 200, y: 110},
            {x: 320, y: 110}
        ];

        // --- INITIALIZATION ---
        function init() {
            renderMatrixGrid();
            updateAll();
        }

        // --- RENDER: MATRIX ---
        function renderMatrixGrid() {
            const container = document.getElementById('matrix');
            container.innerHTML = '';

            // Header Row
            container.appendChild(createDiv('header-cell', ''));
            nodes.forEach(n => container.appendChild(createDiv('header-cell', n)));

            // Matrix Rows
            for (let i = 0; i < 3; i++) {
                container.appendChild(createDiv('header-cell', nodes[i]));
                for (let j = 0; j < 3; j++) {
                    const cell = document.createElement('div');
                    let cls = 'cell matrix-cell';
                    if(matrix[i][j]) cls += ' active';
                    if(i === j) cls += ' diag-highlight'; // Visual helper for diagonal
                    
                    cell.className = cls;
                    cell.innerText = matrix[i][j];
                    cell.onclick = () => toggleCell(i, j);
                    container.appendChild(cell);
                }
            }
        }

        function createDiv(cls, text) {
            const d = document.createElement('div');
            d.className = cls;
            d.innerText = text;
            return d;
        }

        // --- RENDER: GRAPH (SVG) ---
        function renderGraph() {
            const layer = document.getElementById('edges-layer');
            layer.innerHTML = '';

            // Draw edges
            for (let i = 0; i < 3; i++) {
                for (let j = 0; j < 3; j++) {
                    if (matrix[i][j] === 1) {
                        drawEdge(layer, i, j);
                    }
                }
            }
        }

        function drawEdge(container, startIdx, endIdx) {
            const start = nodeCoords[startIdx];
            const end = nodeCoords[endIdx];
            const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
            
            let d = "";
            let isLoop = false;

            if (startIdx === endIdx) {
                // LOOP: Draw above the node
                // M (top-left of node) ... Curve up ... Return (top-right of node)
                const r = 10; 
                // Control points relative to node center (cx, cy)
                // We want a loop going UP (negative Y)
                const cx = start.x;
                const cy = start.y - 15; // Start slightly above center
                
                // Path: Move to left-top, Cubic Bezier up and round, End right-top
                d = `M ${cx - 8} ${cy} C ${cx - 25} ${cy - 50}, ${cx + 25} ${cy - 50}, ${cx + 8} ${cy}`;
                isLoop = true;
                path.setAttribute("marker-end", "url(#arrowhead-loop)");
            } else {
                // LINEAR EDGES
                // Logic: 
                // 1. Forward (i < j): Curve Up (Negative Y arc)
                // 2. Backward (i > j): Curve Down (Positive Y arc)
                // 3. Neighbors (|i-j|==1): Shallow curve
                // 4. Jump (|i-j| > 1): Deep curve (to avoid collision with middle node)

                const isForward = startIdx < endIdx;
                const dist = Math.abs(startIdx - endIdx);
                
                // Calculate Control Point for Quadratic Bezier (Q)
                const midX = (start.x + end.x) / 2;
                let ctrlY = start.y;

                if (isForward) {
                    // Arc UP
                    const offset = dist === 1 ? 40 : 70; // Deeper arc if jumping over node
                    ctrlY -= offset;
                } else {
                    // Arc DOWN
                    const offset = dist === 1 ? 40 : 70;
                    ctrlY += offset;
                }

                d = `M ${start.x} ${start.y} Q ${midX} ${ctrlY} ${end.x} ${end.y}`;
                path.setAttribute("marker-end", "url(#arrowhead)");
            }

            path.setAttribute("d", d);
            path.setAttribute("class", isLoop ? "edge loop" : "edge");
            container.appendChild(path);
        }

        // --- LOGIC ---

        function toggleCell(r, c) {
            matrix[r][c] = matrix[r][c] === 1 ? 0 : 1;
            updateAll();
        }

        function updateAll() {
            renderMatrixGrid();
            renderGraph();
            analyzeProperties();
        }

        function analyzeProperties() {
            const m = matrix;
            const N = 3;

            // 1. Reflexive: ALL diagonal elements are 1
            const isReflexive = m[0][0] && m[1][1] && m[2][2];
            
            // 2. Irreflexive: ALL diagonal elements are 0
            const isIrreflexive = !m[0][0] && !m[1][1] && !m[2][2];

            // 3. Symmetric: M[i][j] == M[j][i] for all i != j
            let isSymmetric = true;
            for(let i=0; i<N; i++)
                for(let j=0; j<N; j++)
                    if(i!==j && m[i][j] !== m[j][i]) isSymmetric = false;

            // 4. Antisymmetric: If M[i][j] and M[j][i] then i==j. (No 2-way between distinct nodes)
            let isAntisymmetric = true;
            for(let i=0; i<N; i++)
                for(let j=0; j<N; j++)
                    if(i !== j && m[i][j] && m[j][i]) isAntisymmetric = false;

            // 5. Transitive
            let isTransitive = true;
            for(let i=0; i<N; i++)
                for(let j=0; j<N; j++)
                    for(let k=0; k<N; k++)
                        if(m[i][j] && m[j][k] && !m[i][k]) isTransitive = false;

            // 6. Complete (Connected): For distinct x,y either x->y OR y->x (or both)
            let isComplete = true;
            for(let i=0; i<N; i++)
                for(let j=0; j<N; j++)
                    if (i !== j && !m[i][j] && !m[j][i]) isComplete = false;

            // Update UI
            setPropStatus('prop-refl', isReflexive);
            setPropStatus('prop-irrefl', isIrreflexive);
            setPropStatus('prop-sym', isSymmetric);
            setPropStatus('prop-antisym', isAntisymmetric);
            setPropStatus('prop-trans', isTransitive);
            setPropStatus('prop-complete', isComplete);

            determineType(isReflexive, isIrreflexive, isSymmetric, isAntisymmetric, isTransitive, isComplete);
        }

        function setPropStatus(id, active) {
            const el = document.getElementById(id);
            const status = el.querySelector('.status');
            if(active) {
                el.classList.add('active');
                status.innerHTML = '‚úî';
            } else {
                el.classList.remove('active');
                status.innerHTML = '';
            }
        }

        function determineType(refl, irrefl, sym, antisym, trans, complete) {
            const box = document.getElementById('result-box');
            let type = "–ó–≤–∏—á–∞–π–Ω–µ –≤—ñ–¥–Ω–æ—à–µ–Ω–Ω—è";
            let found = false;

            if (refl && sym && trans) {
                type = "–ï–ö–í–Ü–í–ê–õ–ï–ù–¢–ù–Ü–°–¢–¨ (‚â°)";
                found = true;
            } else if (refl && antisym && trans) {
                if (complete) type = "–õ–Ü–ù–Ü–ô–ù–ò–ô –ü–û–†–Ø–î–û–ö (‚â§)";
                else type = "–ß–ê–°–¢–ö–û–í–ò–ô –ü–û–†–Ø–î–û–ö (‚äÜ)";
                found = true;
            } else if (irrefl && antisym && trans) {
                 // Strictly implies asymmetric too
                if(complete) type = "–°–¢–†–û–ì–ò–ô –õ–Ü–ù–Ü–ô–ù–ò–ô –ü–û–†–Ø–î–û–ö (<)"; // Less common specific term but valid
                else type = "–°–¢–†–û–ì–ò–ô –ü–û–†–Ø–î–û–ö (<)";
                found = true;
            }

            box.innerText = type;
            if(found) box.classList.add('found');
            else box.classList.remove('found');
        }

        // --- PRESETS ---
        function loadPreset(name) {
            // Clear
            matrix = [[0,0,0],[0,0,0],[0,0,0]];
            
            if(name === 'equivalence') {
                // {a,b} connected fully, {c} isolated loop
                matrix = [
                    [1,1,0],
                    [1,1,0],
                    [0,0,1]
                ];
            } 
            else if(name === 'linearOrder') {
                // a <= b <= c (transitive: a <= c)
                matrix = [
                    [1,1,1], // a->a, a->b, a->c
                    [0,1,1], // b->b, b->c
                    [0,0,1]  // c->c
                ];
            }
            else if(name === 'partialOrder') {
                // Like linear but remove comparison between b and c? 
                // Better: a->b, a->c. b and c incomparable.
                // Tree structure: a is root.
                matrix = [
                    [1,1,1],
                    [0,1,0],
                    [0,0,1]
                ];
            }
            else if(name === 'strictOrder') {
                // a < b < c (so a < c too). No loops.
                matrix = [
                    [0,1,1],
                    [0,0,1],
                    [0,0,0]
                ];
            }
            
            updateAll();
        }

        // Start
        init();

    </script>
</body>
</html>