<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–∏–º—É–ª—è—Ç–æ—Ä –ë—É–ª–µ–≤–æ—ó –ê–ª–≥–µ–±—Ä–∏ —Ç–∞ –ö–∞—Ä—Ç –ö–∞—Ä–Ω–æ</title>
    
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                macros: {
                    // –í–ò–ü–†–ê–í–õ–ï–ù–û: –í–∏–¥–∞–ª–µ–Ω–æ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–∏–π –≤–∏–∫–ª–∏–∫ vee
                    neg: ["\\overline{#1}", 1]
                }
            },
            svg: { fontCache: 'global' }
        };
    </script>
    <script type="text/javascript" id="MathJax-script" async
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
    </script>

    <style>
        :root {
            --bg-color: #f4f7f6;
            --card-bg: #ffffff;
            --primary: #3498db;
            --accent: #2c3e50;
            --text: #333;
            
            /* Palette for Groups - —è—Å–∫—Ä–∞–≤—ñ –∫–æ–ª—å–æ—Ä–∏ –¥–ª—è —Ä–∞–º–æ–∫ */
            --c-grp-0: #e74c3c; /* Red */
            --c-grp-1: #3498db; /* Blue */
            --c-grp-2: #2ecc71; /* Green */
            --c-grp-3: #9b59b6; /* Purple */
            --c-grp-4: #f39c12; /* Orange */
            --c-grp-5: #1abc9c; /* Teal */
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text);
            line-height: 1.6;
            margin: 0;
            padding: 20px;
        }

        .container { max-width: 1100px; margin: 0 auto; }
        
        header { text-align: center; margin-bottom: 30px; }
        h1 { color: var(--accent); margin-bottom: 5px; }
        p.subtitle { color: #666; margin-top: 0; }

        /* Tabs */
        .tabs { display: flex; justify-content: center; margin-bottom: 20px; gap: 10px; }
        .tab-btn {
            padding: 12px 24px;
            background: #ddd;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            color: #555;
            transition: all 0.3s;
        }
        .tab-btn.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 10px rgba(52, 152, 219, 0.3);
        }
        .tab-content { display: none; animation: fadeIn 0.4s; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Cards */
        .logic-card {
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            margin-bottom: 30px;
            padding: 25px;
            border-left: 5px solid var(--accent);
        }
        .card-title { font-size: 1.4em; font-weight: bold; color: var(--accent); display: block; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px;}

        /* Tables */
        table { width: 100%; border-collapse: collapse; margin: 15px 0; background: white; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: center; }
        th { background-color: var(--accent); color: white; }
        tr:nth-child(even) { background-color: #f9f9f9; }

        /* Examples Box Style */
        .example-box {
            background: #fff;
            border: 2px dashed var(--primary);
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            background-color: #fbfdff;
        }
        .example-box h4 { margin-top: 0; color: var(--primary); }
        .example-step { margin-bottom: 8px; padding-left: 10px; border-left: 3px solid #ddd; }

        /* K-Map Styles */
        .controls-area {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            background: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            align-items: center;
        }
        
        .radio-group { display: flex; gap: 10px; align-items: center; background: white; padding: 5px 15px; border-radius: 20px; border: 1px solid #ddd; }
        .radio-group label { cursor: pointer; font-weight: 600; font-size: 0.9em; }
        .radio-group input { margin-right: 5px; }

        .btn {
            padding: 8px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            color: white;
            background: var(--primary);
            transition: background 0.2s;
        }
        .btn:hover { background: #2980b9; }
        .btn-reset { background: #e74c3c; }

        /* Grid Wrapper */
        .kmap-container {
            display: flex;
            justify-content: center;
            margin: 20px 0;
            overflow-x: auto;
        }

        .kmap-grid {
            display: grid;
            gap: 4px;
            position: relative;
            user-select: none;
            padding: 40px; /* Space for headers */
        }
        
        /* Grid Sizes */
        .grid-3 { grid-template-columns: repeat(4, 70px); grid-template-rows: repeat(2, 70px); }
        .grid-4 { grid-template-columns: repeat(4, 70px); grid-template-rows: repeat(4, 70px); }

        .cell {
            width: 70px;
            height: 70px;
            background: white;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6em;
            font-weight: bold;
            cursor: pointer;
            position: relative;
            z-index: 2;
        }
        .cell:hover { border-color: var(--primary); transform: scale(1.05); }
        .cell.val-1 { color: var(--accent); }
        .cell.val-0 { color: #bdc3c7; }

        .header-label {
            position: absolute;
            font-weight: bold;
            font-size: 0.9em;
            color: var(--accent);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* –í–ò–ü–†–ê–í–õ–ï–ù–û: –°—Ç–∏–ª—ñ –æ–≤–µ—Ä–ª–µ—é */
        .group-overlay {
            position: absolute;
            border-style: solid;
            border-radius: 12px;
            z-index: 5; /* –ü–æ–≤–µ—Ä—Ö –∫–ª—ñ—Ç–∏–Ω–æ–∫, –∞–ª–µ –ø–æ–¥—ñ—ó –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—å—Å—è */
            pointer-events: none; /* –ö–ª—ñ–∫–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç—å –∫—Ä—ñ–∑—å —Ä–∞–º–∫—É –¥–æ –∫–ª—ñ—Ç–∏–Ω–æ–∫ */
            background: transparent; /* –ü—Ä–∏–±—Ä–∞–Ω–æ –∑–∞–ª–∏–≤–∫—É */
            box-shadow: 0 0 4px rgba(0,0,0,0.2);
            transition: all 0.3s;
        }
        
        .result-box {
            background: var(--accent);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            font-size: 1.3em;
            margin-top: 20px;
        }
        
        /* Legend for colors */
        .group-legend {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        .legend-item {
            font-size: 0.8em;
            padding: 2px 8px;
            border-radius: 4px;
            border: 2px solid;
            background: white;
        }
    </style>
</head>
<body>

<div class="container">
    <header>
       
        <p class="subtitle">–ú—ñ–Ω—ñ–º—ñ–∑–∞—Ü—ñ—è –ª–æ–≥—ñ—á–Ω–∏—Ö —Ñ—É–Ω–∫—Ü—ñ–π</p>
    </header>

    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('laws')">üìú –ó–∞–∫–æ–Ω–∏ –ª–æ–≥—ñ–∫–∏</button>
        <button class="tab-btn" onclick="switchTab('kmap')">üß© –ö–∞—Ä—Ç–∏ –ö–∞—Ä–Ω–æ</button>
    </div>

    <div id="tab-laws" class="tab-content active">
        <div class="logic-card">
            <span class="card-title">–û—Å–Ω–æ–≤–Ω—ñ –∞–∫—Å—ñ–æ–º–∏ —Ç–∞ –∑–∞–∫–æ–Ω–∏</span>
            <p>
                <strong>–ü–æ–∑–Ω–∞—á–µ–Ω–Ω—è:</strong><br>
                $\overline{A}$ ‚Äî –ó–∞–ø–µ—Ä–µ—á–µ–Ω–Ω—è (NOT)<br>
                $\vee$ ‚Äî –î–∏–∑'—é–Ω–∫—Ü—ñ—è (OR)<br>
                $\cdot$ ‚Äî –ö–æ–Ω'—é–Ω–∫—Ü—ñ—è (AND)
            </p>
            <p><em>–ü–µ—Ä–µ–π–¥—ñ—Ç—å –Ω–∞ –≤–∫–ª–∞–¥–∫—É "–ö–∞—Ä—Ç–∏ –ö–∞—Ä–Ω–æ" –¥–ª—è —Å–∏–º—É–ª—è—Ç–æ—Ä–∞.</em></p>
        </div>
    
        <details open>
            <summary>–¢–∞–±–ª–∏—Ü—è –æ—Å–Ω–æ–≤–Ω–∏—Ö –∑–∞–∫–æ–Ω—ñ–≤ (–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å)</summary>
            <table>
                <thead>
                    <tr>
                        <th>–ù–∞–∑–≤–∞ –∑–∞–∫–æ–Ω—É</th>
                        <th>–§–æ—Ä–º—É–ª–∞</th>
                        <th>–ö–æ–º–µ–Ω—Ç–∞—Ä</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>–ó–∞–∫–æ–Ω–∏ 0 —ñ 1</td>
                        <td>$A \vee 0 = A$, $A \vee 1 = 1$<br>$A \cdot 1 = A$, $A \cdot 0 = 0$</td>
                        <td>–í–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ –∫–æ–Ω—Å—Ç–∞–Ω—Ç</td>
                    </tr>
                    <tr>
                        <td>–Ü–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ñ—Å—Ç—å</td>
                        <td>$A \vee A = A$<br>$A \cdot A = A$</td>
                        <td>–ü–æ–≤—Ç–æ—Ä–µ–Ω–Ω—è –Ω–µ –∑–º—ñ–Ω—é—î –∑–Ω–∞—á–µ–Ω–Ω—è</td>
                    </tr>
                        <tr>
                        <td>–ü–æ–¥–≤—ñ–π–Ω–µ –∑–∞–ø–µ—Ä–µ—á–µ–Ω–Ω—è</td>
                        <td>$\overline{\overline{A}} = A$</td>
                        <td>–ó–∞–ø–µ—Ä–µ—á–µ–Ω–Ω—è —Å–∫–∞—Å–æ–≤—É—î —Å–∞–º–µ —Å–µ–±–µ</td>
                    </tr>
                    <tr>
                        <td>–ö–æ–º—É—Ç–∞—Ç–∏–≤–Ω–∏–π</td>
                        <td>$A \cdot B = B \cdot A$<br>$A \vee B = B \vee A$</td>
                        <td>–ü–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∞ –º—ñ—Å—Ü—å</td>
                    </tr>
                    <tr>
                        <td>–ê—Å–æ—Ü—ñ–∞—Ç–∏–≤–Ω–∏–π</td>
                        <td>$(A \cdot B) \cdot C = A \cdot (B \cdot C)$<br>$(A \vee B) \vee C = A \vee (B \vee C)$</td>
                        <td>–ì—Ä—É–ø—É–≤–∞–Ω–Ω—è –¥—É–∂–∫–∞–º–∏</td>
                    </tr>
                    <tr>
                        <td>–î–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤–Ω–∏–π</td>
                        <td>$A \cdot (B \vee C) = A \cdot B \vee A \cdot C$<br>$A \vee (B \cdot C) = (A \vee B) \cdot (A \vee C)$</td>
                        <td>–†–æ–∑–∫—Ä–∏—Ç—Ç—è –¥—É–∂–æ–∫</td>
                    </tr>
                    <tr>
                        <td>–î–µ –ú–æ—Ä–≥–∞–Ω–∞</td>
                        <td>$\overline{A \cdot B} = \overline{A} \vee \overline{B}$<br>$\overline{A \vee B} = \overline{A} \cdot \overline{B}$</td>
                        <td>"–†–æ–∑—Ä—ñ–∑–∞–≤ —Ä–∏—Å–∫—É ‚Äî –∑–º—ñ–Ω–∏–≤ –∑–Ω–∞–∫"</td>
                    </tr>
                    <tr>
                        <td>–ü–æ–≥–ª–∏–Ω–∞–Ω–Ω—è</td>
                        <td>$A \vee A \cdot B = A$<br>$A \cdot (A \vee B) = A$</td>
                        <td>–ú–µ–Ω—à–∏–π —Ç–µ—Ä–º "–ø–æ–≥–ª–∏–Ω–∞—î" –±—ñ–ª—å—à–∏–π</td>
                    </tr>
                    <tr>
                        <td>–°–∫–ª–µ—é–≤–∞–Ω–Ω—è</td>
                        <td>$A \cdot B \vee A \cdot \overline{B} = A$<br>$(A \vee B) \cdot (A \vee \overline{B}) = A$</td>
                        <td>–û—Å–Ω–æ–≤–∞ –º–µ—Ç–æ–¥—É –ö–∞—Ä—Ç –ö–∞—Ä–Ω–æ</td>
                    </tr>
                </tbody>
            </table>
        </details>

        <div style="margin-top: 30px;">
            <h3>üí° –ü—Ä–∏–∫–ª–∞–¥–∏ –º—ñ–Ω—ñ–º—ñ–∑–∞—Ü—ñ—ó</h3>
            <p>–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É, —â–æ–± –∑–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –≤–∏–ø–∞–¥–∫–æ–≤–∏–π –ø—Ä–∏–∫–ª–∞–¥ —Ä–æ–∑–≤'—è–∑–∞–Ω–Ω—è.</p>
            <button class="btn" onclick="showRandomExample()">üé≤ –ü–æ–∫–∞–∑–∞—Ç–∏ –ø—Ä–∏–∫–ª–∞–¥</button>
            
            <div id="example-container" class="example-box" style="display: none;">
            </div>
        </div>
    </div>

    <div id="tab-kmap" class="tab-content">
        
        <div class="logic-card">
            <details>
                <summary>üìò –¢–µ–æ—Ä—ñ—è –ö–∞—Ä—Ç –ö–∞—Ä–Ω–æ (–î–ù–§ vs –ö–ù–§)</summary>
                <div class="dnf-cnf-info" style="margin-top: 10px;">
                    <p><strong>–î–ù–§ (–î–∏–∑'—é–Ω–∫—Ç–∏–≤–Ω–∞ –ù–æ—Ä–º–∞–ª—å–Ω–∞ –§–æ—Ä–º–∞):</strong></p>
                    <ul>
                        <li>–ì—Ä—É–ø—É—î–º–æ <strong>–û–¥–∏–Ω–∏—Ü—ñ (1)</strong>.</li>
                        <li>–ó–∞–ø–∏—Å—É—î–º–æ <strong>—Å—É–º—É –¥–æ–±—É—Ç–∫—ñ–≤</strong> (OR –¥–ª—è AND-—Ç–µ—Ä–º—ñ–≤).</li>
                        <li>–Ø–∫—â–æ –∑–º—ñ–Ω–Ω–∞ $A=1 \to A$, —è–∫—â–æ $A=0 \to \overline{A}$.</li>
                    </ul>
                    <hr style="border-color: #ffeeba;">
                    <p><strong>–ö–ù–§ (–ö–æ–Ω'—é–Ω–∫—Ç–∏–≤–Ω–∞ –ù–æ—Ä–º–∞–ª—å–Ω–∞ –§–æ—Ä–º–∞):</strong></p>
                    <ul>
                        <li>–ì—Ä—É–ø—É—î–º–æ <strong>–ù—É–ª—ñ (0)</strong>.</li>
                        <li>–ó–∞–ø–∏—Å—É—î–º–æ <strong>–¥–æ–±—É—Ç–æ–∫ —Å—É–º</strong> (AND –¥–ª—è OR-—Ç–µ—Ä–º—ñ–≤).</li>
                        <li>–õ–æ–≥—ñ–∫–∞ —ñ–Ω–≤–µ—Ä—Å–Ω–∞: –Ø–∫—â–æ –∑–º—ñ–Ω–Ω–∞ $A=1 \to \overline{A}$, —è–∫—â–æ $A=0 \to A$.</li>
                    </ul>
                </div>
            </details>
        </div>
        
        <div class="logic-card" style="border-left-color: var(--primary);">
            <span class="card-title">–Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞ –ö–∞—Ä—Ç–∞</span>
            
            <div class="controls-area">
                <div class="radio-group">
                    <span>–ó–º—ñ–Ω–Ω—ñ:</span>
                    <label><input type="radio" name="vars" value="3" checked onchange="initKMap()"> 3 –∑–º—ñ–Ω–Ω—ñ</label>
                    <label><input type="radio" name="vars" value="4" onchange="initKMap()"> 4 –∑–º—ñ–Ω–Ω—ñ</label>
                </div>

                <div class="radio-group">
                    <span>–†–µ–∂–∏–º:</span>
                    <label><input type="radio" name="mode" value="dnf" checked onchange="solveKMap()"> –î–ù–§ (1)</label>
                    <label><input type="radio" name="mode" value="cnf" onchange="solveKMap()"> –ö–ù–§ (0)</label>
                </div>

                <button class="btn" onclick="randomizeKMap()">üé≤ –í–∏–ø–∞–¥–∫–æ–≤–æ</button>
                <button class="btn btn-reset" onclick="resetKMap()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç–∏</button>
            </div>

            <div id="mode-hint" style="text-align: center; color: #666; margin-bottom: 10px; font-style: italic;">
                –ì—Ä—É–ø—É—î–º–æ –æ–¥–∏–Ω–∏—Ü—ñ –¥–ª—è –î–ù–§
            </div>

            <div class="kmap-container">
                <div id="kmap-grid-wrapper" style="position: relative;">
                    <div id="headers-container"></div>
                    <div id="grid" class="kmap-grid grid-3"></div>
                </div>
            </div>

            <div id="group-legend" class="group-legend"></div>

            <div class="result-box">
                <span>–†–µ–∑—É–ª—å—Ç–∞—Ç:</span>
                <div id="formula-display" style="font-size: 1.5em; font-weight: bold; margin-top: 10px;">$F = 0$</div>
            </div>
        </div>
    </div>
</div>

<script>
    function switchTab(tab) {
        document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
        document.getElementById('tab-' + tab).classList.add('active');
        event.target.classList.add('active');
    }

    // --- –ë–ê–ó–ê –ü–†–ò–ö–õ–ê–î–Ü–í (–ù–û–í–ï) ---
    
    const logicExamples = [
        {
            title: "–ó–∞–∫–æ–Ω —Å–∫–ª–µ—é–≤–∞–Ω–Ω—è",
            task: "$F = A \\cdot B \\vee A \\cdot \\overline{B}$",
            steps: [
                "–ü–æ–º—ñ—á–∞—î–º–æ —Å–ø—ñ–ª—å–Ω–∏–π –º–Ω–æ–∂–Ω–∏–∫ $A$.",
                "–í–∏–Ω–æ—Å–∏–º–æ $A$ –∑–∞ –¥—É–∂–∫–∏ (–¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤–Ω–∏–π –∑–∞–∫–æ–Ω): $$A \\cdot (B \\vee \\overline{B})$$",
                "–ó–∞—Å—Ç–æ—Å–æ–≤—É—î–º–æ –∑–∞–∫–æ–Ω –≤–∏–∫–ª—é—á–µ–Ω–æ–≥–æ —Ç—Ä–µ—Ç—å–æ–≥–æ ($B \\vee \\overline{B} = 1$): $$A \\cdot 1$$",
                "–í—Ä–∞—Ö–æ–≤—É—î–º–æ –≤–ª–∞—Å—Ç–∏–≤—ñ—Å—Ç—å –æ–¥–∏–Ω–∏—Ü—ñ ($X \\cdot 1 = X$)."
            ],
            result: "$A$"
        },
        {
            title: "–ó–∞–∫–æ–Ω –ø–æ–≥–ª–∏–Ω–∞–Ω–Ω—è",
            task: "$F = A \\vee A \\cdot B$",
            steps: [
                "–í–∏–Ω–æ—Å–∏–º–æ $A$ –∑–∞ –¥—É–∂–∫–∏ (—É—è–≤–ª—è—î–º–æ $A$ —è–∫ $A \\cdot 1$): $$A \\cdot (1 \\vee B)$$",
                "–ó–∞ –≤–ª–∞—Å—Ç–∏–≤—ñ—Å—Ç—é –æ–¥–∏–Ω–∏—Ü—ñ ($1 \\vee X = 1$): $$A \\cdot 1$$",
                "–û—Ç—Ä–∏–º—É—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç."
            ],
            result: "$A$"
        },
        {
            title: "–ü—Ä–∞–≤–∏–ª–æ –¥–µ –ú–æ—Ä–≥–∞–Ω–∞",
            task: "–°–ø—Ä–æ—Å—Ç–∏—Ç–∏ –∑–∞–ø–µ—Ä–µ—á–µ–Ω–Ω—è: $\\overline{A \\cdot B \\vee C}$",
            steps: [
                "–ó–∞—Å—Ç–æ—Å–æ–≤—É—î–º–æ –ø—Ä–∞–≤–∏–ª–æ –¥–µ –ú–æ—Ä–≥–∞–Ω–∞ –¥–æ –¥–∏–∑'—é–Ω–∫—Ü—ñ—ó (—Ä–æ–∑—Ä–∏–≤–∞—î–º–æ –≤–µ—Ä—Ö–Ω—é —Ä–∏—Å–∫—É, $\\vee$ –º—ñ–Ω—è—î–º–æ –Ω–∞ $\\cdot$): $$\\overline{A \\cdot B} \\cdot \\overline{C}$$",
                "–ó–∞—Å—Ç–æ—Å–æ–≤—É—î–º–æ –¥–µ –ú–æ—Ä–≥–∞–Ω–∞ –¥–æ –ø–µ—Ä—à–æ—ó —á–∞—Å—Ç–∏–Ω–∏ ($\\overline{A \\cdot B}$): $$(\\overline{A} \\vee \\overline{B}) \\cdot \\overline{C}$$",
                "–†–æ–∑–∫—Ä–∏–≤–∞—î–º–æ –¥—É–∂–∫–∏:"
            ],
            result: "$\\overline{A}\\overline{C} \\vee \\overline{B}\\overline{C}$"
        },
        {
            title: "–°–ø—Ä–æ—â–µ–Ω–Ω—è –≤–∏—Ä–∞–∑—É",
            task: "$F = (A \\vee B) \\cdot (A \\vee C)$",
            steps: [
                "–†–æ–∑–∫—Ä–∏–≤–∞—î–º–æ –¥—É–∂–∫–∏: $$A\\cdot A \\vee A\\cdot C \\vee B\\cdot A \\vee B\\cdot C$$",
                "–°–ø—Ä–æ—â—É—î–º–æ $A\\cdot A = A$: $$A \\vee A\\cdot C \\vee A\\cdot B \\vee B\\cdot C$$",
                "–í–∏–Ω–æ—Å–∏–º–æ $A$ –∑ –ø–µ—Ä—à–∏—Ö —Ç—Ä—å–æ—Ö –¥–æ–¥–∞–Ω–∫—ñ–≤: $$A \\cdot (1 \\vee C \\vee B) \\vee B\\cdot C$$",
                "–î—É–∂–∫–∞ $(1 \\vee ...)$ –¥–æ—Ä—ñ–≤–Ω—é—î 1."
            ],
            result: "$A \\vee B \\cdot C$"
        },
        {
            title: "–ü–æ–¥–≤—ñ–π–Ω–µ —Å–∫–ª–µ—é–≤–∞–Ω–Ω—è",
            task: "$F = A B \\vee \\overline{A} B \\vee A \\overline{B}$",
            steps: [
                "–ó–≥—Ä—É–ø—É—î–º–æ –ø–µ—Ä—à–∏–π —ñ –¥—Ä—É–≥–∏–π —Ç–µ—Ä–º–∏ ($AB \\vee \\overline{A}B$): –≤–∏–Ω–æ—Å–∏–º–æ $B$, –≤ –¥—É–∂–∫–∞—Ö $1$, –ª–∏—à–∞—î—Ç—å—Å—è $B$.",
                "–ê–ª–µ —Ç—Ä–µ—Ç—ñ–π —Ç–µ—Ä–º $A\\overline{B}$ –∑–∞–ª–∏—à–∏–≤—Å—è –±–µ–∑ –ø–∞—Ä–∏. –í–∏–∫–æ—Ä–∏—Å—Ç–∞—î–º–æ —Ç—Ä—é–∫: $A \\vee A = A$. –ü—Ä–æ–¥—É–±–ª—é—î–º–æ –ø–µ—Ä—à–∏–π —Ç–µ—Ä–º $AB$: $$A B \\vee \\overline{A} B \\vee A B \\vee A \\overline{B}$$",
                "–ì—Ä—É–ø—É—î–º–æ 1-–π –∑ 2-–º: $B(A \\vee \\overline{A}) = B$",
                "–ì—Ä—É–ø—É—î–º–æ 3-–π –∑ 4-–º: $A(B \\vee \\overline{B}) = A$"
            ],
            result: "$A \\vee B$"
        }
    ];

    function showRandomExample() {
        const container = document.getElementById('example-container');
        const randomIndex = Math.floor(Math.random() * logicExamples.length);
        const example = logicExamples[randomIndex];

        let html = `<h4>${example.title}</h4>`;
        html += `<p><strong>–ó–∞–≤–¥–∞–Ω–Ω—è:</strong> ${example.task}</p>`;
        html += `<div><strong>–†–æ–∑–≤'—è–∑–∞–Ω–Ω—è:</strong></div>`;
        
        example.steps.forEach(step => {
            html += `<div class="example-step">${step}</div>`;
        });

        html += `<div style="margin-top:10px; padding-top:10px; border-top:1px solid #eee;"><strong>–í—ñ–¥–ø–æ–≤—ñ–¥—å:</strong> ${example.result}</div>`;

        container.innerHTML = html;
        container.style.display = 'block';
        
        // Re-render MathJax for the new content
        MathJax.typesetPromise([container]);
    }

    // --- K-MAP ENGINE ---
    
    let numVars = 3;
    let gridState = []; 
    let grayCodes3 = [0, 1, 3, 2]; // 00, 01, 11, 10
    let grayCodes4 = [0, 1, 3, 2];
    
    function initKMap() {
        const r = document.querySelector('input[name="vars"]:checked');
        numVars = parseInt(r.value);
        const size = numVars === 3 ? 8 : 16;
        gridState = new Array(size).fill(0);
        
        renderGridStructure();
        resetKMap();
    }

    function renderGridStructure() {
        const grid = document.getElementById('grid');
        const headers = document.getElementById('headers-container');
        
        grid.innerHTML = '';
        headers.innerHTML = '';

        grid.className = numVars === 3 ? 'kmap-grid grid-3' : 'kmap-grid grid-4';
        
        const colLabels = ['00', '01', '11', '10'];
        const rowLabels = numVars === 3 ? ['0', '1'] : ['00', '01', '11', '10'];

        // Corner Label
        const corner = document.createElement('div');
        corner.className = 'header-label';
        corner.style.top = '0'; corner.style.left = '0';
        corner.style.width = '40px'; corner.style.height = '40px';
        corner.innerHTML = numVars === 3 ? '$A \\setminus BC$' : '$AB \\setminus CD$';
        headers.appendChild(corner);

        // Column Headers
        colLabels.forEach((lbl, i) => {
            const el = document.createElement('div');
            el.className = 'header-label';
            el.style.top = '0';
            el.style.left = (40 + i*74) + 'px';
            el.style.width = '70px'; el.style.height = '40px';
            el.innerText = lbl;
            headers.appendChild(el);
        });

        // Row Headers
        rowLabels.forEach((lbl, i) => {
            const el = document.createElement('div');
            el.className = 'header-label';
            el.style.left = '0';
            el.style.top = (40 + i*74) + 'px';
            el.style.width = '40px'; el.style.height = '70px';
            el.innerText = lbl;
            headers.appendChild(el);
        });

        const rows = numVars === 3 ? 2 : 4;

        for(let r=0; r<rows; r++) {
            for(let c=0; c<4; c++) {
                let rowBits = numVars === 3 ? r : grayCodes4[r];
                let colBits = grayCodes3[c];
                let logicalIdx = (rowBits << 2) | colBits;

                const cell = document.createElement('div');
                cell.className = 'cell val-0';
                cell.id = `cell-${logicalIdx}`;
                // Store visual coordinates for simpler drawing later
                cell.dataset.vr = r; // visual row
                cell.dataset.vc = c; // visual col
                cell.onclick = () => toggleCell(logicalIdx);
                cell.innerText = '0';
                grid.appendChild(cell);
            }
        }
        MathJax.typesetPromise([headers]);
    }

    function toggleCell(idx) {
        gridState[idx] = gridState[idx] === 0 ? 1 : 0;
        updateCellUI(idx);
        solveKMap();
    }

    function updateCellUI(idx) {
        const cell = document.getElementById(`cell-${idx}`);
        cell.innerText = gridState[idx];
        if(gridState[idx] === 1) {
            cell.classList.remove('val-0');
            cell.classList.add('val-1');
        } else {
            cell.classList.remove('val-1');
            cell.classList.add('val-0');
        }
    }

    function randomizeKMap() {
        for(let i=0; i<gridState.length; i++) gridState[i] = Math.random() > 0.5 ? 1 : 0;
        gridState.forEach((_, i) => updateCellUI(i));
        solveKMap();
    }

    function resetKMap() {
        gridState.fill(0);
        gridState.forEach((_, i) => updateCellUI(i));
        solveKMap();
    }

    // --- SOLVER ALGORITHM ---

    function solveKMap() {
        clearOverlays();
        const mode = document.querySelector('input[name="mode"]:checked').value;
        const targetVal = mode === 'dnf' ? 1 : 0;
        
        document.getElementById('mode-hint').innerText = 
            mode === 'dnf' ? "–ì—Ä—É–ø—É—î–º–æ –æ–¥–∏–Ω–∏—Ü—ñ (–î–ù–§)" : "–ì—Ä—É–ø—É—î–º–æ –Ω—É–ª—ñ (–ö–ù–§)";

        // Check empty/full
        let hasTarget = gridState.some(v => v === targetVal);
        if(!hasTarget) {
            document.getElementById('formula-display').innerText = mode === 'dnf' ? "$F = 0$" : "$F = 1$";
            MathJax.typesetPromise();
            return;
        }
        let allTarget = gridState.every(v => v === targetVal);
        if(allTarget) {
            document.getElementById('formula-display').innerText = mode === 'dnf' ? "$F = 1$" : "$F = 0$";
            MathJax.typesetPromise();
            return;
        }

        let covered = new Set();
        let groups = [];
        const sizes = numVars === 3 ? [8, 4, 2, 1] : [16, 8, 4, 2, 1];
        
        // Colors
        const colors = [
            'var(--c-grp-0)', 'var(--c-grp-1)', 'var(--c-grp-2)', 
            'var(--c-grp-3)', 'var(--c-grp-4)', 'var(--c-grp-5)'
        ];

        let colorIdx = 0;

        // Helper to map Logic Index back to visual presence
        function checkRect(r, c, h, w) {
            let indices = [];
            const maxR = numVars === 3 ? 2 : 4;
            const maxC = 4;
            
            for(let i=0; i<h; i++) {
                for(let j=0; j<w; j++) {
                    let curR = (r + i) % maxR;
                    let curC = (c + j) % maxC;
                    
                    let rowBits = numVars === 3 ? curR : grayCodes4[curR];
                    let colBits = grayCodes3[curC];
                    let idx = (rowBits << 2) | colBits;
                    
                    if(gridState[idx] !== targetVal) return null;
                    indices.push(idx);
                }
            }
            return indices;
        }

        function getDims(size) {
            let dims = [];
            if(size === 16) dims.push([4,4]);
            if(size === 8) { dims.push([2,4], [4,2]); }
            if(size === 4) { dims.push([1,4], [4,1], [2,2]); }
            if(size === 2) { dims.push([1,2], [2,1]); }
            if(size === 1) { dims.push([1,1]); }
            if(numVars === 3) return dims.filter(d => d[0] <= 2);
            return dims;
        }

        for(let s of sizes) {
            let dims = getDims(s);
            for(let d of dims) {
                let h = d[0], w = d[1];
                const maxR = numVars === 3 ? 2 : 4;
                
                for(let r=0; r<maxR; r++) {
                    for(let c=0; c<4; c++) {
                        let indices = checkRect(r, c, h, w);
                        if(indices) {
                            // Check if useful (covers at least one new cell)
                            let isUseful = false;
                            for(let idx of indices) {
                                if(!covered.has(idx)) isUseful = true;
                            }
                            
                            if(isUseful) {
                                const term = getTerm(indices, mode);
                                const color = colors[colorIdx % colors.length];
                                groups.push({ indices: indices, term: term, color: color, id: colorIdx });
                                colorIdx++;
                                indices.forEach(idx => covered.add(idx));
                            }
                        }
                    }
                }
            }
        }

        drawGroups(groups);
        updateLegend(groups);
        
        let formula = groups.map(g => g.term).join(mode === 'dnf' ? " \\vee " : " \\cdot ");
        document.getElementById('formula-display').innerText = `$F = ${formula}$`;
        MathJax.typesetPromise();
    }

    function getTerm(indices, mode) {
        let mask = numVars === 3 ? 7 : 15;
        let val = indices[0];
        let diff = 0;
        
        indices.forEach(idx => diff |= (val ^ idx));
        
        let literals = [];
        const vars = numVars === 3 ? ['A','B','C'] : ['A','B','C','D'];
        const totalBits = numVars;

        for(let i=0; i<totalBits; i++) {
            let bitPos = (totalBits - 1) - i; 
            if( !((diff >> bitPos) & 1) ) {
                let bitVal = (val >> bitPos) & 1;
                let name = vars[i];
                if (mode === 'dnf') literals.push(bitVal === 1 ? name : `\\overline{${name}}`);
                else literals.push(bitVal === 0 ? name : `\\overline{${name}}`);
            }
        }
        if(literals.length === 0) return "1";
        if(mode === 'dnf') return literals.join("\\cdot ");
        else return `(${literals.join(" \\vee ")})`;
    }

    function clearOverlays() {
        document.querySelectorAll('.group-overlay').forEach(e => e.remove());
        document.getElementById('group-legend').innerHTML = '';
    }

    function updateLegend(groups) {
        const lg = document.getElementById('group-legend');
        groups.forEach(g => {
            const sp = document.createElement('span');
            sp.className = 'legend-item';
            sp.style.borderColor = g.color;
            sp.style.color = '#333';
            sp.innerHTML = `$${g.term}$`;
            lg.appendChild(sp);
        });
        MathJax.typesetPromise([lg]);
    }

    // --- –í–ò–ü–†–ê–í–õ–ï–ù–ê –§–£–ù–ö–¶–Ü–Ø –ú–ê–õ–Æ–í–ê–ù–ù–Ø ---
    function drawGroups(groups) {
        const container = document.getElementById('kmap-grid-wrapper');
        const rows = numVars === 3 ? 2 : 4;
        const cols = 4;

        groups.forEach((g, gIndex) => {
            // 1. Create a boolean mask for this group visually
            let mask = Array(rows).fill().map(() => Array(cols).fill(false));
            
            g.indices.forEach(idx => {
                const el = document.getElementById(`cell-${idx}`);
                const r = parseInt(el.dataset.vr);
                const c = parseInt(el.dataset.vc);
                mask[r][c] = true;
            });

            // 2. Find connected components (without wrapping) on this mask
            // This separates a wrapped group (e.g., col 0 and col 3) into two visual boxes
            let visited = Array(rows).fill().map(() => Array(cols).fill(false));
            
            for(let r=0; r<rows; r++) {
                for(let c=0; c<cols; c++) {
                    if(mask[r][c] && !visited[r][c]) {
                        // Start flood fill to find bounding box of this component
                        let minR = r, maxR = r, minC = c, maxC = c;
                        let queue = [[r,c]];
                        visited[r][c] = true;

                        while(queue.length > 0) {
                            let [cr, cc] = queue.shift();
                            minR = Math.min(minR, cr); maxR = Math.max(maxR, cr);
                            minC = Math.min(minC, cc); maxC = Math.max(maxC, cc);

                            // Neighbors (Up, Down, Left, Right) - NO WRAPPING here
                            const dirs = [[0,1], [0,-1], [1,0], [-1,0]];
                            for(let d of dirs) {
                                let nr = cr + d[0];
                                let nc = cc + d[1];
                                if(nr>=0 && nr<rows && nc>=0 && nc<cols && mask[nr][nc] && !visited[nr][nc]) {
                                    visited[nr][nc] = true;
                                    queue.push([nr,nc]);
                                }
                            }
                        }

                        // 3. Draw box for this component
                        const div = document.createElement('div');
                        div.className = 'group-overlay';
                        
                        // Calculate geometry
                        // Cell is 70px, Gap is 4px. Header is 40px.
                        const top = 40 + minR * 74;
                        const left = 40 + minC * 74;
                        const width = (maxC - minC + 1) * 70 + (maxC - minC) * 4;
                        const height = (maxR - minR + 1) * 70 + (maxR - minR) * 4;

                        // Dynamic Padding/Inset to prevent exact overlap
                        const offset = (gIndex * 4); 
                        
                        div.style.top = (top + offset) + 'px';
                        div.style.left = (left + offset) + 'px';
                        div.style.width = (width - offset*2) + 'px';
                        div.style.height = (height - offset*2) + 'px';
                        
                        div.style.borderColor = g.color;
                        div.style.borderWidth = '3px';
                        
                        container.appendChild(div);
                    }
                }
            }
        });
    }

    window.onload = initKMap;

</script>
</body>
</html>